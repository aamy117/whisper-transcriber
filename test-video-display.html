<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ë¶ñË®äÈ°ØÁ§∫Ê∏¨Ë©¶</title>
    <link rel="stylesheet" href="css/shared.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/video.css">
    <style>
        .test-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            z-index: 10000;
            max-width: 300px;
        }
        
        .test-info h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
        }
        
        .test-info div {
            margin: 5px 0;
        }
        
        .status-ok {
            color: #4ade80;
        }
        
        .status-error {
            color: #f87171;
        }
        
        .status-warning {
            color: #fbbf24;
        }
    </style>
</head>
<body>
    <div class="test-info" id="testInfo">
        <button onclick="document.getElementById('testInfo').style.display='none'" style="position: absolute; top: 5px; right: 5px; background: none; border: none; color: white; cursor: pointer; font-size: 20px;">√ó</button>
        <h3>üîç Ë¶ñË®äÈ°ØÁ§∫Ê∏¨Ë©¶</h3>
        <div>‰º∫ÊúçÂô®: <span class="status-ok">Port 5500</span></div>
        <div id="domStatus">DOMÁãÄÊÖã: <span>Ê™¢Êü•‰∏≠...</span></div>
        <div id="playerStatus">Êí≠ÊîæÂô®ÁãÄÊÖã: <span>Êú™ÂàùÂßãÂåñ</span></div>
        <div id="uiStatus">UIÁãÄÊÖã: <span>Êú™ÂàùÂßãÂåñ</span></div>
        <div id="elementStatus">ÂÖÉÁ¥†ÁãÄÊÖã: <span>Ê™¢Êü•‰∏≠...</span></div>
    </div>

    <!-- Ë§áË£Ω video.html ÁöÑ‰∏ªË¶ÅÁµêÊßã -->
    <div id="video-app">
        <header class="app-header">
            <div class="container">
                <h1 class="app-title">Ë¶ñË®äÊí≠ÊîæÂô®Ê∏¨Ë©¶</h1>
            </div>
        </header>

        <main class="video-main">
            <div class="video-layout">
                <section class="video-section">
                    <!-- ‰∏äÂÇ≥ÂçÄÂüü -->
                    <div class="video-upload-area" id="videoUploadArea">
                        <div class="upload-content">
                            <span class="upload-icon">üé¨</span>
                            <h2>‰∏äÂÇ≥ÂΩ±ÁâáÊ™îÊ°à</h2>
                            <p>ÊãñÊîæÊ™îÊ°àÂà∞Ê≠§ËôïÔºåÊàñÈªûÊìäÈÅ∏ÊìáÊ™îÊ°à</p>
                            <p class="upload-hint">ÊîØÊè¥Ê†ºÂºèÔºöMP4„ÄÅWebM„ÄÅOGV</p>
                            <input type="file" id="videoInput" accept="video/*" hidden>
                            <button class="btn btn-primary" id="selectVideoBtn">ÈÅ∏ÊìáÊ™îÊ°à</button>
                        </div>
                    </div>

                    <!-- Ë¶ñË®äÊí≠ÊîæÂô®ÂÆπÂô® -->
                    <div class="video-player-container hidden" id="videoPlayerContainer">
                        <div class="video-wrapper" id="videoWrapper">
                            <video id="videoPlayer" 
                                   preload="metadata" 
                                   playsinline 
                                   webkit-playsinline></video>
                            
                            <div class="video-loading hidden" id="videoLoading">
                                <div class="loading-spinner"></div>
                                <p class="loading-text">ËºâÂÖ•‰∏≠...</p>
                            </div>
                            
                            <div class="video-controls" id="videoControls">
                                <div class="controls-progress-area">
                                    <div class="progress-container" id="progressContainer">
                                        <div class="progress-buffered" id="progressBuffered"></div>
                                        <div class="progress-played" id="progressPlayed"></div>
                                        <input type="range" id="progressSlider" class="progress-slider" value="0" min="0" max="100" step="0.1">
                                    </div>
                                    <div class="time-display">
                                        <span id="currentTime">00:00</span>
                                        <span class="time-separator">/</span>
                                        <span id="totalTime">00:00</span>
                                    </div>
                                </div>
                                
                                <div class="controls-buttons">
                                    <div class="controls-left">
                                        <button class="control-btn" id="playPauseBtn">
                                            <svg class="icon icon-play" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M8 5v14l11-7z"/>
                                            </svg>
                                            <svg class="icon icon-pause hidden" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                                            </svg>
                                        </button>
                                        
                                        <button class="control-btn" id="skipBackBtn">
                                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"/>
                                            </svg>
                                        </button>
                                        
                                        <button class="control-btn" id="skipForwardBtn">
                                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"/>
                                            </svg>
                                        </button>
                                        
                                        <div class="volume-control">
                                            <button class="control-btn" id="muteBtn">
                                                <svg class="icon icon-volume" viewBox="0 0 24 24" fill="currentColor">
                                                    <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                                                </svg>
                                                <svg class="icon icon-mute hidden" viewBox="0 0 24 24" fill="currentColor">
                                                    <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>
                                                </svg>
                                            </button>
                                            <input type="range" id="volumeSlider" class="volume-slider" value="100" min="0" max="100">
                                        </div>
                                    </div>
                                    
                                    <div class="controls-right">
                                        <div class="speed-control">
                                            <button class="control-btn" id="speedBtn">
                                                <span class="speed-text">1x</span>
                                            </button>
                                            <div class="speed-menu hidden" id="speedMenu">
                                                <button class="speed-option" data-speed="0.5">0.5x</button>
                                                <button class="speed-option" data-speed="0.75">0.75x</button>
                                                <button class="speed-option active" data-speed="1">1x</button>
                                                <button class="speed-option" data-speed="1.25">1.25x</button>
                                                <button class="speed-option" data-speed="1.5">1.5x</button>
                                                <button class="speed-option" data-speed="2">2x</button>
                                            </div>
                                        </div>
                                        
                                        <button class="control-btn" id="fullscreenBtn">
                                            <svg class="icon icon-expand" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
                                            </svg>
                                            <svg class="icon icon-compress hidden" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <aside class="side-panel">
                    <div class="panel-tabs">
                        <button class="tab-btn active" data-tab="info">ÂΩ±ÁâáË≥áË®ä</button>
                    </div>
                    <div class="panel-content active" id="infoPanel">
                        <div class="video-info">
                            <h3>ÂΩ±ÁâáË≥áË®ä</h3>
                            <div class="info-item">
                                <span class="info-label">Ê™îÊ°àÂêçÁ®±Ôºö</span>
                                <span class="info-value" id="videoFileName">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Ê™îÊ°àÂ§ßÂ∞èÔºö</span>
                                <span class="info-value" id="videoFileSize">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ÂΩ±ÁâáÈï∑Â∫¶Ôºö</span>
                                <span class="info-value" id="videoDuration">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Ëß£ÊûêÂ∫¶Ôºö</span>
                                <span class="info-value" id="videoResolution">-</span>
                            </div>
                        </div>
                    </div>
                </aside>
            </div>
        </main>
    </div>

    <script type="module">
        import domReadyManager from './js/video/dom-ready-manager.js';
        import { VideoPlayer } from './js/video/video-player.js';
        import { VideoUI } from './js/video/video-ui.js';
        
        const testInfo = {
            updateDOMStatus: (status, type = 'ok') => {
                const span = document.querySelector('#domStatus span');
                span.textContent = status;
                span.className = `status-${type}`;
            },
            updatePlayerStatus: (status, type = 'ok') => {
                const span = document.querySelector('#playerStatus span');
                span.textContent = status;
                span.className = `status-${type}`;
            },
            updateUIStatus: (status, type = 'ok') => {
                const span = document.querySelector('#uiStatus span');
                span.textContent = status;
                span.className = `status-${type}`;
            },
            updateElementStatus: (status, type = 'ok') => {
                const span = document.querySelector('#elementStatus span');
                span.textContent = status;
                span.className = `status-${type}`;
            }
        };
        
        async function initializeTest() {
            console.log('ÈñãÂßãÊ∏¨Ë©¶ÂàùÂßãÂåñ...');
            
            try {
                // Á≠âÂæÖ DOM
                testInfo.updateDOMStatus('Á≠âÂæÖ‰∏≠...', 'warning');
                await domReadyManager.waitForReady(5000);
                testInfo.updateDOMStatus('Â∑≤Â∞±Á∑í', 'ok');
                
                // Ê™¢Êü•ÈóúÈçµÂÖÉÁ¥†
                const elementsToCheck = [
                    'videoPlayerContainer',
                    'videoUploadArea',
                    'videoWrapper',
                    'videoControls',
                    'videoPlayer'
                ];
                
                let missingElements = [];
                for (const id of elementsToCheck) {
                    if (!document.getElementById(id)) {
                        missingElements.push(id);
                    }
                }
                
                if (missingElements.length > 0) {
                    testInfo.updateElementStatus(`Áº∫Â∞ë: ${missingElements.join(', ')}`, 'error');
                } else {
                    testInfo.updateElementStatus('ÊâÄÊúâÂÖÉÁ¥†Â≠òÂú®', 'ok');
                }
                
                // ÂàùÂßãÂåñÊí≠ÊîæÂô®
                testInfo.updatePlayerStatus('ÂàùÂßãÂåñ‰∏≠...', 'warning');
                const videoElement = document.getElementById('videoPlayer');
                const player = new VideoPlayer(videoElement);
                testInfo.updatePlayerStatus('Â∑≤ÂàùÂßãÂåñ', 'ok');
                
                // ÂàùÂßãÂåñ UI
                testInfo.updateUIStatus('ÂàùÂßãÂåñ‰∏≠...', 'warning');
                const ui = new VideoUI(player);
                const result = await ui.initialize();
                
                if (result.success) {
                    testInfo.updateUIStatus('Â∑≤ÂàùÂßãÂåñ', 'ok');
                } else {
                    testInfo.updateUIStatus(`Â§±Êïó: ${result.error}`, 'error');
                    console.error('UIÂàùÂßãÂåñÂ§±Êïó:', result);
                }
                
                // Á∂ÅÂÆöÊ™îÊ°àÈÅ∏Êìá
                const fileInput = document.getElementById('videoInput');
                const selectBtn = document.getElementById('selectVideoBtn');
                const uploadArea = document.getElementById('videoUploadArea');
                
                selectBtn.addEventListener('click', () => fileInput.click());
                
                fileInput.addEventListener('change', async (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    console.log('ËºâÂÖ•Ê™îÊ°à:', file.name);
                    
                    try {
                        testInfo.updatePlayerStatus('ËºâÂÖ•Ë¶ñË®ä‰∏≠...', 'warning');
                        await player.loadFile(file);
                        testInfo.updatePlayerStatus('Ë¶ñË®äÂ∑≤ËºâÂÖ•', 'ok');
                        
                        // È°ØÁ§∫Êí≠ÊîæÂô®
                        console.log('È°ØÁ§∫Êí≠ÊîæÂô®‰ªãÈù¢...');
                        ui.showPlayer();
                        
                        // Ê™¢Êü•È°ØÁ§∫ÁãÄÊÖã
                        const playerContainer = document.getElementById('videoPlayerContainer');
                        const uploadArea = document.getElementById('videoUploadArea');
                        const controls = document.getElementById('videoControls');
                        
                        if (!playerContainer.classList.contains('hidden')) {
                            console.log('‚úÖ Êí≠ÊîæÂô®ÂÆπÂô®Â∑≤È°ØÁ§∫');
                            testInfo.updateUIStatus('Êí≠ÊîæÂô®Â∑≤È°ØÁ§∫', 'ok');
                        } else {
                            console.error('‚ùå Êí≠ÊîæÂô®ÂÆπÂô®‰ªçÁÑ∂Èö±Ëóè');
                            testInfo.updateUIStatus('Êí≠ÊîæÂô®Êú™È°ØÁ§∫', 'error');
                        }
                        
                        if (controls) {
                            const opacity = window.getComputedStyle(controls).opacity;
                            console.log(`ÊéßÂà∂Ê¨Ñ opacity: ${opacity}`);
                            if (opacity === '1') {
                                console.log('‚úÖ ÊéßÂà∂Ê¨ÑÂèØË¶ã');
                            } else {
                                console.warn('‚ö†Ô∏è ÊéßÂà∂Ê¨ÑÂèØËÉΩ‰∏çÂèØË¶ã');
                            }
                        }
                        
                    } catch (error) {
                        console.error('ËºâÂÖ•Ë¶ñË®äÂ§±Êïó:', error);
                        testInfo.updatePlayerStatus(`ËºâÂÖ•Â§±Êïó: ${error.message}`, 'error');
                    }
                });
                
                // ÊãñÊîæÊîØÊè¥
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('drag-over');
                });
                
                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('drag-over');
                });
                
                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('drag-over');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        fileInput.files = files;
                        fileInput.dispatchEvent(new Event('change'));
                    }
                });
                
                console.log('Ê∏¨Ë©¶Áí∞Â¢ÉÂ∑≤Ê∫ñÂÇôÂ∞±Á∑í');
                
            } catch (error) {
                console.error('ÂàùÂßãÂåñÂ§±Êïó:', error);
                testInfo.updateUIStatus(`ÂàùÂßãÂåñÂ§±Êïó: ${error.message}`, 'error');
            }
        }
        
        // ÈñãÂßãÂàùÂßãÂåñ
        initializeTest();
        
        // Êèê‰æõÂÖ®ÂüüÂ≠òÂèñ
        window.testVideoDisplay = {
            checkElements: () => {
                const elements = [
                    'videoPlayerContainer',
                    'videoUploadArea', 
                    'videoWrapper',
                    'videoControls'
                ];
                
                elements.forEach(id => {
                    const el = document.getElementById(id);
                    console.log(`${id}:`, el ? 'Found' : 'Missing', el?.classList.contains('hidden') ? '(hidden)' : '');
                });
            },
            
            showPlayer: () => {
                const playerContainer = document.getElementById('videoPlayerContainer');
                const uploadArea = document.getElementById('videoUploadArea');
                
                playerContainer?.classList.remove('hidden');
                uploadArea?.classList.add('hidden');
                
                console.log('ÊâãÂãïÈ°ØÁ§∫Êí≠ÊîæÂô®ÂÆåÊàê');
            }
        };
    </script>
</body>
</html>