ğŸ“‹ è¦–è¨Šæ’­æ”¾å™¨é–‹ç™¼å¯¦è¸æ­¥é©Ÿï¼ˆ2é€±ï¼‰
å‰ç½®æº–å‚™
Step 1: å»ºç«‹è¦–è¨Šç›¸é—œæª”æ¡ˆçµæ§‹
bash# å»ºç«‹ç›®éŒ„
mkdir js/video

# å»ºç«‹æª”æ¡ˆ
touch video.html
touch css/video.css
touch js/video/video-main.js
touch js/video/video-player.js
touch js/video/subtitle-manager.js
touch js/video/bookmark-manager.js
Day 8-9: åŸºç¤è¦–è¨Šæ’­æ”¾å™¨
Day 8 ä¸Šåˆï¼šå»ºç«‹è¦–è¨Šé é¢çµæ§‹ï¼ˆ2å°æ™‚ï¼‰
Step 2: å»ºç«‹ video.html
html<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Whisper è¦–è¨Šå·¥å…· - æ”¯æ´å­—å¹•æœå°‹èˆ‡æ™‚é–“æ¨™è¨˜çš„å°ˆæ¥­å½±ç‰‡æ’­æ”¾å™¨">
    <title>è¦–è¨Šæ’­æ”¾å™¨ - Whisper å·¥å…·</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/shared.css">
    <link rel="stylesheet" href="css/video.css">
</head>
<body>
    <div id="video-app">
        <!-- å°èˆªåˆ— -->
        <nav class="app-navigation">
            <div class="nav-container">
                <div class="nav-brand">
                    <h1 class="nav-title">Whisper å·¥å…·</h1>
                </div>
                <div class="nav-links">
                    <a href="index.html" class="nav-link">
                        <span class="nav-icon">ğŸµ</span>
                        <span>éŸ³è¨Šå·¥å…·</span>
                    </a>
                    <a href="video.html" class="nav-link active">
                        <span class="nav-icon">ğŸ¬</span>
                        <span>è¦–è¨Šå·¥å…·</span>
                    </a>
                </div>
            </div>
        </nav>

        <!-- ä¸»è¦å…§å®¹ -->
        <main class="video-main">
            <div class="video-layout">
                <!-- å·¦å´ï¼šè¦–è¨Šæ’­æ”¾å€ -->
                <section class="video-section">
                    <!-- ä¸Šå‚³å€åŸŸ -->
                    <div class="video-upload-area" id="videoUploadArea">
                        <div class="upload-content">
                            <span class="upload-icon">ğŸ¬</span>
                            <h2>ä¸Šå‚³å½±ç‰‡æª”æ¡ˆ</h2>
                            <p>æ‹–æ”¾æª”æ¡ˆåˆ°æ­¤è™•ï¼Œæˆ–é»æ“Šé¸æ“‡æª”æ¡ˆ</p>
                            <p class="upload-hint">æ”¯æ´æ ¼å¼ï¼šMP4ã€WebMï¼ˆå»ºè­°å°æ–¼ 2GBï¼‰</p>
                            <input type="file" id="videoInput" accept="video/*" hidden>
                            <button class="btn btn-primary" id="selectVideoBtn">é¸æ“‡æª”æ¡ˆ</button>
                        </div>
                    </div>

                    <!-- è¦–è¨Šæ’­æ”¾å™¨ -->
                    <div class="video-player-container" id="videoPlayerContainer" style="display: none;">
                        <div class="video-wrapper">
                            <video id="videoPlayer" controls></video>
                            
                            <!-- è‡ªå®šç¾©æ§åˆ¶åˆ— -->
                            <div class="video-controls" id="videoControls">
                                <div class="controls-progress">
                                    <input type="range" id="videoProgress" class="progress-bar" value="0" min="0" max="100">
                                    <div class="time-display">
                                        <span id="currentVideoTime">00:00</span> / <span id="totalVideoTime">00:00</span>
                                    </div>
                                </div>
                                
                                <div class="controls-buttons">
                                    <button class="control-btn" id="playPauseBtn" title="æ’­æ”¾/æš«åœ">
                                        <span class="icon">â–¶ï¸</span>
                                    </button>
                                    <button class="control-btn" id="skipBackBtn" title="å¿«é€€ 5 ç§’">
                                        <span class="icon">âª</span>
                                    </button>
                                    <button class="control-btn" id="skipForwardBtn" title="å¿«é€² 5 ç§’">
                                        <span class="icon">â©</span>
                                    </button>
                                    
                                    <div class="speed-control">
                                        <select id="videoSpeedSelect">
                                            <option value="0.5">0.5x</option>
                                            <option value="0.75">0.75x</option>
                                            <option value="1" selected>1.0x</option>
                                            <option value="1.25">1.25x</option>
                                            <option value="1.5">1.5x</option>
                                            <option value="2">2.0x</option>
                                        </select>
                                    </div>
                                    
                                    <button class="control-btn" id="fullscreenBtn" title="å…¨è¢å¹•">
                                        <span class="icon">â›¶</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- å³å´ï¼šåŠŸèƒ½é¢æ¿ -->
                <aside class="side-panel">
                    <!-- æ¨™ç±¤åˆ‡æ› -->
                    <div class="panel-tabs">
                        <button class="tab-btn active" data-tab="subtitles">å­—å¹•æœå°‹</button>
                        <button class="tab-btn" data-tab="bookmarks">æ™‚é–“æ¨™è¨˜</button>
                    </div>

                    <!-- å­—å¹•é¢æ¿ -->
                    <div class="panel-content active" id="subtitlesPanel">
                        <div class="search-container">
                            <input type="text" id="subtitleSearchInput" placeholder="æœå°‹å­—å¹•å…§å®¹...">
                            <button class="search-btn" id="subtitleSearchBtn">ğŸ”</button>
                        </div>
                        
                        <div class="subtitle-status" id="subtitleStatus">
                            <p>è«‹å…ˆè¼‰å…¥å½±ç‰‡ä»¥æå–å­—å¹•</p>
                        </div>
                        
                        <div class="search-results" id="searchResults" style="display: none;">
                            <!-- æœå°‹çµæœå°‡é¡¯ç¤ºåœ¨é€™è£¡ -->
                        </div>
                    </div>

                    <!-- æ¨™è¨˜é¢æ¿ -->
                    <div class="panel-content" id="bookmarksPanel" style="display: none;">
                        <div class="bookmark-controls">
                            <button class="btn btn-primary" id="addBookmarkBtn">
                                <span>â•</span> æ–°å¢æ¨™è¨˜
                            </button>
                        </div>
                        
                        <div class="bookmarks-list" id="bookmarksList">
                            <!-- æ¨™è¨˜åˆ—è¡¨å°‡é¡¯ç¤ºåœ¨é€™è£¡ -->
                        </div>
                    </div>
                </aside>
            </div>
        </main>

        <!-- æ¨™è¨˜ç·¨è¼¯ Modal -->
        <div class="modal" id="bookmarkModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>ç·¨è¼¯æ™‚é–“æ¨™è¨˜</h2>
                    <button class="modal-close" id="bookmarkModalClose">âœ•</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>æ™‚é–“é»ï¼š<span id="bookmarkTime">00:00</span></label>
                    </div>
                    <div class="form-group">
                        <label for="bookmarkTitle">æ¨™é¡Œï¼š</label>
                        <input type="text" id="bookmarkTitle" placeholder="è¼¸å…¥æ¨™è¨˜æ¨™é¡Œ">
                    </div>
                    <div class="form-group">
                        <label for="bookmarkNote">ç­†è¨˜ï¼š</label>
                        <textarea id="bookmarkNote" rows="4" placeholder="è¼¸å…¥è©³ç´°ç­†è¨˜..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="bookmarkCategory">åˆ†é¡ï¼š</label>
                        <select id="bookmarkCategory">
                            <option value="general">ä¸€èˆ¬</option>
                            <option value="important">é‡è¦</option>
                            <option value="question">å•é¡Œ</option>
                            <option value="error">éŒ¯èª¤</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelBookmarkBtn">å–æ¶ˆ</button>
                    <button class="btn btn-primary" id="saveBookmarkBtn">å„²å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="js/video/video-main.js"></script>
</body>
</html>
Day 8 ä¸‹åˆï¼šè¦–è¨Šæ’­æ”¾å™¨æ¨£å¼ï¼ˆ2å°æ™‚ï¼‰
Step 3: å»ºç«‹ video.css
css/* è¦–è¨Šé é¢å°ˆç”¨æ¨£å¼ */
.video-main {
  padding: var(--spacing-lg);
  max-width: 1600px;
  margin: 0 auto;
}

.video-layout {
  display: grid;
  grid-template-columns: 1fr 400px;
  gap: var(--spacing-lg);
  height: calc(100vh - 120px);
}

/* è¦–è¨Šæ’­æ”¾å€åŸŸ */
.video-section {
  display: flex;
  flex-direction: column;
  background-color: var(--bg-secondary);
  border-radius: var(--radius-lg);
  overflow: hidden;
}

.video-upload-area {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px dashed var(--border-color);
  margin: var(--spacing-lg);
  border-radius: var(--radius-lg);
  transition: all 0.3s;
  cursor: pointer;
}

.video-upload-area:hover,
.video-upload-area.drag-over {
  border-color: var(--primary-color);
  background-color: var(--bg-tertiary);
}

/* è¦–è¨Šæ’­æ”¾å™¨ */
.video-player-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: var(--spacing-lg);
}

.video-wrapper {
  position: relative;
  background-color: #000;
  border-radius: var(--radius-md);
  overflow: hidden;
  flex: 1;
}

#videoPlayer {
  width: 100%;
  height: 100%;
  display: block;
}

/* è‡ªå®šç¾©æ§åˆ¶åˆ— */
.video-controls {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
  padding: var(--spacing-lg) var(--spacing-md) var(--spacing-md);
  opacity: 0;
  transition: opacity 0.3s;
}

.video-wrapper:hover .video-controls,
.video-controls:hover {
  opacity: 1;
}

.controls-progress {
  margin-bottom: var(--spacing-sm);
}

.controls-buttons {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
}

/* å´é‚Šé¢æ¿ */
.side-panel {
  background-color: var(--bg-secondary);
  border-radius: var(--radius-lg);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.panel-tabs {
  display: flex;
  border-bottom: 1px solid var(--border-color);
}

.tab-btn {
  flex: 1;
  padding: var(--spacing-md);
  background: none;
  border: none;
  cursor: pointer;
  color: var(--text-secondary);
  font-weight: 500;
  transition: all 0.2s;
}

.tab-btn.active {
  color: var(--primary-color);
  border-bottom: 2px solid var(--primary-color);
}

.panel-content {
  flex: 1;
  padding: var(--spacing-lg);
  overflow-y: auto;
}

/* æœå°‹åŠŸèƒ½ */
.search-container {
  display: flex;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-lg);
}

.search-container input {
  flex: 1;
  padding: var(--spacing-sm) var(--spacing-md);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  background-color: var(--bg-primary);
}

/* æœå°‹çµæœ */
.search-result-item {
  padding: var(--spacing-md);
  margin-bottom: var(--spacing-sm);
  background-color: var(--bg-tertiary);
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: all 0.2s;
}

.search-result-item:hover {
  background-color: var(--bg-primary);
  transform: translateX(4px);
}

.result-time {
  font-size: 0.875rem;
  color: var(--primary-color);
  font-weight: 500;
}

.result-text {
  margin-top: var(--spacing-xs);
  color: var(--text-primary);
}

.result-text mark {
  background-color: #fbbf24;
  color: #1f2937;
  padding: 0 2px;
  border-radius: 2px;
}

/* æ¨™è¨˜åˆ—è¡¨ */
.bookmark-item {
  padding: var(--spacing-md);
  margin-bottom: var(--spacing-sm);
  background-color: var(--bg-tertiary);
  border-radius: var(--radius-md);
  position: relative;
}

.bookmark-header {
  display: flex;
  justify-content: space-between;
  align-items: start;
  margin-bottom: var(--spacing-sm);
}

.bookmark-time {
  color: var(--primary-color);
  font-weight: 500;
  cursor: pointer;
}

.bookmark-category {
  display: inline-block;
  padding: 2px 8px;
  font-size: 0.75rem;
  border-radius: var(--radius-sm);
  background-color: var(--bg-primary);
}

.bookmark-category.important {
  background-color: #fee2e2;
  color: #dc2626;
}

.bookmark-category.question {
  background-color: #dbeafe;
  color: #2563eb;
}

.bookmark-category.error {
  background-color: #fef3c7;
  color: #d97706;
}

.bookmark-title {
  font-weight: 500;
  margin-bottom: var(--spacing-xs);
}

.bookmark-note {
  font-size: 0.875rem;
  color: var(--text-secondary);
  line-height: 1.5;
}

.bookmark-actions {
  display: flex;
  gap: var(--spacing-sm);
  margin-top: var(--spacing-sm);
}

.bookmark-actions button {
  padding: var(--spacing-xs) var(--spacing-sm);
  font-size: 0.875rem;
  background-color: var(--bg-primary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all 0.2s;
}

.bookmark-actions button:hover {
  background-color: var(--bg-secondary);
}

/* éŸ¿æ‡‰å¼è¨­è¨ˆ */
@media (max-width: 1200px) {
  .video-layout {
    grid-template-columns: 1fr;
    height: auto;
  }
  
  .side-panel {
    height: 400px;
  }
}

/* å…¨è¢å¹•æ¨£å¼ */
.video-wrapper.fullscreen {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 9999;
  border-radius: 0;
}

.video-wrapper.fullscreen .video-controls {
  opacity: 1;
}
Day 9 ä¸Šåˆï¼šè¦–è¨Šæ’­æ”¾å™¨æ ¸å¿ƒåŠŸèƒ½ï¼ˆ2å°æ™‚ï¼‰
Step 4: å»ºç«‹ video-player.js
javascript// js/video/video-player.js
export class VideoPlayer {
  constructor(videoElement) {
    this.video = videoElement;
    this.container = videoElement.parentElement;
    this.currentFile = null;
    this.isPlaying = false;
    
    // æ§åˆ¶å…ƒç´ 
    this.controls = {
      playPause: document.getElementById('playPauseBtn'),
      progress: document.getElementById('videoProgress'),
      currentTime: document.getElementById('currentVideoTime'),
      totalTime: document.getElementById('totalVideoTime'),
      skipBack: document.getElementById('skipBackBtn'),
      skipForward: document.getElementById('skipForwardBtn'),
      speed: document.getElementById('videoSpeedSelect'),
      fullscreen: document.getElementById('fullscreenBtn')
    };
    
    this.skipSeconds = 5;
    this.init();
  }
  
  init() {
    this.bindEvents();
    this.setupKeyboardShortcuts();
  }
  
  bindEvents() {
    // æ’­æ”¾æ§åˆ¶
    this.controls.playPause.addEventListener('click', () => this.togglePlayPause());
    this.controls.skipBack.addEventListener('click', () => this.skip(-this.skipSeconds));
    this.controls.skipForward.addEventListener('click', () => this.skip(this.skipSeconds));
    
    // é€²åº¦æ§åˆ¶
    this.controls.progress.addEventListener('input', (e) => {
      const time = (e.target.value / 100) * this.video.duration;
      this.video.currentTime = time;
    });
    
    // é€Ÿåº¦æ§åˆ¶
    this.controls.speed.addEventListener('change', (e) => {
      this.video.playbackRate = parseFloat(e.target.value);
    });
    
    // å…¨è¢å¹•
    this.controls.fullscreen.addEventListener('click', () => this.toggleFullscreen());
    
    // è¦–è¨Šäº‹ä»¶
    this.video.addEventListener('loadedmetadata', () => this.handleLoadedMetadata());
    this.video.addEventListener('timeupdate', () => this.handleTimeUpdate());
    this.video.addEventListener('play', () => this.handlePlay());
    this.video.addEventListener('pause', () => this.handlePause());
    this.video.addEventListener('ended', () => this.handleEnded());
    
    // åŸç”Ÿæ§åˆ¶åˆ—éš±è—ï¼ˆä½¿ç”¨è‡ªå®šç¾©æ§åˆ¶åˆ—ï¼‰
    this.video.controls = false;
  }
  
  setupKeyboardShortcuts() {
    document.addEventListener('keydown', (e) => {
      // å¿½ç•¥è¼¸å…¥æ¡†ä¸­çš„æŒ‰éµ
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
      
      switch(e.key) {
        case ' ':
          e.preventDefault();
          this.togglePlayPause();
          break;
        case 'ArrowLeft':
          this.skip(-this.skipSeconds);
          break;
        case 'ArrowRight':
          this.skip(this.skipSeconds);
          break;
        case 'ArrowUp':
          e.preventDefault();
          this.changeVolume(0.1);
          break;
        case 'ArrowDown':
          e.preventDefault();
          this.changeVolume(-0.1);
          break;
        case 'f':
        case 'F':
          this.toggleFullscreen();
          break;
      }
    });
  }
  
  loadFile(file) {
    return new Promise((resolve, reject) => {
      // é©—è­‰æª”æ¡ˆé¡å‹
      if (!file.type.startsWith('video/')) {
        reject(new Error('è«‹é¸æ“‡æœ‰æ•ˆçš„è¦–è¨Šæª”æ¡ˆ'));
        return;
      }
      
      // æª¢æŸ¥æª”æ¡ˆå¤§å°ï¼ˆå»ºè­°å°æ–¼ 2GBï¼‰
      const maxSize = 2 * 1024 * 1024 * 1024;
      if (file.size > maxSize) {
        const sizeMB = Math.round(file.size / 1024 / 1024);
        if (!confirm(`æª”æ¡ˆå¤§å°ç‚º ${sizeMB}MBï¼Œå¯èƒ½æœƒå½±éŸ¿æ•ˆèƒ½ã€‚æ˜¯å¦ç¹¼çºŒï¼Ÿ`)) {
          reject(new Error('æª”æ¡ˆå¤ªå¤§'));
          return;
        }
      }
      
      this.currentFile = file;
      const url = URL.createObjectURL(file);
      
      this.video.src = url;
      this.video.load();
      
      // ç­‰å¾…è¼‰å…¥å®Œæˆ
      this.video.addEventListener('loadeddata', () => {
        resolve({
          name: file.name,
          size: file.size,
          duration: this.video.duration
        });
      }, { once: true });
      
      this.video.addEventListener('error', (e) => {
        reject(new Error('è¦–è¨Šè¼‰å…¥å¤±æ•—'));
      }, { once: true });
    });
  }
  
  togglePlayPause() {
    if (this.video.paused) {
      this.play();
    } else {
      this.pause();
    }
  }
  
  play() {
    this.video.play();
  }
  
  pause() {
    this.video.pause();
  }
  
  skip(seconds) {
    this.video.currentTime = Math.max(0, Math.min(
      this.video.currentTime + seconds,
      this.video.duration
    ));
  }
  
  changeVolume(delta) {
    this.video.volume = Math.max(0, Math.min(1, this.video.volume + delta));
  }
  
  toggleFullscreen() {
    if (!document.fullscreenElement) {
      this.container.requestFullscreen().catch(err => {
        console.error('ç„¡æ³•é€²å…¥å…¨è¢å¹•:', err);
      });
      this.container.classList.add('fullscreen');
    } else {
      document.exitFullscreen();
      this.container.classList.remove('fullscreen');
    }
  }
  
  handleLoadedMetadata() {
    this.controls.totalTime.textContent = this.formatTime(this.video.duration);
    this.controls.progress.max = 100;
    
    // é€šçŸ¥å­—å¹•ç®¡ç†å™¨æª¢æŸ¥å­—å¹•
    const event = new CustomEvent('videoLoaded', {
      detail: { video: this.video }
    });
    document.dispatchEvent(event);
  }
  
  handleTimeUpdate() {
    const progress = (this.video.currentTime / this.video.duration) * 100;
    this.controls.progress.value = progress;
    this.controls.currentTime.textContent = this.formatTime(this.video.currentTime);
  }
  
  handlePlay() {
    this.isPlaying = true;
    this.updatePlayButton();
  }
  
  handlePause() {
    this.isPlaying = false;
    this.updatePlayButton();
  }
  
  handleEnded() {
    this.isPlaying = false;
    this.updatePlayButton();
  }
  
  updatePlayButton() {
    const icon = this.controls.playPause.querySelector('.icon');
    icon.textContent = this.isPlaying ? 'â¸ï¸' : 'â–¶ï¸';
  }
  
  formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  }
  
  getCurrentTime() {
    return this.video.currentTime;
  }
  
  seekTo(time) {
    this.video.currentTime = time;
  }
}
Day 9 ä¸‹åˆï¼šä¸»ç¨‹å¼æ•´åˆï¼ˆ2å°æ™‚ï¼‰
Step 5: å»ºç«‹ video-main.js
javascript// js/video/video-main.js
import { VideoPlayer } from './video-player.js';
import { SubtitleManager } from './subtitle-manager.js';
import { BookmarkManager } from './bookmark-manager.js';

class VideoApp {
  constructor() {
    this.player = null;
    this.subtitleManager = null;
    this.bookmarkManager = null;
    this.currentProject = null;
    
    this.init();
  }
  
  init() {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => this.setup());
    } else {
      this.setup();
    }
  }
  
  setup() {
    // åˆå§‹åŒ–æ’­æ”¾å™¨
    const videoElement = document.getElementById('videoPlayer');
    this.player = new VideoPlayer(videoElement);
    
    // åˆå§‹åŒ–å­—å¹•ç®¡ç†å™¨
    this.subtitleManager = new SubtitleManager(videoElement);
    
    // åˆå§‹åŒ–æ¨™è¨˜ç®¡ç†å™¨
    this.bookmarkManager = new BookmarkManager();
    
    // ç¶å®š UI äº‹ä»¶
    this.bindUIEvents();
    
    // è¼‰å…¥ä¸Šæ¬¡çš„å°ˆæ¡ˆï¼ˆå¦‚æœæœ‰ï¼‰
    this.loadLastProject();
  }
  
  bindUIEvents() {
    // æª”æ¡ˆé¸æ“‡
    const selectBtn = document.getElementById('selectVideoBtn');
    const fileInput = document.getElementById('videoInput');
    const uploadArea = document.getElementById('videoUploadArea');
    
    selectBtn.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', (e) => this.handleFileSelect(e.target.files));
    
    // æ‹–æ”¾
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('drag-over');
    });
    
    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('drag-over');
    });
    
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('drag-over');
      this.handleFileSelect(e.dataTransfer.files);
    });
    
    // æ¨™ç±¤åˆ‡æ›
    const tabBtns = document.querySelectorAll('.tab-btn');
    tabBtns.forEach(btn => {
      btn.addEventListener('click', () => this.switchTab(btn.dataset.tab));
    });
    
    // å­—å¹•æœå°‹
    const searchInput = document.getElementById('subtitleSearchInput');
    const searchBtn = document.getElementById('subtitleSearchBtn');
    
    searchBtn.addEventListener('click', () => this.handleSearch());
    searchInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') this.handleSearch();
    });
    
    // æ¨™è¨˜åŠŸèƒ½
    const addBookmarkBtn = document.getElementById('addBookmarkBtn');
    addBookmarkBtn.addEventListener('click', () => this.showBookmarkModal());
    
    // Modal æ§åˆ¶
    this.setupModalControls();
    
    // ç›£è½è‡ªå®šç¾©äº‹ä»¶
    document.addEventListener('subtitleClick', (e) => {
      this.player.seekTo(e.detail.time);
    });
    
    document.addEventListener('bookmarkClick', (e) => {
      this.player.seekTo(e.detail.time);
    });
  }
  
  async handleFileSelect(files) {
    if (files.length === 0) return;
    
    try {
      const file = files[0];
      const info = await this.player.loadFile(file);
      
      // é¡¯ç¤ºæ’­æ”¾å™¨
      document.getElementById('videoUploadArea').style.display = 'none';
      document.getElementById('videoPlayerContainer').style.display = 'flex';
      
      // å»ºç«‹/æ›´æ–°å°ˆæ¡ˆ
      this.currentProject = {
        id: `video_${Date.now()}`,
        fileName: file.name,
        fileSize: file.size,
        duration: info.duration,
        lastPlayed: new Date().toISOString()
      };
      
      // æª¢æŸ¥å­—å¹•
      this.subtitleManager.checkForSubtitles();
      
      // å„²å­˜å°ˆæ¡ˆ
      this.saveProject();
      
    } catch (error) {
      this.showError(error.message);
    }
  }
  
  switchTab(tabName) {
    // æ›´æ–°æ¨™ç±¤æŒ‰éˆ•
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.tab === tabName);
    });
    
    // åˆ‡æ›é¢æ¿
    document.getElementById('subtitlesPanel').style.display = 
      tabName === 'subtitles' ? 'block' : 'none';
    document.getElementById('bookmarksPanel').style.display = 
      tabName === 'bookmarks' ? 'block' : 'none';
  }
  
  handleSearch() {
    const query = document.getElementById('subtitleSearchInput').value.trim();
    if (!query) return;
    
    const results = this.subtitleManager.search(query);
    this.displaySearchResults(results);
  }
  
  displaySearchResults(results) {
    const container = document.getElementById('searchResults');
    container.innerHTML = '';
    
    if (results.length === 0) {
      container.innerHTML = '<p class="no-results">æ²’æœ‰æ‰¾åˆ°ç›¸ç¬¦çš„çµæœ</p>';
    } else {
      results.forEach(result => {
        const item = document.createElement('div');
        item.className = 'search-result-item';
        item.innerHTML = `
          <div class="result-time">${this.formatTime(result.startTime)}</div>
          <div class="result-text">${this.highlightText(result.text, result.query)}</div>
        `;
        item.addEventListener('click', () => {
          this.player.seekTo(result.startTime);
        });
        container.appendChild(item);
      });
    }
    
    container.style.display = 'block';
  }
  
  highlightText(text, query) {
    const regex = new RegExp(`(${query})`, 'gi');
    return text.replace(regex, '<mark>$1</mark>');
  }
  
  showBookmarkModal(bookmark = null) {
    const modal = document.getElementById('bookmarkModal');
    const timeSpan = document.getElementById('bookmarkTime');
    const titleInput = document.getElementById('bookmarkTitle');
    const noteInput = document.getElementById('bookmarkNote');
    const categorySelect = document.getElementById('bookmarkCategory');
    
    // è¨­å®šæ™‚é–“
    const currentTime = this.player.getCurrentTime();
    timeSpan.textContent = this.formatTime(currentTime);
    
    // å¦‚æœæ˜¯ç·¨è¼¯æ¨¡å¼
    if (bookmark) {
      titleInput.value = bookmark.title;
      noteInput.value = bookmark.note;
      categorySelect.value = bookmark.category;
      modal.dataset.bookmarkId = bookmark.id;
    } else {
      titleInput.value = '';
      noteInput.value = '';
      categorySelect.value = 'general';
      delete modal.dataset.bookmarkId;
    }
    
    modal.style.display = 'flex';
  }
  
  setupModalControls() {
    const modal = document.getElementById('bookmarkModal');
    const closeBtn = document.getElementById('bookmarkModalClose');
    const cancelBtn = document.getElementById('cancelBookmarkBtn');
    const saveBtn = document.getElementById('saveBookmarkBtn');
    
    closeBtn.addEventListener('click', () => this.hideModal(modal));
    cancelBtn.addEventListener('click', () => this.hideModal(modal));
    
    saveBtn.addEventListener('click', () => {
      const bookmark = {
        timestamp: this.player.getCurrentTime(),
        title: document.getElementById('bookmarkTitle').value,
        note: document.getElementById('bookmarkNote').value,
        category: document.getElementById('bookmarkCategory').value
      };
      
      if (modal.dataset.bookmarkId) {
        bookmark.id = modal.dataset.bookmarkId;
        this.bookmarkManager.updateBookmark(bookmark);
      } else {
        this.bookmarkManager.addBookmark(bookmark);
      }
      
      this.hideModal(modal);
    });
    
    // é»æ“Šå¤–éƒ¨é—œé–‰
    modal.addEventListener('click', (e) => {
      if (e.target === modal) this.hideModal(modal);
    });
  }
  
  hideModal(modal) {
    modal.style.display = 'none';
  }
  
  formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  }
  
  saveProject() {
    if (!this.currentProject) return;
    
    // æ•´åˆæ‰€æœ‰è³‡æ–™
    this.currentProject.subtitles = this.subtitleManager.getSubtitleInfo();
    this.currentProject.bookmarks = this.bookmarkManager.getAllBookmarks();
    
    // å„²å­˜åˆ° localStorageï¼ˆæš«æ™‚ï¼‰
    const key = `whisper_video_${this.currentProject.id}`;
    localStorage.setItem(key, JSON.stringify(this.currentProject));
    localStorage.setItem('whisper_lastVideoProject', this.currentProject.id);
  }
  
  loadLastProject() {
    const lastProjectId = localStorage.getItem('whisper_lastVideoProject');
    if (!lastProjectId) return;
    
    const key = `whisper_video_${lastProjectId}`;
    const data = localStorage.getItem(key);
    
    if (data) {
      try {
        this.currentProject = JSON.parse(data);
        // TODO: æ¢å¾©å°ˆæ¡ˆç‹€æ…‹
      } catch (e) {
        console.error('è¼‰å…¥å°ˆæ¡ˆå¤±æ•—:', e);
      }
    }
  }
  
  showError(message) {
    // TODO: å¯¦ä½œæ›´å¥½çš„éŒ¯èª¤æç¤º
    alert(message);
  }
}

// åˆå§‹åŒ–æ‡‰ç”¨
const app = new VideoApp();
window.videoApp = app;
Day 10-11: å­—å¹•åŠŸèƒ½
Day 10ï¼šå­—å¹•æå–èˆ‡ç®¡ç†ï¼ˆ4å°æ™‚ï¼‰
Step 6: å»ºç«‹ subtitle-manager.js
javascript// js/video/subtitle-manager.js
export class SubtitleManager {
  constructor(videoElement) {
    this.video = videoElement;
    this.subtitles = [];
    this.tracks = [];
    this.searchIndex = new Map();
    
    this.init();
  }
  
  init() {
    // ç›£è½è¦–è¨Šè¼‰å…¥äº‹ä»¶
    document.addEventListener('videoLoaded', (e) => {
      this.checkForSubtitles();
    });
  }
  
  checkForSubtitles() {
    // æª¢æŸ¥å…§åµŒå­—å¹•è»Œé“
    const tracks = this.video.textTracks;
    this.tracks = Array.from(tracks);
    
    if (this.tracks.length > 0) {
      this.extractSubtitles();
      this.updateStatus(`æ‰¾åˆ° ${this.tracks.length} å€‹å­—å¹•è»Œé“`);
    } else {
      this.updateStatus('æœªæ‰¾åˆ°å…§åµŒå­—å¹•');
      // TODO: æä¾›è¼‰å…¥å¤–éƒ¨å­—å¹•çš„é¸é …
    }
  }
  
  extractSubtitles() {
    this.subtitles = [];
    
    this.tracks.forEach((track, trackIndex) => {
      // å•Ÿç”¨è»Œé“ä»¥è¼‰å…¥å­—å¹•
      track.mode = 'hidden';
      
      // ç›£è½ cue è®ŠåŒ–
      track.addEventListener('cuechange', () => {
        this.handleCueChange(track);
      });
      
      // æå–æ‰€æœ‰ cues
      if (track.cues) {
        Array.from(track.cues).forEach((cue, cueIndex) => {
          const subtitle = {
            id: `${trackIndex}_${cueIndex}`,
            trackIndex,
            cueIndex,
            startTime: cue.startTime,
            endTime: cue.endTime,
            text: cue.text,
            language: track.language || 'unknown'
          };
          
          this.subtitles.push(subtitle);
          this.indexSubtitle(subtitle);
        });
      }
    });
    
    console.log(`æå–äº† ${this.subtitles.length} æ¢å­—å¹•`);
    this.buildSearchIndex();
  }
  
  indexSubtitle(subtitle) {
    // ç°¡å–®çš„ä¸­æ–‡åˆ†è©
    const words = this.tokenize(subtitle.text);
    
    words.forEach(word => {
      if (!this.searchIndex.has(word)) {
        this.searchIndex.set(word, []);
      }
      this.searchIndex.get(word).push(subtitle);
    });
  }
  
  tokenize(text) {
    // ç§»é™¤æ¨™é»ç¬¦è™Ÿ
    const cleanText = text.replace(/[ï¼Œã€‚ï¼ï¼Ÿã€ï¼›ï¼š""''ï¼ˆï¼‰ã€Šã€‹ã€ã€‘]/g, ' ');
    
    // åˆ†å‰²å–®è©
    const words = cleanText.toLowerCase().split(/\s+/).filter(w => w.length > 0);
    
    // å°ä¸­æ–‡é€²è¡Œç°¡å–®çš„åˆ†è©ï¼ˆ2-4å­—è©ï¼‰
    const chineseWords = [];
    const chineseRegex = /[\u4e00-\u9fa5]+/g;
    let match;
    
    while ((match = chineseRegex.exec(cleanText)) !== null) {
      const chineseText = match[0];
      // ç”Ÿæˆ 2-4 å­—çš„è©çµ„
      for (let len = 2; len <= Math.min(4, chineseText.length); len++) {
        for (let i = 0; i <= chineseText.length - len; i++) {
          chineseWords.push(chineseText.substr(i, len));
        }
      }
    }
    
    return [...words, ...chineseWords];
  }
  
  buildSearchIndex() {
    // å·²åœ¨ indexSubtitle ä¸­å»ºç«‹
    console.log(`å»ºç«‹äº† ${this.searchIndex.size} å€‹ç´¢å¼•è©`);
  }
  
  search(query) {
    const queryWords = this.tokenize(query.toLowerCase());
    const resultMap = new Map();
    
    // æœå°‹æ¯å€‹è©
    queryWords.forEach(word => {
      const matches = this.searchIndex.get(word) || [];
      
      matches.forEach(subtitle => {
        if (!resultMap.has(subtitle.id)) {
          resultMap.set(subtitle.id, {
            ...subtitle,
            score: 0,
            matchedWords: []
          });
        }
        
        const result = resultMap.get(subtitle.id);
        result.score++;
        result.matchedWords.push(word);
      });
    });
    
    // è½‰æ›ç‚ºé™£åˆ—ä¸¦æ’åº
    const results = Array.from(resultMap.values())
      .sort((a, b) => b.score - a.score || a.startTime - b.startTime)
      .map(result => ({
        ...result,
        query
      }));
    
    return results;
  }
  
  handleCueChange(track) {
    // è™•ç†ç•¶å‰å­—å¹•è®ŠåŒ–ï¼ˆå¯ç”¨æ–¼é¡¯ç¤ºç•¶å‰å­—å¹•ï¼‰
    const activeCues = track.activeCues;
    if (activeCues && activeCues.length > 0) {
      const currentSubtitle = activeCues[0].text;
      // TODO: æ›´æ–° UI é¡¯ç¤ºç•¶å‰å­—å¹•
    }
  }
  
  updateStatus(message) {
    const statusEl = document.getElementById('subtitleStatus');
    if (statusEl) {
      statusEl.innerHTML = `<p>${message}</p>`;
    }
  }
  
  getSubtitleInfo() {
    return {
      tracks: this.tracks.map(t => ({
        language: t.language,
        label: t.label,
        kind: t.kind
      })),
      count: this.subtitles.length,
      indexed: this.searchIndex.size > 0
    };
  }
  
  // è¼‰å…¥å¤–éƒ¨å­—å¹•æª”æ¡ˆ
  async loadExternalSubtitle(file) {
    try {
      const text = await file.text();
      const format = this.detectSubtitleFormat(file.name);
      
      let subtitles;
      if (format === 'srt') {
        subtitles = this.parseSRT(text);
      } else if (format === 'vtt') {
        subtitles = this.parseVTT(text);
      } else {
        throw new Error('ä¸æ”¯æ´çš„å­—å¹•æ ¼å¼');
      }
      
      // åŠ å…¥åˆ°ç¾æœ‰å­—å¹•
      const trackIndex = this.tracks.length;
      subtitles.forEach((sub, index) => {
        const subtitle = {
          id: `${trackIndex}_${index}`,
          trackIndex,
          cueIndex: index,
          ...sub,
          language: 'external'
        };
        
        this.subtitles.push(subtitle);
        this.indexSubtitle(subtitle);
      });
      
      this.updateStatus(`æˆåŠŸè¼‰å…¥å¤–éƒ¨å­—å¹•ï¼š${subtitles.length} æ¢`);
      
    } catch (error) {
      console.error('è¼‰å…¥å­—å¹•å¤±æ•—:', error);
      this.updateStatus('è¼‰å…¥å­—å¹•å¤±æ•—ï¼š' + error.message);
    }
  }
  
  detectSubtitleFormat(filename) {
    const ext = filename.split('.').pop().toLowerCase();
    return ext;
  }
  
  parseSRT(srtText) {
    const subtitles = [];
    const blocks = srtText.trim().split(/\n\s*\n/);
    
    blocks.forEach(block => {
      const lines = block.trim().split('\n');
      if (lines.length >= 3) {
        const timeMatch = lines[1].match(/(\d{2}:\d{2}:\d{2},\d{3}) --> (\d{2}:\d{2}:\d{2},\d{3})/);
        if (timeMatch) {
          subtitles.push({
            startTime: this.parseTime(timeMatch[1]),
            endTime: this.parseTime(timeMatch[2]),
            text: lines.slice(2).join('\n')
          });
        }
      }
    });
    
    return subtitles;
  }
  
  parseVTT(vttText) {
    // ç§»é™¤ WEBVTT æ¨™é ­
    const content = vttText.replace(/^WEBVTT\s*\n/, '');
    // VTT æ ¼å¼é¡ä¼¼ SRTï¼Œä½†æ™‚é–“æ ¼å¼ä½¿ç”¨é»è€Œéé€—è™Ÿ
    return this.parseSRT(content.replace(/\./g, ','));
  }
  
  parseTime(timeStr) {
    const parts = timeStr.match(/(\d{2}):(\d{2}):(\d{2})[,.](\d{3})/);
    if (parts) {
      const hours = parseInt(parts[1]);
      const minutes = parseInt(parts[2]);
      const seconds = parseInt(parts[3]);
      const milliseconds = parseInt(parts[4]);
      
      return hours * 3600 + minutes * 60 + seconds + milliseconds / 1000;
    }
    return 0;
  }
}
Day 12-13: æœå°‹åŠŸèƒ½èˆ‡æ¨™è¨˜ç³»çµ±
Day 12ï¼šæ¨™è¨˜ç®¡ç†å™¨ï¼ˆ4å°æ™‚ï¼‰
Step 7: å»ºç«‹ bookmark-manager.js
javascript// js/video/bookmark-manager.js
export class BookmarkManager {
  constructor() {
    this.bookmarks = [];
    this.container = document.getElementById('bookmarksList');
    this.videoId = null;
    
    this.init();
  }
  
  init() {
    // ç›£è½è¦–è¨Šè¼‰å…¥
    document.addEventListener('videoLoaded', (e) => {
      this.videoId = `video_${Date.now()}`;
      this.loadBookmarks();
    });
    
    // å®šæœŸå„²å­˜
    setInterval(() => this.saveBookmarks(), 5000);
  }
  
  addBookmark(data) {
    const bookmark = {
      id: `bm_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
      videoId: this.videoId,
      timestamp: data.timestamp,
      title: data.title || 'æœªå‘½åæ¨™è¨˜',
      note: data.note || '',
      category: data.category || 'general',
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    };
    
    this.bookmarks.push(bookmark);
    this.sortBookmarks();
    this.render();
    this.saveBookmarks();
    
    return bookmark;
  }
  
  updateBookmark(data) {
    const index = this.bookmarks.findIndex(b => b.id === data.id);
    if (index !== -1) {
      this.bookmarks[index] = {
        ...this.bookmarks[index],
        ...data,
        updatedAt: new Date().toISOString()
      };
      
      this.render();
      this.saveBookmarks();
    }
  }
  
  deleteBookmark(id) {
    this.bookmarks = this.bookmarks.filter(b => b.id !== id);
    this.render();
    this.saveBookmarks();
  }
  
  sortBookmarks() {
    this.bookmarks.sort((a, b) => a.timestamp - b.timestamp);
  }
  
  render() {
    if (!this.container) return;
    
    this.container.innerHTML = '';
    
    if (this.bookmarks.length === 0) {
      this.container.innerHTML = '<p class="no-bookmarks">å°šç„¡æ¨™è¨˜</p>';
      return;
    }
    
    this.bookmarks.forEach(bookmark => {
      const element = this.createBookmarkElement(bookmark);
      this.container.appendChild(element);
    });
  }
  
  createBookmarkElement(bookmark) {
    const div = document.createElement('div');
    div.className = 'bookmark-item';
    div.dataset.bookmarkId = bookmark.id;
    
    div.innerHTML = `
      <div class="bookmark-header">
        <span class="bookmark-time" data-time="${bookmark.timestamp}">
          ${this.formatTime(bookmark.timestamp)}
        </span>
        <span class="bookmark-category ${bookmark.category}">
          ${this.getCategoryLabel(bookmark.category)}
        </span>
      </div>
      <div class="bookmark-title">${bookmark.title}</div>
      ${bookmark.note ? `<div class="bookmark-note">${bookmark.note}</div>` : ''}
      <div class="bookmark-actions">
        <button class="edit-btn" data-id="${bookmark.id}">ç·¨è¼¯</button>
        <button class="delete-btn" data-id="${bookmark.id}">åˆªé™¤</button>
      </div>
    `;
    
    // ç¶å®šäº‹ä»¶
    const timeEl = div.querySelector('.bookmark-time');
    timeEl.addEventListener('click', () => {
      const event = new CustomEvent('bookmarkClick', {
        detail: { time: bookmark.timestamp }
      });
      document.dispatchEvent(event);
    });
    
    const editBtn = div.querySelector('.edit-btn');
    editBtn.addEventListener('click', () => {
      window.videoApp.showBookmarkModal(bookmark);
    });
    
    const deleteBtn = div.querySelector('.delete-btn');
    deleteBtn.addEventListener('click', () => {
      if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹æ¨™è¨˜å—ï¼Ÿ')) {
        this.deleteBookmark(bookmark.id);
      }
    });
    
    return div;
  }
  
  getCategoryLabel(category) {
    const labels = {
      'general': 'ä¸€èˆ¬',
      'important': 'é‡è¦',
      'question': 'å•é¡Œ',
      'error': 'éŒ¯èª¤'
    };
    return labels[category] || category;
  }
  
  formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  }
  
  saveBookmarks() {
    if (!this.videoId) return;
    
    const key = `whisper_bookmarks_${this.videoId}`;
    localStorage.setItem(key, JSON.stringify(this.bookmarks));
  }
  
  loadBookmarks() {
    if (!this.videoId) return;
    
    const key = `whisper_bookmarks_${this.videoId}`;
    const data = localStorage.getItem(key);
    
    if (data) {
      try {
        this.bookmarks = JSON.parse(data);
        this.render();
      } catch (e) {
        console.error('è¼‰å…¥æ¨™è¨˜å¤±æ•—:', e);
        this.bookmarks = [];
      }
    }
  }
  
  getAllBookmarks() {
    return [...this.bookmarks];
  }
  
  exportBookmarks(format = 'json') {
    if (format === 'json') {
      return JSON.stringify(this.bookmarks, null, 2);
    } else if (format === 'csv') {
      const headers = ['æ™‚é–“', 'æ¨™é¡Œ', 'ç­†è¨˜', 'åˆ†é¡', 'å»ºç«‹æ™‚é–“'];
      const rows = this.bookmarks.map(b => [
        this.formatTime(b.timestamp),
        b.title,
        b.note,
        this.getCategoryLabel(b.category),
        new Date(b.createdAt).toLocaleString()
      ]);
      
      return [headers, ...rows]
        .map(row => row.map(cell => `"${cell}"`).join(','))
        .join('\n');
    }
  }
  
  importBookmarks(data, format = 'json') {
    try {
      if (format === 'json') {
        const bookmarks = JSON.parse(data);
        if (Array.isArray(bookmarks)) {
          this.bookmarks = [...this.bookmarks, ...bookmarks];
          this.sortBookmarks();
          this.render();
          this.saveBookmarks();
          return bookmarks.length;
        }
      }
      throw new Error('ç„¡æ•ˆçš„åŒ¯å…¥æ ¼å¼');
    } catch (error) {
      console.error('åŒ¯å…¥æ¨™è¨˜å¤±æ•—:', error);
      throw error;
    }
  }
}
Day 14-15: å‹˜èª¤ç³»çµ±èˆ‡æ•´åˆå„ªåŒ–
Day 14ï¼šå‹˜èª¤åŠŸèƒ½æ“´å±•ï¼ˆ4å°æ™‚ï¼‰
Step 8: æ“´å±•æ¨™è¨˜ç³»çµ±ç‚ºå‹˜èª¤è¡¨
åœ¨ bookmark-manager.js ä¸­åŠ å…¥å‹˜èª¤ç›¸é—œåŠŸèƒ½ï¼š
javascript// åŠ å…¥å‹˜èª¤ç›¸é—œæ–¹æ³•
generateCorrectionReport() {
  const corrections = this.bookmarks.filter(b => b.category === 'error');
  
  let report = '# å½±ç‰‡å‹˜èª¤å ±å‘Š\n\n';
  report += `æª”æ¡ˆåç¨±ï¼š${window.videoApp.currentProject?.fileName || 'æœªçŸ¥'}\n`;
  report += `ç”¢ç”Ÿæ™‚é–“ï¼š${new Date().toLocaleString()}\n`;
  report += `å‹˜èª¤æ•¸é‡ï¼š${corrections.length}\n\n`;
  report += '---\n\n';
  
  corrections.forEach((correction, index) => {
    report += `## ${index + 1}. ${correction.title}\n`;
    report += `æ™‚é–“é»ï¼š${this.formatTime(correction.timestamp)}\n`;
    report += `æè¿°ï¼š${correction.note}\n`;
    report += `æ¨™è¨˜æ™‚é–“ï¼š${new Date(correction.createdAt).toLocaleString()}\n\n`;
  });
  
  return report;
}

exportCorrectionReport(format = 'markdown') {
  const report = this.generateCorrectionReport();
  const filename = `å‹˜èª¤å ±å‘Š_${new Date().toISOString().split('T')[0]}`;
  
  if (format === 'markdown') {
    this.download(report, `${filename}.md`, 'text/markdown');
  } else if (format === 'html') {
    // è½‰æ› Markdown ç‚º HTMLï¼ˆç°¡å–®å¯¦ä½œï¼‰
    const html = this.markdownToHtml(report);
    this.download(html, `${filename}.html`, 'text/html');
  }
}

markdownToHtml(markdown) {
  let html = markdown
    .replace(/^# (.*$)/gim, '<h1>$1</h1>')
    .replace(/^## (.*$)/gim, '<h2>$1</h2>')
    .replace(/^---$/gim, '<hr>')
    .replace(/\n\n/g, '</p><p>')
    .replace(/\n/g, '<br>');
  
  return `
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="UTF-8">
      <title>å½±ç‰‡å‹˜èª¤å ±å‘Š</title>
      <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        h1 { color: #333; }
        h2 { color: #666; }
        hr { margin: 20px 0; }
      </style>
    </head>
    <body>
      <p>${html}</p>
    </body>
    </html>
  `;
}

download(content, filename, mimeType) {
  const blob = new Blob([content], { type: mimeType });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}
Day 15ï¼šæ•ˆèƒ½å„ªåŒ–èˆ‡æœ€çµ‚æ¸¬è©¦ï¼ˆ4å°æ™‚ï¼‰
Step 9: åŠ å…¥æ•ˆèƒ½å„ªåŒ–
å»ºç«‹ js/video/video-performance.jsï¼š
javascript// æ•ˆèƒ½ç›£æ§èˆ‡å„ªåŒ–
export class PerformanceMonitor {
  constructor() {
    this.metrics = {
      videoLoadTime: 0,
      subtitleIndexTime: 0,
      searchTime: [],
      memoryUsage: []
    };
    
    this.startMonitoring();
  }
  
  startMonitoring() {
    // ç›£æ§è¨˜æ†¶é«”ä½¿ç”¨ï¼ˆå¦‚æœæ”¯æ´ï¼‰
    if (performance.memory) {
      setInterval(() => {
        this.metrics.memoryUsage.push({
          time: Date.now(),
          used: performance.memory.usedJSHeapSize,
          total: performance.memory.totalJSHeapSize
        });
        
        // ä¿ç•™æœ€è¿‘ 100 å€‹æ•¸æ“šé»
        if (this.metrics.memoryUsage.length > 100) {
          this.metrics.memoryUsage.shift();
        }
        
        // æª¢æŸ¥è¨˜æ†¶é«”ä½¿ç”¨
        this.checkMemoryUsage();
      }, 5000);
    }
  }
  
  checkMemoryUsage() {
    if (!performance.memory) return;
    
    const used = performance.memory.usedJSHeapSize;
    const limit = performance.memory.jsHeapSizeLimit;
    const usage = used / limit;
    
    if (usage > 0.9) {
      console.warn('è¨˜æ†¶é«”ä½¿ç”¨ç‡éé«˜:', Math.round(usage * 100) + '%');
      this.suggestOptimization();
    }
  }
  
  suggestOptimization() {
    // å»ºè­°å„ªåŒ–æªæ–½
    const suggestions = [
      'è€ƒæ…®é—œé–‰å…¶ä»–åˆ†é ',
      'æ¸…ç†ä¸éœ€è¦çš„æ¨™è¨˜',
      'é‡æ–°è¼‰å…¥é é¢'
    ];
    
    console.log('å„ªåŒ–å»ºè­°:', suggestions);
  }
  
  measureVideoLoad(startTime) {
    this.metrics.videoLoadTime = Date.now() - startTime;
    console.log(`è¦–è¨Šè¼‰å…¥æ™‚é–“: ${this.metrics.videoLoadTime}ms`);
  }
  
  measureSubtitleIndex(startTime, count) {
    this.metrics.subtitleIndexTime = Date.now() - startTime;
    console.log(`å­—å¹•ç´¢å¼•æ™‚é–“: ${this.metrics.subtitleIndexTime}ms (${count} æ¢)`);
  }
  
  measureSearch(startTime, resultCount) {
    const duration = Date.now() - startTime;
    this.metrics.searchTime.push({
      duration,
      resultCount,
      timestamp: Date.now()
    });
    
    console.log(`æœå°‹æ™‚é–“: ${duration}ms (${resultCount} å€‹çµæœ)`);
  }
  
  getReport() {
    return {
      ...this.metrics,
      averageSearchTime: this.calculateAverageSearchTime(),
      currentMemoryUsage: this.getCurrentMemoryUsage()
    };
  }
  
  calculateAverageSearchTime() {
    if (this.metrics.searchTime.length === 0) return 0;
    
    const total = this.metrics.searchTime.reduce((sum, item) => sum + item.duration, 0);
    return Math.round(total / this.metrics.searchTime.length);
  }
  
  getCurrentMemoryUsage() {
    if (!performance.memory) return null;
    
    return {
      used: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024),
      total: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024),
      limit: Math.round(performance.memory.jsHeapSizeLimit / 1024 / 1024)
    };
  }
}
Step 10: æ•´åˆæ¸¬è©¦æ¸…å–®
åœ¨ video-main.js ä¸­åŠ å…¥æ¸¬è©¦æ¨¡å¼ï¼š
javascript// åŠ å…¥é™¤éŒ¯æ¨¡å¼
enableDebugMode() {
  window.videoDebug = {
    player: this.player,
    subtitleManager: this.subtitleManager,
    bookmarkManager: this.bookmarkManager,
    
    // æ¸¬è©¦åŠŸèƒ½
    testSearch: (query) => {
      console.time('Search');
      const results = this.subtitleManager.search(query);
      console.timeEnd('Search');
      console.log(`Found ${results.length} results`);
      return results;
    },
    
    testBookmarks: () => {
      // è‡ªå‹•ç”Ÿæˆæ¸¬è©¦æ¨™è¨˜
      for (let i = 0; i < 10; i++) {
        this.bookmarkManager.addBookmark({
          timestamp: i * 60,
          title: `æ¸¬è©¦æ¨™è¨˜ ${i + 1}`,
          note: `é€™æ˜¯ç¬¬ ${i + 1} å€‹æ¸¬è©¦æ¨™è¨˜`,
          category: ['general', 'important', 'question', 'error'][i % 4]
        });
      }
    },
    
    clearAll: () => {
      if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è³‡æ–™å—ï¼Ÿ')) {
        localStorage.clear();
        location.reload();
      }
    }
  };
  
  console.log('Debug mode enabled. Use window.videoDebug to access debug functions.');
}
ğŸ“ æ¸¬è©¦æª¢æŸ¥æ¸…å–®
åŸºæœ¬åŠŸèƒ½æ¸¬è©¦

 è¦–è¨Šæª”æ¡ˆè¼‰å…¥ï¼ˆæ‹–æ”¾/é¸æ“‡ï¼‰
 æ’­æ”¾æ§åˆ¶ï¼ˆæ’­æ”¾/æš«åœ/é€²åº¦ï¼‰
 é€Ÿåº¦æ§åˆ¶
 å…¨è¢å¹•æ¨¡å¼
 éµç›¤å¿«æ·éµ

å­—å¹•åŠŸèƒ½æ¸¬è©¦

 å…§åµŒå­—å¹•æå–
 å­—å¹•æœå°‹
 æœå°‹çµæœé»æ“Šè·³è½‰
 ä¸­æ–‡æœå°‹æº–ç¢ºæ€§

æ¨™è¨˜åŠŸèƒ½æ¸¬è©¦

 æ–°å¢æ¨™è¨˜
 ç·¨è¼¯æ¨™è¨˜
 åˆªé™¤æ¨™è¨˜
 æ¨™è¨˜è·³è½‰
 å‹˜èª¤å ±å‘ŠåŒ¯å‡º

æ•ˆèƒ½æ¸¬è©¦

 å¤§æª”æ¡ˆè¼‰å…¥ï¼ˆ> 1GBï¼‰
 é•·å­—å¹•æœå°‹ï¼ˆ> 10000æ¢ï¼‰
 è¨˜æ†¶é«”ä½¿ç”¨ç›£æ§
 å¤šæ¬¡æ“ä½œç©©å®šæ€§

ç›¸å®¹æ€§æ¸¬è©¦

 Chrome/Edge
 Firefox
 Safari
 ä¸åŒè¦–è¨Šæ ¼å¼ï¼ˆMP4, WebMï¼‰

ğŸš€ éƒ¨ç½²å‰æª¢æŸ¥

ç§»é™¤é™¤éŒ¯ç¨‹å¼ç¢¼
å£“ç¸® CSS/JSï¼ˆå¯é¸ï¼‰
æ›´æ–°å°èˆªé€£çµ
æ’°å¯«ä½¿ç”¨èªªæ˜
Git commit ä¸¦æ¨é€