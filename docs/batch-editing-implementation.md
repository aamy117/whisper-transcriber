# 批次編輯功能實現說明

## 實現概覽

批次編輯功能已成功整合到 Whisper Transcriber 主程式中，提供多選段落和批次操作的能力。

## 功能特點

### 1. 多選機制
- **單擊選擇**：在批次模式下點擊段落進行選擇/取消選擇
- **Shift + 點擊**：範圍選擇（從上次選擇到當前點擊的所有段落）
- **Ctrl/Cmd + 點擊**：切換單個段落的選擇狀態
- **全選/取消全選/反選**：快速選擇操作

### 2. 批次操作
已實現的批次操作包括：
- **批次刪除**：刪除所有選中的段落
- **批次合併**：將連續的段落合併為一個
- **批次分割**：在指定位置分割段落
- **批次尋找取代**：支援正則表達式的文字替換
- **批次時間調整**：統一調整段落時間
- **批次導出**：導出選中段落為各種格式

### 3. UI 整合
- **工具列按鈕**：在編輯器工具列新增批次編輯模式切換按鈕
- **浮動工具欄**：底部浮動工具欄顯示選擇狀態和操作按鈕
- **視覺反饋**：選中段落有明顯的視覺標記
- **狀態顯示**：即時顯示已選擇的段落數量

## 技術實現

### 檔案結構
```
js/
├── editor.js           # 編輯器主類，整合批次編輯功能
├── batch-editor.js     # 批次編輯核心邏輯
└── main.js            # 主程式，處理 UI 交互

css/
└── style.css          # 包含批次選擇和工具欄樣式

test/
└── test-batch-editing.html  # 批次編輯功能測試頁面
```

### 關鍵組件

1. **BatchEditor 類** (`batch-editor.js`)
   - 管理選擇狀態
   - 實現各種批次操作
   - 處理鍵盤快捷鍵

2. **TranscriptionEditor 整合** (`editor.js`)
   - 新增批次編輯相關方法
   - 整合 BatchEditor 實例
   - 更新渲染邏輯支援選擇狀態

3. **主程式整合** (`main.js`)
   - 批次編輯按鈕事件處理
   - 工具欄顯示/隱藏控制
   - 全局事件監聽

## 使用方式

1. **進入批次編輯模式**
   - 點擊編輯器工具列的 "✓" 按鈕
   - 或在有轉譯內容時調用 `toggleBatchEditMode()`

2. **選擇段落**
   - 單擊：選擇/取消選擇單個段落
   - Shift + 點擊：選擇範圍
   - Ctrl/Cmd + 點擊：多選
   - Ctrl/Cmd + A：全選

3. **執行批次操作**
   - 使用底部浮動工具欄的按鈕
   - 或使用鍵盤快捷鍵（如 Delete 鍵刪除）

4. **退出批次模式**
   - 再次點擊工具列按鈕
   - 或按 Escape 鍵

## 測試

使用 `test/test-batch-editing.html` 進行功能測試：
- 生成測試數據
- 測試各種選擇方式
- 驗證批次操作功能
- 檢查 UI 響應

## 待實現功能

以下功能已預留接口，待後續實現：
1. 批次時間調整的詳細實現
2. 批次尋找取代的正則表達式支援
3. 批次導出的格式優化
4. 更多批次操作（如批次翻譯、批次格式化等）

## 注意事項

- 批次操作會創建歷史記錄，支援撤銷
- 大量段落操作時會自動啟用虛擬滾動優化性能
- 所有批次操作都有確認對話框，防止誤操作