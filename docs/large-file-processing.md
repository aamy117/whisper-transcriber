# 大檔案處理功能說明

## 概述

Whisper 轉譯器現在支援處理超過 25MB 的音訊檔案，透過智能預處理技術自動處理大檔案。

## 功能特點

### 1. 自動檔案大小檢測
- 播放功能不受檔案大小限制
- 只在開始轉譯時檢查檔案大小
- 超過 25MB 的檔案會自動觸發預處理

### 2. 三種處理策略

#### 智能分割
- 保持原始音質
- 基於靜音檢測找到自然分割點
- 自動合併分段結果
- 適合長時間錄音

#### 智能壓縮
- 降低音訊品質以減小檔案大小
- 針對語音優化（16kHz 取樣率）
- 單次 API 調用，成本最低
- 適合一般對話內容

#### 混合模式
- 先嘗試壓縮，若仍超過限制再分割
- 平衡品質與成本
- 適合大多數使用場景

### 3. 處理選項對話框
當檔案超過大小限制時，會顯示友好的選項對話框：
- 清楚顯示檔案資訊和超出大小
- 預估每種策略的處理成本
- 點擊選項查看詳細說明
- 視覺化的圖標和說明

## 使用方式

1. **上傳大檔案**
   - 正常上傳音訊檔案
   - 檔案可以播放，不受大小限制

2. **開始轉譯**
   - 點擊「開始轉譯」按鈕
   - 系統自動檢測檔案大小

3. **選擇處理方式**
   - 如果檔案超過 25MB，會顯示處理選項
   - 選擇適合的處理策略
   - 點擊「確認處理」

4. **等待處理完成**
   - 顯示處理進度
   - 分段處理時會顯示當前段數
   - 自動合併結果

## 批次處理功能

新增的批次處理功能支援：

1. **多檔案上傳**
   - 拖放或選擇多個檔案
   - 支援混合大小的檔案

2. **智能佇列管理**
   - 自動處理每個檔案
   - 大檔案自動應用預處理
   - 顯示個別進度

3. **錯誤處理**
   - 可選擇遇到錯誤時繼續
   - 詳細的錯誤報告
   - 支援暫停和繼續

4. **結果匯出**
   - JSON 格式（完整資料）
   - CSV 格式（表格資料）
   - TXT 格式（純文字）

## 技術細節

### 音訊壓縮
- 使用 Web Audio API
- 降低取樣率：22kHz → 16kHz → 8kHz
- 轉換為單聲道
- 應用語音優化濾波器

### 音訊分割
- 智能靜音檢測
- 5 秒重疊避免邊界遺漏
- 自動時間戳調整
- 保持原始音質

### 檔案格式
- 輸出統一為 WAV 格式
- 確保瀏覽器相容性
- 支援所有 Whisper API 接受的格式

## 成本估算

- 直接轉譯：$0.006/分鐘
- 分割處理：$0.006/分鐘 × 段數
- 壓縮處理：$0.006/分鐘（單次）
- 混合模式：視壓縮效果而定

## 注意事項

1. **檔案大小限制**
   - OpenAI API 限制：25MB
   - 建議檔案大小：< 20MB
   - 最大處理大小：無限制（透過分割）

2. **處理時間**
   - 壓縮：幾秒到幾十秒
   - 分割：根據檔案大小而定
   - API 調用：每段約 10-30 秒

3. **音質影響**
   - 分割：無影響
   - 輕度壓縮：幾乎無影響
   - 高度壓縮：可能影響識別準確度

## 疑難排解

**Q: 處理選項對話框沒有出現？**
A: 確保檔案大於 25MB，且點擊的是「開始轉譯」而非播放。

**Q: 壓縮後檔案仍然太大？**
A: 系統會自動切換到分割模式，或選擇混合模式。

**Q: 分段結果不連貫？**
A: 系統已包含 5 秒重疊，如仍有問題請調整分割參數。

**Q: 批次處理中斷？**
A: 檢查 API Key 是否有效，網路連接是否穩定。

## 更新日誌

### v1.0.0 (2025-06-20)
- 實現大檔案預處理功能
- 新增音訊壓縮器
- 新增音訊分割器
- 新增批次處理功能
- 改進使用者介面