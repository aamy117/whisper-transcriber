<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>視訊播放器除錯</title>
    <link rel="stylesheet" href="css/shared.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/video.css">
</head>
<body>
    <div style="padding: 20px;">
        <h1>視訊播放器除錯頁面</h1>
        
        <div style="margin: 20px 0;">
            <h2>基本測試</h2>
            <input type="file" id="testFileInput" accept="video/*">
            <br><br>
            <video id="testVideo" controls width="600"></video>
        </div>
        
        <div style="margin: 20px 0;">
            <h2>錯誤資訊</h2>
            <div id="errorLog" style="background: #f0f0f0; padding: 10px; min-height: 100px; font-family: monospace; font-size: 12px;">
                等待測試...
            </div>
        </div>
        
        <div style="margin: 20px 0;">
            <button onclick="testMainApp()">測試主應用程式</button>
            <button onclick="checkModules()">檢查模組載入</button>
        </div>
    </div>
    
    <script>
        const errorLog = document.getElementById('errorLog');
        
        function log(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            errorLog.innerHTML += `<div style="color: ${color}">[${time}] ${message}</div>`;
            console.log(`[${type}]`, message);
        }
        
        // 基本視訊測試
        const testFileInput = document.getElementById('testFileInput');
        const testVideo = document.getElementById('testVideo');
        
        testFileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                log(`選擇檔案: ${file.name} (${file.type}, ${(file.size / 1024 / 1024).toFixed(2)}MB)`);
                
                if (file.type.startsWith('video/')) {
                    try {
                        const url = URL.createObjectURL(file);
                        testVideo.src = url;
                        log('成功建立 URL 並設定到 video 元素', 'success');
                    } catch (error) {
                        log(`建立 URL 失敗: ${error.message}`, 'error');
                    }
                } else {
                    log('不是視訊檔案', 'error');
                }
            }
        });
        
        testVideo.addEventListener('loadedmetadata', () => {
            log(`視訊載入成功: ${testVideo.videoWidth}x${testVideo.videoHeight}, 長度: ${testVideo.duration}秒`, 'success');
        });
        
        testVideo.addEventListener('error', (e) => {
            log(`視訊錯誤: ${e.message || '未知錯誤'}`, 'error');
        });
        
        // 檢查模組
        async function checkModules() {
            log('開始檢查模組...');
            
            try {
                const configModule = await import('./js/video/video-config.js');
                log('✓ video-config.js 載入成功', 'success');
                
                const playerModule = await import('./js/video/video-player.js');
                log('✓ video-player.js 載入成功', 'success');
                
                const uiModule = await import('./js/video/video-ui.js');
                log('✓ video-ui.js 載入成功', 'success');
                
                const mainModule = await import('./js/video/video-main.js');
                log('✓ video-main.js 載入成功', 'success');
                
            } catch (error) {
                log(`模組載入失敗: ${error.message}`, 'error');
                console.error(error);
            }
        }
        
        // 測試主應用程式
        function testMainApp() {
            log('嘗試載入主應用程式...');
            window.location.href = 'video.html';
        }
        
        // 捕捉全域錯誤
        window.addEventListener('error', (e) => {
            log(`全域錯誤: ${e.message} (${e.filename}:${e.lineno}:${e.colno})`, 'error');
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            log(`未處理的 Promise 拒絕: ${e.reason}`, 'error');
        });
        
        // 初始檢查
        log('除錯頁面已載入');
    </script>
</body>
</html>