<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨™é»ç¬¦è™Ÿåˆ‡æ›æ¸¬è©¦</title>
    
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/shared.css">
    
    <style>
        .test-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
        }
        
        .test-header {
            text-align: center;
            padding: 2rem;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        
        .test-section {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .demo-editor {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1rem;
            min-height: 300px;
        }
        
        .segment {
            padding: 1rem;
            margin-bottom: 0.5rem;
            background: var(--bg-secondary);
            border-radius: 4px;
            display: flex;
            gap: 1rem;
        }
        
        .segment-time {
            color: var(--primary-color);
            font-weight: 600;
            min-width: 80px;
        }
        
        .segment-text {
            flex: 1;
            line-height: 1.6;
        }
        
        .toolbar {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            align-items: center;
        }
        
        .status-display {
            padding: 0.5rem 1rem;
            background: var(--bg-tertiary);
            border-radius: 4px;
            font-weight: 600;
        }
        
        .test-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 1rem;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin-bottom: 0.25rem;
        }
        
        .log-success { color: #28a745; }
        .log-error { color: #dc3545; }
        .log-info { color: #17a2b8; }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸ”¤ æ¨™é»ç¬¦è™Ÿåˆ‡æ›åŠŸèƒ½æ¸¬è©¦</h1>
            <p>æ¸¬è©¦åœ¨æœå°‹æŒ‰éˆ•æ—çš„æ¨™é»ç¬¦è™Ÿåˆ‡æ›åŠŸèƒ½</p>
        </div>
        
        <!-- æ¸¬è©¦å·¥å…·åˆ— -->
        <div class="test-section">
            <h3>å·¥å…·åˆ—æ¸¬è©¦</h3>
            <div class="editor-toolbar">
                <button class="toolbar-btn" id="searchBtn" title="æœå°‹ (Ctrl+F)">
                    <span class="icon">ğŸ”</span>
                </button>
                <button class="toolbar-btn" id="punctuationToggleBtn" title="åˆ‡æ›æ¨™é»ç¬¦è™Ÿé¡¯ç¤º">
                    <span class="icon" id="punctuationIcon">ã€‚</span>
                </button>
                <button class="toolbar-btn" id="replaceToolbarBtn" title="å°‹æ‰¾å’Œå–ä»£ (Ctrl+H)">
                    <span class="icon">ğŸ”„</span>
                </button>
            </div>
            
            <div class="toolbar">
                <button class="btn btn-primary" id="loadSampleBtn">è¼‰å…¥ç¯„ä¾‹è³‡æ–™</button>
                <div class="status-display">
                    æ¨™é»ç¬¦è™Ÿç‹€æ…‹ï¼š<span id="punctuationStatus">é¡¯ç¤ºä¸­</span>
                </div>
            </div>
        </div>
        
        <!-- ç·¨è¼¯å™¨ç¤ºç¯„ -->
        <div class="test-section">
            <h3>ç·¨è¼¯å™¨å…§å®¹</h3>
            <div class="demo-editor" id="demoEditor">
                <p style="text-align: center; color: var(--text-secondary);">
                    é»æ“Šã€Œè¼‰å…¥ç¯„ä¾‹è³‡æ–™ã€æŸ¥çœ‹æ•ˆæœ
                </p>
            </div>
        </div>
        
        <!-- æ¸¬è©¦æ—¥èªŒ -->
        <div class="test-section">
            <h3>æ¸¬è©¦æ—¥èªŒ</h3>
            <div class="test-log" id="testLog">
                <div class="log-entry log-info">ç³»çµ±å°±ç·’ï¼Œç­‰å¾…æ¸¬è©¦...</div>
            </div>
        </div>
    </div>
    
    <script type="module">
        // ç¯„ä¾‹è³‡æ–™
        const sampleSegments = [
            {
                start: 0,
                end: 5,
                text: "å¤§å®¶å¥½ï¼Œæ­¡è¿ä¾†åˆ°ä»Šå¤©çš„ç¯€ç›®ï¼",
                textWithoutPunctuation: "å¤§å®¶å¥½ æ­¡è¿ä¾†åˆ°ä»Šå¤©çš„ç¯€ç›®"
            },
            {
                start: 5,
                end: 10,
                text: "ä»Šå¤©æˆ‘å€‘è¦è¨è«–çš„ä¸»é¡Œæ˜¯ï¼šå¦‚ä½•æé«˜å·¥ä½œæ•ˆç‡ï¼Ÿ",
                textWithoutPunctuation: "ä»Šå¤©æˆ‘å€‘è¦è¨è«–çš„ä¸»é¡Œæ˜¯ å¦‚ä½•æé«˜å·¥ä½œæ•ˆç‡"
            },
            {
                start: 10,
                end: 15,
                text: "é¦–å…ˆï¼Œè®“æˆ‘å€‘ä¾†çœ‹çœ‹æ™‚é–“ç®¡ç†çš„é‡è¦æ€§ã€‚",
                textWithoutPunctuation: "é¦–å…ˆ è®“æˆ‘å€‘ä¾†çœ‹çœ‹æ™‚é–“ç®¡ç†çš„é‡è¦æ€§"
            },
            {
                start: 15,
                end: 20,
                text: "è‰¯å¥½çš„æ™‚é–“è¦åŠƒï¼Œå¯ä»¥å¹«åŠ©æˆ‘å€‘æ›´æœ‰æ•ˆåœ°å®Œæˆä»»å‹™ã€‚",
                textWithoutPunctuation: "è‰¯å¥½çš„æ™‚é–“è¦åŠƒ å¯ä»¥å¹«åŠ©æˆ‘å€‘æ›´æœ‰æ•ˆåœ°å®Œæˆä»»å‹™"
            }
        ];
        
        let showPunctuation = true;
        let segments = [];
        
        // æ—¥èªŒåŠŸèƒ½
        function log(message, type = 'info') {
            const logEl = document.getElementById('testLog');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            const time = new Date().toLocaleTimeString();
            entry.textContent = `[${time}] ${message}`;
            logEl.appendChild(entry);
            logEl.scrollTop = logEl.scrollHeight;
        }
        
        // æ ¼å¼åŒ–æ™‚é–“
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // æ¸²æŸ“æ®µè½
        function renderSegments() {
            const editor = document.getElementById('demoEditor');
            editor.innerHTML = '';
            
            segments.forEach((segment, index) => {
                const div = document.createElement('div');
                div.className = 'segment';
                
                const timeEl = document.createElement('div');
                timeEl.className = 'segment-time';
                timeEl.textContent = formatTime(segment.start);
                
                const textEl = document.createElement('div');
                textEl.className = 'segment-text';
                textEl.textContent = showPunctuation ? segment.text : segment.textWithoutPunctuation;
                
                div.appendChild(timeEl);
                div.appendChild(textEl);
                editor.appendChild(div);
            });
            
            log(`æ¸²æŸ“ ${segments.length} å€‹æ®µè½ï¼Œæ¨™é»ç¬¦è™Ÿï¼š${showPunctuation ? 'é¡¯ç¤º' : 'éš±è—'}`, 'success');
        }
        
        // åˆ‡æ›æ¨™é»ç¬¦è™Ÿ
        function togglePunctuation() {
            showPunctuation = !showPunctuation;
            
            const btn = document.getElementById('punctuationToggleBtn');
            const status = document.getElementById('punctuationStatus');
            
            if (showPunctuation) {
                btn.classList.remove('punctuation-hidden');
                btn.title = 'åˆ‡æ›æ¨™é»ç¬¦è™Ÿé¡¯ç¤º';
                status.textContent = 'é¡¯ç¤ºä¸­';
                log('åˆ‡æ›åˆ°é¡¯ç¤ºæ¨™é»ç¬¦è™Ÿ', 'info');
            } else {
                btn.classList.add('punctuation-hidden');
                btn.title = 'æ¨™é»ç¬¦è™Ÿå·²éš±è—';
                status.textContent = 'éš±è—ä¸­';
                log('åˆ‡æ›åˆ°éš±è—æ¨™é»ç¬¦è™Ÿ', 'info');
            }
            
            // å¦‚æœæœ‰è¼‰å…¥è³‡æ–™ï¼Œé‡æ–°æ¸²æŸ“
            if (segments.length > 0) {
                renderSegments();
            }
            
            // å„²å­˜åå¥½è¨­å®š
            localStorage.setItem('whisper_showPunctuation', showPunctuation);
        }
        
        // è¼‰å…¥ç¯„ä¾‹è³‡æ–™
        function loadSampleData() {
            segments = [...sampleSegments];
            renderSegments();
            log('å·²è¼‰å…¥ç¯„ä¾‹è³‡æ–™', 'success');
        }
        
        // åˆå§‹åŒ–
        function init() {
            // è¼‰å…¥åå¥½è¨­å®š
            const saved = localStorage.getItem('whisper_showPunctuation');
            if (saved !== null) {
                showPunctuation = saved === 'true';
                if (!showPunctuation) {
                    const btn = document.getElementById('punctuationToggleBtn');
                    btn.classList.add('punctuation-hidden');
                    document.getElementById('punctuationStatus').textContent = 'éš±è—ä¸­';
                }
            }
            
            // ç¶å®šäº‹ä»¶
            document.getElementById('punctuationToggleBtn').addEventListener('click', togglePunctuation);
            document.getElementById('loadSampleBtn').addEventListener('click', loadSampleData);
            
            // å…¶ä»–æŒ‰éˆ•ç¤ºç¯„
            document.getElementById('searchBtn').addEventListener('click', () => {
                log('é»æ“Šæœå°‹æŒ‰éˆ•ï¼ˆåŠŸèƒ½æœªå¯¦ä½œï¼‰', 'info');
            });
            
            document.getElementById('replaceToolbarBtn').addEventListener('click', () => {
                log('é»æ“Šå–ä»£æŒ‰éˆ•ï¼ˆåŠŸèƒ½æœªå¯¦ä½œï¼‰', 'info');
            });
            
            log('æ¸¬è©¦é é¢å·²åˆå§‹åŒ–', 'success');
        }
        
        // å•Ÿå‹•
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>