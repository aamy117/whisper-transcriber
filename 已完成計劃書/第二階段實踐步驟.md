📋 視訊播放器開發實踐步驟（2週）
前置準備
Step 1: 建立視訊相關檔案結構
bash# 建立目錄
mkdir js/video

# 建立檔案
touch video.html
touch css/video.css
touch js/video/video-main.js
touch js/video/video-player.js
touch js/video/subtitle-manager.js
touch js/video/bookmark-manager.js
Day 8-9: 基礎視訊播放器
Day 8 上午：建立視訊頁面結構（2小時）
Step 2: 建立 video.html
html<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Whisper 視訊工具 - 支援字幕搜尋與時間標記的專業影片播放器">
    <title>視訊播放器 - Whisper 工具</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/shared.css">
    <link rel="stylesheet" href="css/video.css">
</head>
<body>
    <div id="video-app">
        <!-- 導航列 -->
        <nav class="app-navigation">
            <div class="nav-container">
                <div class="nav-brand">
                    <h1 class="nav-title">Whisper 工具</h1>
                </div>
                <div class="nav-links">
                    <a href="index.html" class="nav-link">
                        <span class="nav-icon">🎵</span>
                        <span>音訊工具</span>
                    </a>
                    <a href="video.html" class="nav-link active">
                        <span class="nav-icon">🎬</span>
                        <span>視訊工具</span>
                    </a>
                </div>
            </div>
        </nav>

        <!-- 主要內容 -->
        <main class="video-main">
            <div class="video-layout">
                <!-- 左側：視訊播放區 -->
                <section class="video-section">
                    <!-- 上傳區域 -->
                    <div class="video-upload-area" id="videoUploadArea">
                        <div class="upload-content">
                            <span class="upload-icon">🎬</span>
                            <h2>上傳影片檔案</h2>
                            <p>拖放檔案到此處，或點擊選擇檔案</p>
                            <p class="upload-hint">支援格式：MP4、WebM（建議小於 2GB）</p>
                            <input type="file" id="videoInput" accept="video/*" hidden>
                            <button class="btn btn-primary" id="selectVideoBtn">選擇檔案</button>
                        </div>
                    </div>

                    <!-- 視訊播放器 -->
                    <div class="video-player-container" id="videoPlayerContainer" style="display: none;">
                        <div class="video-wrapper">
                            <video id="videoPlayer" controls></video>
                            
                            <!-- 自定義控制列 -->
                            <div class="video-controls" id="videoControls">
                                <div class="controls-progress">
                                    <input type="range" id="videoProgress" class="progress-bar" value="0" min="0" max="100">
                                    <div class="time-display">
                                        <span id="currentVideoTime">00:00</span> / <span id="totalVideoTime">00:00</span>
                                    </div>
                                </div>
                                
                                <div class="controls-buttons">
                                    <button class="control-btn" id="playPauseBtn" title="播放/暫停">
                                        <span class="icon">▶️</span>
                                    </button>
                                    <button class="control-btn" id="skipBackBtn" title="快退 5 秒">
                                        <span class="icon">⏪</span>
                                    </button>
                                    <button class="control-btn" id="skipForwardBtn" title="快進 5 秒">
                                        <span class="icon">⏩</span>
                                    </button>
                                    
                                    <div class="speed-control">
                                        <select id="videoSpeedSelect">
                                            <option value="0.5">0.5x</option>
                                            <option value="0.75">0.75x</option>
                                            <option value="1" selected>1.0x</option>
                                            <option value="1.25">1.25x</option>
                                            <option value="1.5">1.5x</option>
                                            <option value="2">2.0x</option>
                                        </select>
                                    </div>
                                    
                                    <button class="control-btn" id="fullscreenBtn" title="全螢幕">
                                        <span class="icon">⛶</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 右側：功能面板 -->
                <aside class="side-panel">
                    <!-- 標籤切換 -->
                    <div class="panel-tabs">
                        <button class="tab-btn active" data-tab="subtitles">字幕搜尋</button>
                        <button class="tab-btn" data-tab="bookmarks">時間標記</button>
                    </div>

                    <!-- 字幕面板 -->
                    <div class="panel-content active" id="subtitlesPanel">
                        <div class="search-container">
                            <input type="text" id="subtitleSearchInput" placeholder="搜尋字幕內容...">
                            <button class="search-btn" id="subtitleSearchBtn">🔍</button>
                        </div>
                        
                        <div class="subtitle-status" id="subtitleStatus">
                            <p>請先載入影片以提取字幕</p>
                        </div>
                        
                        <div class="search-results" id="searchResults" style="display: none;">
                            <!-- 搜尋結果將顯示在這裡 -->
                        </div>
                    </div>

                    <!-- 標記面板 -->
                    <div class="panel-content" id="bookmarksPanel" style="display: none;">
                        <div class="bookmark-controls">
                            <button class="btn btn-primary" id="addBookmarkBtn">
                                <span>➕</span> 新增標記
                            </button>
                        </div>
                        
                        <div class="bookmarks-list" id="bookmarksList">
                            <!-- 標記列表將顯示在這裡 -->
                        </div>
                    </div>
                </aside>
            </div>
        </main>

        <!-- 標記編輯 Modal -->
        <div class="modal" id="bookmarkModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>編輯時間標記</h2>
                    <button class="modal-close" id="bookmarkModalClose">✕</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>時間點：<span id="bookmarkTime">00:00</span></label>
                    </div>
                    <div class="form-group">
                        <label for="bookmarkTitle">標題：</label>
                        <input type="text" id="bookmarkTitle" placeholder="輸入標記標題">
                    </div>
                    <div class="form-group">
                        <label for="bookmarkNote">筆記：</label>
                        <textarea id="bookmarkNote" rows="4" placeholder="輸入詳細筆記..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="bookmarkCategory">分類：</label>
                        <select id="bookmarkCategory">
                            <option value="general">一般</option>
                            <option value="important">重要</option>
                            <option value="question">問題</option>
                            <option value="error">錯誤</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelBookmarkBtn">取消</button>
                    <button class="btn btn-primary" id="saveBookmarkBtn">儲存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="js/video/video-main.js"></script>
</body>
</html>
Day 8 下午：視訊播放器樣式（2小時）
Step 3: 建立 video.css
css/* 視訊頁面專用樣式 */
.video-main {
  padding: var(--spacing-lg);
  max-width: 1600px;
  margin: 0 auto;
}

.video-layout {
  display: grid;
  grid-template-columns: 1fr 400px;
  gap: var(--spacing-lg);
  height: calc(100vh - 120px);
}

/* 視訊播放區域 */
.video-section {
  display: flex;
  flex-direction: column;
  background-color: var(--bg-secondary);
  border-radius: var(--radius-lg);
  overflow: hidden;
}

.video-upload-area {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px dashed var(--border-color);
  margin: var(--spacing-lg);
  border-radius: var(--radius-lg);
  transition: all 0.3s;
  cursor: pointer;
}

.video-upload-area:hover,
.video-upload-area.drag-over {
  border-color: var(--primary-color);
  background-color: var(--bg-tertiary);
}

/* 視訊播放器 */
.video-player-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: var(--spacing-lg);
}

.video-wrapper {
  position: relative;
  background-color: #000;
  border-radius: var(--radius-md);
  overflow: hidden;
  flex: 1;
}

#videoPlayer {
  width: 100%;
  height: 100%;
  display: block;
}

/* 自定義控制列 */
.video-controls {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
  padding: var(--spacing-lg) var(--spacing-md) var(--spacing-md);
  opacity: 0;
  transition: opacity 0.3s;
}

.video-wrapper:hover .video-controls,
.video-controls:hover {
  opacity: 1;
}

.controls-progress {
  margin-bottom: var(--spacing-sm);
}

.controls-buttons {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
}

/* 側邊面板 */
.side-panel {
  background-color: var(--bg-secondary);
  border-radius: var(--radius-lg);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.panel-tabs {
  display: flex;
  border-bottom: 1px solid var(--border-color);
}

.tab-btn {
  flex: 1;
  padding: var(--spacing-md);
  background: none;
  border: none;
  cursor: pointer;
  color: var(--text-secondary);
  font-weight: 500;
  transition: all 0.2s;
}

.tab-btn.active {
  color: var(--primary-color);
  border-bottom: 2px solid var(--primary-color);
}

.panel-content {
  flex: 1;
  padding: var(--spacing-lg);
  overflow-y: auto;
}

/* 搜尋功能 */
.search-container {
  display: flex;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-lg);
}

.search-container input {
  flex: 1;
  padding: var(--spacing-sm) var(--spacing-md);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  background-color: var(--bg-primary);
}

/* 搜尋結果 */
.search-result-item {
  padding: var(--spacing-md);
  margin-bottom: var(--spacing-sm);
  background-color: var(--bg-tertiary);
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: all 0.2s;
}

.search-result-item:hover {
  background-color: var(--bg-primary);
  transform: translateX(4px);
}

.result-time {
  font-size: 0.875rem;
  color: var(--primary-color);
  font-weight: 500;
}

.result-text {
  margin-top: var(--spacing-xs);
  color: var(--text-primary);
}

.result-text mark {
  background-color: #fbbf24;
  color: #1f2937;
  padding: 0 2px;
  border-radius: 2px;
}

/* 標記列表 */
.bookmark-item {
  padding: var(--spacing-md);
  margin-bottom: var(--spacing-sm);
  background-color: var(--bg-tertiary);
  border-radius: var(--radius-md);
  position: relative;
}

.bookmark-header {
  display: flex;
  justify-content: space-between;
  align-items: start;
  margin-bottom: var(--spacing-sm);
}

.bookmark-time {
  color: var(--primary-color);
  font-weight: 500;
  cursor: pointer;
}

.bookmark-category {
  display: inline-block;
  padding: 2px 8px;
  font-size: 0.75rem;
  border-radius: var(--radius-sm);
  background-color: var(--bg-primary);
}

.bookmark-category.important {
  background-color: #fee2e2;
  color: #dc2626;
}

.bookmark-category.question {
  background-color: #dbeafe;
  color: #2563eb;
}

.bookmark-category.error {
  background-color: #fef3c7;
  color: #d97706;
}

.bookmark-title {
  font-weight: 500;
  margin-bottom: var(--spacing-xs);
}

.bookmark-note {
  font-size: 0.875rem;
  color: var(--text-secondary);
  line-height: 1.5;
}

.bookmark-actions {
  display: flex;
  gap: var(--spacing-sm);
  margin-top: var(--spacing-sm);
}

.bookmark-actions button {
  padding: var(--spacing-xs) var(--spacing-sm);
  font-size: 0.875rem;
  background-color: var(--bg-primary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all 0.2s;
}

.bookmark-actions button:hover {
  background-color: var(--bg-secondary);
}

/* 響應式設計 */
@media (max-width: 1200px) {
  .video-layout {
    grid-template-columns: 1fr;
    height: auto;
  }
  
  .side-panel {
    height: 400px;
  }
}

/* 全螢幕樣式 */
.video-wrapper.fullscreen {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 9999;
  border-radius: 0;
}

.video-wrapper.fullscreen .video-controls {
  opacity: 1;
}
Day 9 上午：視訊播放器核心功能（2小時）
Step 4: 建立 video-player.js
javascript// js/video/video-player.js
export class VideoPlayer {
  constructor(videoElement) {
    this.video = videoElement;
    this.container = videoElement.parentElement;
    this.currentFile = null;
    this.isPlaying = false;
    
    // 控制元素
    this.controls = {
      playPause: document.getElementById('playPauseBtn'),
      progress: document.getElementById('videoProgress'),
      currentTime: document.getElementById('currentVideoTime'),
      totalTime: document.getElementById('totalVideoTime'),
      skipBack: document.getElementById('skipBackBtn'),
      skipForward: document.getElementById('skipForwardBtn'),
      speed: document.getElementById('videoSpeedSelect'),
      fullscreen: document.getElementById('fullscreenBtn')
    };
    
    this.skipSeconds = 5;
    this.init();
  }
  
  init() {
    this.bindEvents();
    this.setupKeyboardShortcuts();
  }
  
  bindEvents() {
    // 播放控制
    this.controls.playPause.addEventListener('click', () => this.togglePlayPause());
    this.controls.skipBack.addEventListener('click', () => this.skip(-this.skipSeconds));
    this.controls.skipForward.addEventListener('click', () => this.skip(this.skipSeconds));
    
    // 進度控制
    this.controls.progress.addEventListener('input', (e) => {
      const time = (e.target.value / 100) * this.video.duration;
      this.video.currentTime = time;
    });
    
    // 速度控制
    this.controls.speed.addEventListener('change', (e) => {
      this.video.playbackRate = parseFloat(e.target.value);
    });
    
    // 全螢幕
    this.controls.fullscreen.addEventListener('click', () => this.toggleFullscreen());
    
    // 視訊事件
    this.video.addEventListener('loadedmetadata', () => this.handleLoadedMetadata());
    this.video.addEventListener('timeupdate', () => this.handleTimeUpdate());
    this.video.addEventListener('play', () => this.handlePlay());
    this.video.addEventListener('pause', () => this.handlePause());
    this.video.addEventListener('ended', () => this.handleEnded());
    
    // 原生控制列隱藏（使用自定義控制列）
    this.video.controls = false;
  }
  
  setupKeyboardShortcuts() {
    document.addEventListener('keydown', (e) => {
      // 忽略輸入框中的按鍵
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
      
      switch(e.key) {
        case ' ':
          e.preventDefault();
          this.togglePlayPause();
          break;
        case 'ArrowLeft':
          this.skip(-this.skipSeconds);
          break;
        case 'ArrowRight':
          this.skip(this.skipSeconds);
          break;
        case 'ArrowUp':
          e.preventDefault();
          this.changeVolume(0.1);
          break;
        case 'ArrowDown':
          e.preventDefault();
          this.changeVolume(-0.1);
          break;
        case 'f':
        case 'F':
          this.toggleFullscreen();
          break;
      }
    });
  }
  
  loadFile(file) {
    return new Promise((resolve, reject) => {
      // 驗證檔案類型
      if (!file.type.startsWith('video/')) {
        reject(new Error('請選擇有效的視訊檔案'));
        return;
      }
      
      // 檢查檔案大小（建議小於 2GB）
      const maxSize = 2 * 1024 * 1024 * 1024;
      if (file.size > maxSize) {
        const sizeMB = Math.round(file.size / 1024 / 1024);
        if (!confirm(`檔案大小為 ${sizeMB}MB，可能會影響效能。是否繼續？`)) {
          reject(new Error('檔案太大'));
          return;
        }
      }
      
      this.currentFile = file;
      const url = URL.createObjectURL(file);
      
      this.video.src = url;
      this.video.load();
      
      // 等待載入完成
      this.video.addEventListener('loadeddata', () => {
        resolve({
          name: file.name,
          size: file.size,
          duration: this.video.duration
        });
      }, { once: true });
      
      this.video.addEventListener('error', (e) => {
        reject(new Error('視訊載入失敗'));
      }, { once: true });
    });
  }
  
  togglePlayPause() {
    if (this.video.paused) {
      this.play();
    } else {
      this.pause();
    }
  }
  
  play() {
    this.video.play();
  }
  
  pause() {
    this.video.pause();
  }
  
  skip(seconds) {
    this.video.currentTime = Math.max(0, Math.min(
      this.video.currentTime + seconds,
      this.video.duration
    ));
  }
  
  changeVolume(delta) {
    this.video.volume = Math.max(0, Math.min(1, this.video.volume + delta));
  }
  
  toggleFullscreen() {
    if (!document.fullscreenElement) {
      this.container.requestFullscreen().catch(err => {
        console.error('無法進入全螢幕:', err);
      });
      this.container.classList.add('fullscreen');
    } else {
      document.exitFullscreen();
      this.container.classList.remove('fullscreen');
    }
  }
  
  handleLoadedMetadata() {
    this.controls.totalTime.textContent = this.formatTime(this.video.duration);
    this.controls.progress.max = 100;
    
    // 通知字幕管理器檢查字幕
    const event = new CustomEvent('videoLoaded', {
      detail: { video: this.video }
    });
    document.dispatchEvent(event);
  }
  
  handleTimeUpdate() {
    const progress = (this.video.currentTime / this.video.duration) * 100;
    this.controls.progress.value = progress;
    this.controls.currentTime.textContent = this.formatTime(this.video.currentTime);
  }
  
  handlePlay() {
    this.isPlaying = true;
    this.updatePlayButton();
  }
  
  handlePause() {
    this.isPlaying = false;
    this.updatePlayButton();
  }
  
  handleEnded() {
    this.isPlaying = false;
    this.updatePlayButton();
  }
  
  updatePlayButton() {
    const icon = this.controls.playPause.querySelector('.icon');
    icon.textContent = this.isPlaying ? '⏸️' : '▶️';
  }
  
  formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  }
  
  getCurrentTime() {
    return this.video.currentTime;
  }
  
  seekTo(time) {
    this.video.currentTime = time;
  }
}
Day 9 下午：主程式整合（2小時）
Step 5: 建立 video-main.js
javascript// js/video/video-main.js
import { VideoPlayer } from './video-player.js';
import { SubtitleManager } from './subtitle-manager.js';
import { BookmarkManager } from './bookmark-manager.js';

class VideoApp {
  constructor() {
    this.player = null;
    this.subtitleManager = null;
    this.bookmarkManager = null;
    this.currentProject = null;
    
    this.init();
  }
  
  init() {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => this.setup());
    } else {
      this.setup();
    }
  }
  
  setup() {
    // 初始化播放器
    const videoElement = document.getElementById('videoPlayer');
    this.player = new VideoPlayer(videoElement);
    
    // 初始化字幕管理器
    this.subtitleManager = new SubtitleManager(videoElement);
    
    // 初始化標記管理器
    this.bookmarkManager = new BookmarkManager();
    
    // 綁定 UI 事件
    this.bindUIEvents();
    
    // 載入上次的專案（如果有）
    this.loadLastProject();
  }
  
  bindUIEvents() {
    // 檔案選擇
    const selectBtn = document.getElementById('selectVideoBtn');
    const fileInput = document.getElementById('videoInput');
    const uploadArea = document.getElementById('videoUploadArea');
    
    selectBtn.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', (e) => this.handleFileSelect(e.target.files));
    
    // 拖放
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('drag-over');
    });
    
    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('drag-over');
    });
    
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('drag-over');
      this.handleFileSelect(e.dataTransfer.files);
    });
    
    // 標籤切換
    const tabBtns = document.querySelectorAll('.tab-btn');
    tabBtns.forEach(btn => {
      btn.addEventListener('click', () => this.switchTab(btn.dataset.tab));
    });
    
    // 字幕搜尋
    const searchInput = document.getElementById('subtitleSearchInput');
    const searchBtn = document.getElementById('subtitleSearchBtn');
    
    searchBtn.addEventListener('click', () => this.handleSearch());
    searchInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') this.handleSearch();
    });
    
    // 標記功能
    const addBookmarkBtn = document.getElementById('addBookmarkBtn');
    addBookmarkBtn.addEventListener('click', () => this.showBookmarkModal());
    
    // Modal 控制
    this.setupModalControls();
    
    // 監聽自定義事件
    document.addEventListener('subtitleClick', (e) => {
      this.player.seekTo(e.detail.time);
    });
    
    document.addEventListener('bookmarkClick', (e) => {
      this.player.seekTo(e.detail.time);
    });
  }
  
  async handleFileSelect(files) {
    if (files.length === 0) return;
    
    try {
      const file = files[0];
      const info = await this.player.loadFile(file);
      
      // 顯示播放器
      document.getElementById('videoUploadArea').style.display = 'none';
      document.getElementById('videoPlayerContainer').style.display = 'flex';
      
      // 建立/更新專案
      this.currentProject = {
        id: `video_${Date.now()}`,
        fileName: file.name,
        fileSize: file.size,
        duration: info.duration,
        lastPlayed: new Date().toISOString()
      };
      
      // 檢查字幕
      this.subtitleManager.checkForSubtitles();
      
      // 儲存專案
      this.saveProject();
      
    } catch (error) {
      this.showError(error.message);
    }
  }
  
  switchTab(tabName) {
    // 更新標籤按鈕
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.tab === tabName);
    });
    
    // 切換面板
    document.getElementById('subtitlesPanel').style.display = 
      tabName === 'subtitles' ? 'block' : 'none';
    document.getElementById('bookmarksPanel').style.display = 
      tabName === 'bookmarks' ? 'block' : 'none';
  }
  
  handleSearch() {
    const query = document.getElementById('subtitleSearchInput').value.trim();
    if (!query) return;
    
    const results = this.subtitleManager.search(query);
    this.displaySearchResults(results);
  }
  
  displaySearchResults(results) {
    const container = document.getElementById('searchResults');
    container.innerHTML = '';
    
    if (results.length === 0) {
      container.innerHTML = '<p class="no-results">沒有找到相符的結果</p>';
    } else {
      results.forEach(result => {
        const item = document.createElement('div');
        item.className = 'search-result-item';
        item.innerHTML = `
          <div class="result-time">${this.formatTime(result.startTime)}</div>
          <div class="result-text">${this.highlightText(result.text, result.query)}</div>
        `;
        item.addEventListener('click', () => {
          this.player.seekTo(result.startTime);
        });
        container.appendChild(item);
      });
    }
    
    container.style.display = 'block';
  }
  
  highlightText(text, query) {
    const regex = new RegExp(`(${query})`, 'gi');
    return text.replace(regex, '<mark>$1</mark>');
  }
  
  showBookmarkModal(bookmark = null) {
    const modal = document.getElementById('bookmarkModal');
    const timeSpan = document.getElementById('bookmarkTime');
    const titleInput = document.getElementById('bookmarkTitle');
    const noteInput = document.getElementById('bookmarkNote');
    const categorySelect = document.getElementById('bookmarkCategory');
    
    // 設定時間
    const currentTime = this.player.getCurrentTime();
    timeSpan.textContent = this.formatTime(currentTime);
    
    // 如果是編輯模式
    if (bookmark) {
      titleInput.value = bookmark.title;
      noteInput.value = bookmark.note;
      categorySelect.value = bookmark.category;
      modal.dataset.bookmarkId = bookmark.id;
    } else {
      titleInput.value = '';
      noteInput.value = '';
      categorySelect.value = 'general';
      delete modal.dataset.bookmarkId;
    }
    
    modal.style.display = 'flex';
  }
  
  setupModalControls() {
    const modal = document.getElementById('bookmarkModal');
    const closeBtn = document.getElementById('bookmarkModalClose');
    const cancelBtn = document.getElementById('cancelBookmarkBtn');
    const saveBtn = document.getElementById('saveBookmarkBtn');
    
    closeBtn.addEventListener('click', () => this.hideModal(modal));
    cancelBtn.addEventListener('click', () => this.hideModal(modal));
    
    saveBtn.addEventListener('click', () => {
      const bookmark = {
        timestamp: this.player.getCurrentTime(),
        title: document.getElementById('bookmarkTitle').value,
        note: document.getElementById('bookmarkNote').value,
        category: document.getElementById('bookmarkCategory').value
      };
      
      if (modal.dataset.bookmarkId) {
        bookmark.id = modal.dataset.bookmarkId;
        this.bookmarkManager.updateBookmark(bookmark);
      } else {
        this.bookmarkManager.addBookmark(bookmark);
      }
      
      this.hideModal(modal);
    });
    
    // 點擊外部關閉
    modal.addEventListener('click', (e) => {
      if (e.target === modal) this.hideModal(modal);
    });
  }
  
  hideModal(modal) {
    modal.style.display = 'none';
  }
  
  formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  }
  
  saveProject() {
    if (!this.currentProject) return;
    
    // 整合所有資料
    this.currentProject.subtitles = this.subtitleManager.getSubtitleInfo();
    this.currentProject.bookmarks = this.bookmarkManager.getAllBookmarks();
    
    // 儲存到 localStorage（暫時）
    const key = `whisper_video_${this.currentProject.id}`;
    localStorage.setItem(key, JSON.stringify(this.currentProject));
    localStorage.setItem('whisper_lastVideoProject', this.currentProject.id);
  }
  
  loadLastProject() {
    const lastProjectId = localStorage.getItem('whisper_lastVideoProject');
    if (!lastProjectId) return;
    
    const key = `whisper_video_${lastProjectId}`;
    const data = localStorage.getItem(key);
    
    if (data) {
      try {
        this.currentProject = JSON.parse(data);
        // TODO: 恢復專案狀態
      } catch (e) {
        console.error('載入專案失敗:', e);
      }
    }
  }
  
  showError(message) {
    // TODO: 實作更好的錯誤提示
    alert(message);
  }
}

// 初始化應用
const app = new VideoApp();
window.videoApp = app;
Day 10-11: 字幕功能
Day 10：字幕提取與管理（4小時）
Step 6: 建立 subtitle-manager.js
javascript// js/video/subtitle-manager.js
export class SubtitleManager {
  constructor(videoElement) {
    this.video = videoElement;
    this.subtitles = [];
    this.tracks = [];
    this.searchIndex = new Map();
    
    this.init();
  }
  
  init() {
    // 監聽視訊載入事件
    document.addEventListener('videoLoaded', (e) => {
      this.checkForSubtitles();
    });
  }
  
  checkForSubtitles() {
    // 檢查內嵌字幕軌道
    const tracks = this.video.textTracks;
    this.tracks = Array.from(tracks);
    
    if (this.tracks.length > 0) {
      this.extractSubtitles();
      this.updateStatus(`找到 ${this.tracks.length} 個字幕軌道`);
    } else {
      this.updateStatus('未找到內嵌字幕');
      // TODO: 提供載入外部字幕的選項
    }
  }
  
  extractSubtitles() {
    this.subtitles = [];
    
    this.tracks.forEach((track, trackIndex) => {
      // 啟用軌道以載入字幕
      track.mode = 'hidden';
      
      // 監聽 cue 變化
      track.addEventListener('cuechange', () => {
        this.handleCueChange(track);
      });
      
      // 提取所有 cues
      if (track.cues) {
        Array.from(track.cues).forEach((cue, cueIndex) => {
          const subtitle = {
            id: `${trackIndex}_${cueIndex}`,
            trackIndex,
            cueIndex,
            startTime: cue.startTime,
            endTime: cue.endTime,
            text: cue.text,
            language: track.language || 'unknown'
          };
          
          this.subtitles.push(subtitle);
          this.indexSubtitle(subtitle);
        });
      }
    });
    
    console.log(`提取了 ${this.subtitles.length} 條字幕`);
    this.buildSearchIndex();
  }
  
  indexSubtitle(subtitle) {
    // 簡單的中文分詞
    const words = this.tokenize(subtitle.text);
    
    words.forEach(word => {
      if (!this.searchIndex.has(word)) {
        this.searchIndex.set(word, []);
      }
      this.searchIndex.get(word).push(subtitle);
    });
  }
  
  tokenize(text) {
    // 移除標點符號
    const cleanText = text.replace(/[，。！？、；：""''（）《》【】]/g, ' ');
    
    // 分割單詞
    const words = cleanText.toLowerCase().split(/\s+/).filter(w => w.length > 0);
    
    // 對中文進行簡單的分詞（2-4字詞）
    const chineseWords = [];
    const chineseRegex = /[\u4e00-\u9fa5]+/g;
    let match;
    
    while ((match = chineseRegex.exec(cleanText)) !== null) {
      const chineseText = match[0];
      // 生成 2-4 字的詞組
      for (let len = 2; len <= Math.min(4, chineseText.length); len++) {
        for (let i = 0; i <= chineseText.length - len; i++) {
          chineseWords.push(chineseText.substr(i, len));
        }
      }
    }
    
    return [...words, ...chineseWords];
  }
  
  buildSearchIndex() {
    // 已在 indexSubtitle 中建立
    console.log(`建立了 ${this.searchIndex.size} 個索引詞`);
  }
  
  search(query) {
    const queryWords = this.tokenize(query.toLowerCase());
    const resultMap = new Map();
    
    // 搜尋每個詞
    queryWords.forEach(word => {
      const matches = this.searchIndex.get(word) || [];
      
      matches.forEach(subtitle => {
        if (!resultMap.has(subtitle.id)) {
          resultMap.set(subtitle.id, {
            ...subtitle,
            score: 0,
            matchedWords: []
          });
        }
        
        const result = resultMap.get(subtitle.id);
        result.score++;
        result.matchedWords.push(word);
      });
    });
    
    // 轉換為陣列並排序
    const results = Array.from(resultMap.values())
      .sort((a, b) => b.score - a.score || a.startTime - b.startTime)
      .map(result => ({
        ...result,
        query
      }));
    
    return results;
  }
  
  handleCueChange(track) {
    // 處理當前字幕變化（可用於顯示當前字幕）
    const activeCues = track.activeCues;
    if (activeCues && activeCues.length > 0) {
      const currentSubtitle = activeCues[0].text;
      // TODO: 更新 UI 顯示當前字幕
    }
  }
  
  updateStatus(message) {
    const statusEl = document.getElementById('subtitleStatus');
    if (statusEl) {
      statusEl.innerHTML = `<p>${message}</p>`;
    }
  }
  
  getSubtitleInfo() {
    return {
      tracks: this.tracks.map(t => ({
        language: t.language,
        label: t.label,
        kind: t.kind
      })),
      count: this.subtitles.length,
      indexed: this.searchIndex.size > 0
    };
  }
  
  // 載入外部字幕檔案
  async loadExternalSubtitle(file) {
    try {
      const text = await file.text();
      const format = this.detectSubtitleFormat(file.name);
      
      let subtitles;
      if (format === 'srt') {
        subtitles = this.parseSRT(text);
      } else if (format === 'vtt') {
        subtitles = this.parseVTT(text);
      } else {
        throw new Error('不支援的字幕格式');
      }
      
      // 加入到現有字幕
      const trackIndex = this.tracks.length;
      subtitles.forEach((sub, index) => {
        const subtitle = {
          id: `${trackIndex}_${index}`,
          trackIndex,
          cueIndex: index,
          ...sub,
          language: 'external'
        };
        
        this.subtitles.push(subtitle);
        this.indexSubtitle(subtitle);
      });
      
      this.updateStatus(`成功載入外部字幕：${subtitles.length} 條`);
      
    } catch (error) {
      console.error('載入字幕失敗:', error);
      this.updateStatus('載入字幕失敗：' + error.message);
    }
  }
  
  detectSubtitleFormat(filename) {
    const ext = filename.split('.').pop().toLowerCase();
    return ext;
  }
  
  parseSRT(srtText) {
    const subtitles = [];
    const blocks = srtText.trim().split(/\n\s*\n/);
    
    blocks.forEach(block => {
      const lines = block.trim().split('\n');
      if (lines.length >= 3) {
        const timeMatch = lines[1].match(/(\d{2}:\d{2}:\d{2},\d{3}) --> (\d{2}:\d{2}:\d{2},\d{3})/);
        if (timeMatch) {
          subtitles.push({
            startTime: this.parseTime(timeMatch[1]),
            endTime: this.parseTime(timeMatch[2]),
            text: lines.slice(2).join('\n')
          });
        }
      }
    });
    
    return subtitles;
  }
  
  parseVTT(vttText) {
    // 移除 WEBVTT 標頭
    const content = vttText.replace(/^WEBVTT\s*\n/, '');
    // VTT 格式類似 SRT，但時間格式使用點而非逗號
    return this.parseSRT(content.replace(/\./g, ','));
  }
  
  parseTime(timeStr) {
    const parts = timeStr.match(/(\d{2}):(\d{2}):(\d{2})[,.](\d{3})/);
    if (parts) {
      const hours = parseInt(parts[1]);
      const minutes = parseInt(parts[2]);
      const seconds = parseInt(parts[3]);
      const milliseconds = parseInt(parts[4]);
      
      return hours * 3600 + minutes * 60 + seconds + milliseconds / 1000;
    }
    return 0;
  }
}
Day 12-13: 搜尋功能與標記系統
Day 12：標記管理器（4小時）
Step 7: 建立 bookmark-manager.js
javascript// js/video/bookmark-manager.js
export class BookmarkManager {
  constructor() {
    this.bookmarks = [];
    this.container = document.getElementById('bookmarksList');
    this.videoId = null;
    
    this.init();
  }
  
  init() {
    // 監聽視訊載入
    document.addEventListener('videoLoaded', (e) => {
      this.videoId = `video_${Date.now()}`;
      this.loadBookmarks();
    });
    
    // 定期儲存
    setInterval(() => this.saveBookmarks(), 5000);
  }
  
  addBookmark(data) {
    const bookmark = {
      id: `bm_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
      videoId: this.videoId,
      timestamp: data.timestamp,
      title: data.title || '未命名標記',
      note: data.note || '',
      category: data.category || 'general',
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    };
    
    this.bookmarks.push(bookmark);
    this.sortBookmarks();
    this.render();
    this.saveBookmarks();
    
    return bookmark;
  }
  
  updateBookmark(data) {
    const index = this.bookmarks.findIndex(b => b.id === data.id);
    if (index !== -1) {
      this.bookmarks[index] = {
        ...this.bookmarks[index],
        ...data,
        updatedAt: new Date().toISOString()
      };
      
      this.render();
      this.saveBookmarks();
    }
  }
  
  deleteBookmark(id) {
    this.bookmarks = this.bookmarks.filter(b => b.id !== id);
    this.render();
    this.saveBookmarks();
  }
  
  sortBookmarks() {
    this.bookmarks.sort((a, b) => a.timestamp - b.timestamp);
  }
  
  render() {
    if (!this.container) return;
    
    this.container.innerHTML = '';
    
    if (this.bookmarks.length === 0) {
      this.container.innerHTML = '<p class="no-bookmarks">尚無標記</p>';
      return;
    }
    
    this.bookmarks.forEach(bookmark => {
      const element = this.createBookmarkElement(bookmark);
      this.container.appendChild(element);
    });
  }
  
  createBookmarkElement(bookmark) {
    const div = document.createElement('div');
    div.className = 'bookmark-item';
    div.dataset.bookmarkId = bookmark.id;
    
    div.innerHTML = `
      <div class="bookmark-header">
        <span class="bookmark-time" data-time="${bookmark.timestamp}">
          ${this.formatTime(bookmark.timestamp)}
        </span>
        <span class="bookmark-category ${bookmark.category}">
          ${this.getCategoryLabel(bookmark.category)}
        </span>
      </div>
      <div class="bookmark-title">${bookmark.title}</div>
      ${bookmark.note ? `<div class="bookmark-note">${bookmark.note}</div>` : ''}
      <div class="bookmark-actions">
        <button class="edit-btn" data-id="${bookmark.id}">編輯</button>
        <button class="delete-btn" data-id="${bookmark.id}">刪除</button>
      </div>
    `;
    
    // 綁定事件
    const timeEl = div.querySelector('.bookmark-time');
    timeEl.addEventListener('click', () => {
      const event = new CustomEvent('bookmarkClick', {
        detail: { time: bookmark.timestamp }
      });
      document.dispatchEvent(event);
    });
    
    const editBtn = div.querySelector('.edit-btn');
    editBtn.addEventListener('click', () => {
      window.videoApp.showBookmarkModal(bookmark);
    });
    
    const deleteBtn = div.querySelector('.delete-btn');
    deleteBtn.addEventListener('click', () => {
      if (confirm('確定要刪除這個標記嗎？')) {
        this.deleteBookmark(bookmark.id);
      }
    });
    
    return div;
  }
  
  getCategoryLabel(category) {
    const labels = {
      'general': '一般',
      'important': '重要',
      'question': '問題',
      'error': '錯誤'
    };
    return labels[category] || category;
  }
  
  formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  }
  
  saveBookmarks() {
    if (!this.videoId) return;
    
    const key = `whisper_bookmarks_${this.videoId}`;
    localStorage.setItem(key, JSON.stringify(this.bookmarks));
  }
  
  loadBookmarks() {
    if (!this.videoId) return;
    
    const key = `whisper_bookmarks_${this.videoId}`;
    const data = localStorage.getItem(key);
    
    if (data) {
      try {
        this.bookmarks = JSON.parse(data);
        this.render();
      } catch (e) {
        console.error('載入標記失敗:', e);
        this.bookmarks = [];
      }
    }
  }
  
  getAllBookmarks() {
    return [...this.bookmarks];
  }
  
  exportBookmarks(format = 'json') {
    if (format === 'json') {
      return JSON.stringify(this.bookmarks, null, 2);
    } else if (format === 'csv') {
      const headers = ['時間', '標題', '筆記', '分類', '建立時間'];
      const rows = this.bookmarks.map(b => [
        this.formatTime(b.timestamp),
        b.title,
        b.note,
        this.getCategoryLabel(b.category),
        new Date(b.createdAt).toLocaleString()
      ]);
      
      return [headers, ...rows]
        .map(row => row.map(cell => `"${cell}"`).join(','))
        .join('\n');
    }
  }
  
  importBookmarks(data, format = 'json') {
    try {
      if (format === 'json') {
        const bookmarks = JSON.parse(data);
        if (Array.isArray(bookmarks)) {
          this.bookmarks = [...this.bookmarks, ...bookmarks];
          this.sortBookmarks();
          this.render();
          this.saveBookmarks();
          return bookmarks.length;
        }
      }
      throw new Error('無效的匯入格式');
    } catch (error) {
      console.error('匯入標記失敗:', error);
      throw error;
    }
  }
}
Day 14-15: 勘誤系統與整合優化
Day 14：勘誤功能擴展（4小時）
Step 8: 擴展標記系統為勘誤表
在 bookmark-manager.js 中加入勘誤相關功能：
javascript// 加入勘誤相關方法
generateCorrectionReport() {
  const corrections = this.bookmarks.filter(b => b.category === 'error');
  
  let report = '# 影片勘誤報告\n\n';
  report += `檔案名稱：${window.videoApp.currentProject?.fileName || '未知'}\n`;
  report += `產生時間：${new Date().toLocaleString()}\n`;
  report += `勘誤數量：${corrections.length}\n\n`;
  report += '---\n\n';
  
  corrections.forEach((correction, index) => {
    report += `## ${index + 1}. ${correction.title}\n`;
    report += `時間點：${this.formatTime(correction.timestamp)}\n`;
    report += `描述：${correction.note}\n`;
    report += `標記時間：${new Date(correction.createdAt).toLocaleString()}\n\n`;
  });
  
  return report;
}

exportCorrectionReport(format = 'markdown') {
  const report = this.generateCorrectionReport();
  const filename = `勘誤報告_${new Date().toISOString().split('T')[0]}`;
  
  if (format === 'markdown') {
    this.download(report, `${filename}.md`, 'text/markdown');
  } else if (format === 'html') {
    // 轉換 Markdown 為 HTML（簡單實作）
    const html = this.markdownToHtml(report);
    this.download(html, `${filename}.html`, 'text/html');
  }
}

markdownToHtml(markdown) {
  let html = markdown
    .replace(/^# (.*$)/gim, '<h1>$1</h1>')
    .replace(/^## (.*$)/gim, '<h2>$1</h2>')
    .replace(/^---$/gim, '<hr>')
    .replace(/\n\n/g, '</p><p>')
    .replace(/\n/g, '<br>');
  
  return `
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="UTF-8">
      <title>影片勘誤報告</title>
      <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        h1 { color: #333; }
        h2 { color: #666; }
        hr { margin: 20px 0; }
      </style>
    </head>
    <body>
      <p>${html}</p>
    </body>
    </html>
  `;
}

download(content, filename, mimeType) {
  const blob = new Blob([content], { type: mimeType });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}
Day 15：效能優化與最終測試（4小時）
Step 9: 加入效能優化
建立 js/video/video-performance.js：
javascript// 效能監控與優化
export class PerformanceMonitor {
  constructor() {
    this.metrics = {
      videoLoadTime: 0,
      subtitleIndexTime: 0,
      searchTime: [],
      memoryUsage: []
    };
    
    this.startMonitoring();
  }
  
  startMonitoring() {
    // 監控記憶體使用（如果支援）
    if (performance.memory) {
      setInterval(() => {
        this.metrics.memoryUsage.push({
          time: Date.now(),
          used: performance.memory.usedJSHeapSize,
          total: performance.memory.totalJSHeapSize
        });
        
        // 保留最近 100 個數據點
        if (this.metrics.memoryUsage.length > 100) {
          this.metrics.memoryUsage.shift();
        }
        
        // 檢查記憶體使用
        this.checkMemoryUsage();
      }, 5000);
    }
  }
  
  checkMemoryUsage() {
    if (!performance.memory) return;
    
    const used = performance.memory.usedJSHeapSize;
    const limit = performance.memory.jsHeapSizeLimit;
    const usage = used / limit;
    
    if (usage > 0.9) {
      console.warn('記憶體使用率過高:', Math.round(usage * 100) + '%');
      this.suggestOptimization();
    }
  }
  
  suggestOptimization() {
    // 建議優化措施
    const suggestions = [
      '考慮關閉其他分頁',
      '清理不需要的標記',
      '重新載入頁面'
    ];
    
    console.log('優化建議:', suggestions);
  }
  
  measureVideoLoad(startTime) {
    this.metrics.videoLoadTime = Date.now() - startTime;
    console.log(`視訊載入時間: ${this.metrics.videoLoadTime}ms`);
  }
  
  measureSubtitleIndex(startTime, count) {
    this.metrics.subtitleIndexTime = Date.now() - startTime;
    console.log(`字幕索引時間: ${this.metrics.subtitleIndexTime}ms (${count} 條)`);
  }
  
  measureSearch(startTime, resultCount) {
    const duration = Date.now() - startTime;
    this.metrics.searchTime.push({
      duration,
      resultCount,
      timestamp: Date.now()
    });
    
    console.log(`搜尋時間: ${duration}ms (${resultCount} 個結果)`);
  }
  
  getReport() {
    return {
      ...this.metrics,
      averageSearchTime: this.calculateAverageSearchTime(),
      currentMemoryUsage: this.getCurrentMemoryUsage()
    };
  }
  
  calculateAverageSearchTime() {
    if (this.metrics.searchTime.length === 0) return 0;
    
    const total = this.metrics.searchTime.reduce((sum, item) => sum + item.duration, 0);
    return Math.round(total / this.metrics.searchTime.length);
  }
  
  getCurrentMemoryUsage() {
    if (!performance.memory) return null;
    
    return {
      used: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024),
      total: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024),
      limit: Math.round(performance.memory.jsHeapSizeLimit / 1024 / 1024)
    };
  }
}
Step 10: 整合測試清單
在 video-main.js 中加入測試模式：
javascript// 加入除錯模式
enableDebugMode() {
  window.videoDebug = {
    player: this.player,
    subtitleManager: this.subtitleManager,
    bookmarkManager: this.bookmarkManager,
    
    // 測試功能
    testSearch: (query) => {
      console.time('Search');
      const results = this.subtitleManager.search(query);
      console.timeEnd('Search');
      console.log(`Found ${results.length} results`);
      return results;
    },
    
    testBookmarks: () => {
      // 自動生成測試標記
      for (let i = 0; i < 10; i++) {
        this.bookmarkManager.addBookmark({
          timestamp: i * 60,
          title: `測試標記 ${i + 1}`,
          note: `這是第 ${i + 1} 個測試標記`,
          category: ['general', 'important', 'question', 'error'][i % 4]
        });
      }
    },
    
    clearAll: () => {
      if (confirm('確定要清除所有資料嗎？')) {
        localStorage.clear();
        location.reload();
      }
    }
  };
  
  console.log('Debug mode enabled. Use window.videoDebug to access debug functions.');
}
📝 測試檢查清單
基本功能測試

 視訊檔案載入（拖放/選擇）
 播放控制（播放/暫停/進度）
 速度控制
 全螢幕模式
 鍵盤快捷鍵

字幕功能測試

 內嵌字幕提取
 字幕搜尋
 搜尋結果點擊跳轉
 中文搜尋準確性

標記功能測試

 新增標記
 編輯標記
 刪除標記
 標記跳轉
 勘誤報告匯出

效能測試

 大檔案載入（> 1GB）
 長字幕搜尋（> 10000條）
 記憶體使用監控
 多次操作穩定性

相容性測試

 Chrome/Edge
 Firefox
 Safari
 不同視訊格式（MP4, WebM）

🚀 部署前檢查

移除除錯程式碼
壓縮 CSS/JS（可選）
更新導航連結
撰寫使用說明
Git commit 並推送