<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¢å¼·ç‰ˆé€²åº¦ç®¡ç†å™¨æ¸¬è©¦</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/progress.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 8px;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .test-button {
            padding: 15px 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .test-button:active {
            transform: translateY(0);
        }
        
        .test-info {
            background: var(--bg-tertiary);
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .test-info code {
            background: var(--bg-primary);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1>å¢å¼·ç‰ˆé€²åº¦ç®¡ç†å™¨æ¸¬è©¦</h1>
            <p>æ¸¬è©¦æ•´åˆå¾Œçš„é€²åº¦é¡¯ç¤ºåŠŸèƒ½</p>
        </header>

        <div class="test-container">
            <div class="test-info">
                <h3>æ¸¬è©¦èªªæ˜</h3>
                <p>é€™å€‹é é¢æ¸¬è©¦å¢å¼·ç‰ˆé€²åº¦ç®¡ç†å™¨çš„å„ç¨®åŠŸèƒ½ï¼š</p>
                <ul>
                    <li>éšæ®µå¼é€²åº¦é¡¯ç¤º</li>
                    <li>è©³ç´°è³‡è¨Šé¢æ¿</li>
                    <li>åˆ†æ®µé€²åº¦ï¼ˆç”¨æ–¼éŸ³è¨Šåˆ†å‰²ï¼‰</li>
                    <li>å–æ¶ˆåŠŸèƒ½æ•´åˆ</li>
                    <li>éŒ¯èª¤è™•ç†é¡¯ç¤º</li>
                </ul>
            </div>

            <div class="test-section">
                <h3>åŸºæœ¬åŠŸèƒ½æ¸¬è©¦</h3>
                <div class="test-grid">
                    <button class="test-button" onclick="testBasicProgress()">
                        åŸºæœ¬é€²åº¦
                    </button>
                    <button class="test-button" onclick="testStagesProgress()">
                        éšæ®µé€²åº¦
                    </button>
                    <button class="test-button" onclick="testDetailedProgress()">
                        è©³ç´°é€²åº¦
                    </button>
                    <button class="test-button" onclick="testCancellableProgress()">
                        å¯å–æ¶ˆé€²åº¦
                    </button>
                </div>
            </div>

            <div class="test-section">
                <h3>è½‰è­¯æµç¨‹æ¸¬è©¦</h3>
                <div class="test-grid">
                    <button class="test-button" onclick="testDirectTranscription()">
                        ç›´æ¥è½‰è­¯
                    </button>
                    <button class="test-button" onclick="testWASMTranscription()">
                        WASM è½‰è­¯
                    </button>
                    <button class="test-button" onclick="testSegmentedTranscription()">
                        åˆ†æ®µè½‰è­¯
                    </button>
                    <button class="test-button" onclick="testCompressionProgress()">
                        å£“ç¸®è™•ç†
                    </button>
                </div>
            </div>

            <div class="test-section">
                <h3>éŒ¯èª¤è™•ç†æ¸¬è©¦</h3>
                <div class="test-grid">
                    <button class="test-button" onclick="testErrorHandling()">
                        éŒ¯èª¤é¡¯ç¤º
                    </button>
                    <button class="test-button" onclick="testCancellation()">
                        å–æ¶ˆæ“ä½œ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { progressManager, showProcessingProgress } from '../js/progress-manager.js';
        
        // åŸºæœ¬é€²åº¦æ¸¬è©¦
        window.testBasicProgress = function() {
            const progress = progressManager.showProgress({
                title: 'åŸºæœ¬é€²åº¦æ¸¬è©¦',
                message: 'æ­£åœ¨è™•ç†...',
                cancellable: false,
                showDetails: false,
                icon: 'âš¡'
            });
            
            let percentage = 0;
            const interval = setInterval(() => {
                percentage += 10;
                progress.update(percentage, `è™•ç†ä¸­... ${percentage}%`);
                
                if (percentage >= 100) {
                    clearInterval(interval);
                    progress.complete();
                }
            }, 500);
        };
        
        // éšæ®µé€²åº¦æ¸¬è©¦
        window.testStagesProgress = function() {
            const progress = showProcessingProgress(
                'éšæ®µå¼è™•ç†æ¸¬è©¦',
                ['æº–å‚™éšæ®µ', 'è™•ç†éšæ®µ', 'é©—è­‰éšæ®µ', 'å®Œæˆéšæ®µ'],
                () => console.log('å·²å–æ¶ˆ')
            );
            
            let stage = 0;
            const nextStage = () => {
                if (stage < 4) {
                    progress.setStage(stage);
                    progress.update(stage * 25, `æ­£åœ¨åŸ·è¡Œç¬¬ ${stage + 1} éšæ®µ...`);
                    stage++;
                    setTimeout(nextStage, 1500);
                } else {
                    progress.complete();
                }
            };
            
            nextStage();
        };
        
        // è©³ç´°é€²åº¦æ¸¬è©¦
        window.testDetailedProgress = function() {
            const progress = progressManager.showProgress({
                title: 'è©³ç´°è³‡è¨Šæ¸¬è©¦',
                message: 'é¡¯ç¤ºè™•ç†è©³æƒ…...',
                stages: ['åˆ†æ', 'è™•ç†', 'è¼¸å‡º'],
                cancellable: true,
                onCancel: () => console.log('ä½¿ç”¨è€…å–æ¶ˆ'),
                showDetails: true,
                icon: 'ğŸ“Š'
            });
            
            progress.setStage(0);
            progress.addDetail('æª”æ¡ˆåç¨±', 'test-audio.mp3');
            progress.addDetail('æª”æ¡ˆå¤§å°', '45.3 MB');
            progress.addDetail('è™•ç†æ–¹å¼', 'æ™ºèƒ½å£“ç¸®');
            
            let percentage = 0;
            const interval = setInterval(() => {
                percentage += 5;
                progress.update(percentage);
                
                // å‹•æ…‹æ›´æ–°è©³æƒ…
                if (percentage === 30) {
                    progress.setStage(1);
                    progress.addDetail('å£“ç¸®æ¯”', '65%');
                } else if (percentage === 70) {
                    progress.setStage(2);
                    progress.addDetail('è¼¸å‡ºå¤§å°', '29.4 MB');
                }
                
                if (percentage >= 100) {
                    clearInterval(interval);
                    progress.addDetail('è™•ç†æ™‚é–“', '12.5 ç§’');
                    progress.complete();
                }
            }, 300);
        };
        
        // å¯å–æ¶ˆé€²åº¦æ¸¬è©¦
        window.testCancellableProgress = function() {
            let cancelled = false;
            const progress = progressManager.showProgress({
                title: 'å¯å–æ¶ˆæ“ä½œ',
                message: 'é»æ“Šå–æ¶ˆæŒ‰éˆ•åœæ­¢è™•ç†...',
                cancellable: true,
                onCancel: () => {
                    cancelled = true;
                    console.log('æ“ä½œå·²å–æ¶ˆ');
                },
                showDetails: true,
                icon: 'ğŸ›‘'
            });
            
            progress.addDetail('ç‹€æ…‹', 'è™•ç†ä¸­');
            
            let percentage = 0;
            const interval = setInterval(() => {
                if (cancelled) {
                    clearInterval(interval);
                    progress.close();
                    return;
                }
                
                percentage += 2;
                progress.update(percentage, `è™•ç†é€²åº¦ ${percentage}%`);
                progress.addDetail('å·²è™•ç†', `${percentage} / 100`);
                
                if (percentage >= 100) {
                    clearInterval(interval);
                    progress.complete();
                }
            }, 200);
        };
        
        // ç›´æ¥è½‰è­¯æ¸¬è©¦
        window.testDirectTranscription = function() {
            const progress = showProcessingProgress(
                'éŸ³è¨Šè½‰è­¯è™•ç†',
                ['æº–å‚™æª”æ¡ˆ', 'åŸ·è¡Œè½‰è­¯', 'è™•ç†çµæœ'],
                () => console.log('å–æ¶ˆè½‰è­¯')
            );
            
            progress.setStage(0);
            progress.update(10, 'æª”æ¡ˆæº–å‚™å®Œæˆ');
            progress.addDetail('æª”æ¡ˆåç¨±', 'sample.mp3');
            progress.addDetail('æª”æ¡ˆå¤§å°', '15.2 MB');
            progress.addDetail('è™•ç†ç­–ç•¥', 'direct');
            
            setTimeout(() => {
                progress.setStage(1);
                progress.update(50, 'æ­£åœ¨é€²è¡Œ API è½‰è­¯...');
                progress.addDetail('è½‰è­¯æ–¹å¼', 'é›²ç«¯ API');
                
                // æ¨¡æ“¬è½‰è­¯é€²åº¦
                let transcribeProgress = 50;
                const transcribeInterval = setInterval(() => {
                    transcribeProgress += 10;
                    progress.update(transcribeProgress, `è½‰è­¯ä¸­... ${transcribeProgress - 50}%`);
                    
                    if (transcribeProgress >= 90) {
                        clearInterval(transcribeInterval);
                        progress.setStage(2);
                        progress.update(95, 'å„²å­˜è½‰è­¯çµæœ...');
                        progress.addDetail('è½‰è­¯æ®µè½æ•¸', '42');
                        progress.addDetail('ç¸½æ™‚é•·', '8 åˆ†é˜');
                        
                        setTimeout(() => {
                            progress.complete();
                        }, 1000);
                    }
                }, 800);
            }, 1500);
        };
        
        // WASM è½‰è­¯æ¸¬è©¦
        window.testWASMTranscription = function() {
            const progress = showProcessingProgress(
                'æœ¬åœ°è½‰è­¯è™•ç†',
                ['æº–å‚™æª”æ¡ˆ', 'åŸ·è¡Œè½‰è­¯', 'è™•ç†çµæœ'],
                () => console.log('å–æ¶ˆè½‰è­¯')
            );
            
            progress.setStage(0);
            progress.update(25, 'æª”æ¡ˆæº–å‚™å®Œæˆ');
            progress.addDetail('æª”æ¡ˆåç¨±', 'local-audio.wav');
            progress.addDetail('æª”æ¡ˆå¤§å°', '32.5 MB');
            progress.addDetail('è™•ç†ç­–ç•¥', 'wasm');
            
            setTimeout(() => {
                progress.setStage(1);
                progress.update(50, 'æ­£åœ¨é€²è¡Œæœ¬åœ°è½‰è­¯...');
                progress.addDetail('è½‰è­¯æ–¹å¼', 'WebAssembly æœ¬åœ°');
                progress.addDetail('æ¨¡å‹', 'base');
                
                // æ¨¡æ“¬ WASM è½‰è­¯é€²åº¦
                let wasmProgress = 0;
                const wasmInterval = setInterval(() => {
                    wasmProgress += 5;
                    const overallProgress = 50 + (wasmProgress * 0.4);
                    progress.update(overallProgress, `æœ¬åœ°è™•ç†ä¸­... ${wasmProgress}%`);
                    progress.addDetail('è™•ç†é€Ÿåº¦', `${(wasmProgress / 20).toFixed(1)}x`);
                    
                    if (wasmProgress >= 100) {
                        clearInterval(wasmInterval);
                        progress.update(90, 'è½‰è­¯å®Œæˆï¼Œè™•ç†çµæœä¸­...');
                        
                        setTimeout(() => {
                            progress.setStage(2);
                            progress.update(95, 'å„²å­˜è½‰è­¯çµæœ...');
                            progress.addDetail('è½‰è­¯æ®µè½æ•¸', '58');
                            progress.addDetail('ç¸½æ™‚é•·', '12 åˆ†é˜');
                            progress.complete();
                        }, 1000);
                    }
                }, 600);
            }, 1500);
        };
        
        // åˆ†æ®µè½‰è­¯æ¸¬è©¦
        window.testSegmentedTranscription = function() {
            const progress = showProcessingProgress(
                'éŸ³è¨Šè½‰è­¯è™•ç†',
                ['æº–å‚™æª”æ¡ˆ', 'åŸ·è¡Œè½‰è­¯', 'è™•ç†çµæœ'],
                () => console.log('å–æ¶ˆè½‰è­¯')
            );
            
            progress.setStage(0);
            progress.update(25, 'æª”æ¡ˆæº–å‚™å®Œæˆ');
            progress.addDetail('æª”æ¡ˆåç¨±', 'large-audio.mp3');
            progress.addDetail('æª”æ¡ˆå¤§å°', '156.8 MB');
            progress.addDetail('è™•ç†ç­–ç•¥', 'split');
            
            setTimeout(() => {
                progress.setStage(1);
                progress.update(50, 'ä½¿ç”¨splitç­–ç•¥è™•ç†...');
                progress.addDetail('è™•ç†ç­–ç•¥', 'split');
                
                // é¡¯ç¤ºåˆ†æ®µé€²åº¦
                const totalSegments = 8;
                const segmentProgress = progressManager.showSegmentProgress(totalSegments);
                progress.addDetail('ç¸½æ®µæ•¸', totalSegments);
                
                let currentSegment = 0;
                const processSegment = () => {
                    if (currentSegment < totalSegments) {
                        const segmentPercentage = 50 + ((currentSegment / totalSegments) * 40);
                        progress.update(segmentPercentage, `æ­£åœ¨è½‰è­¯ç¬¬ ${currentSegment + 1}/${totalSegments} æ®µ...`);
                        segmentProgress.setSegmentStatus(currentSegment, 'processing');
                        
                        setTimeout(() => {
                            segmentProgress.setSegmentStatus(currentSegment, 'completed');
                            currentSegment++;
                            processSegment();
                        }, 1200);
                    } else {
                        progress.update(90, 'æ‰€æœ‰åˆ†æ®µè½‰è­¯å®Œæˆï¼Œåˆä½µçµæœä¸­...');
                        
                        setTimeout(() => {
                            progress.setStage(2);
                            progress.update(95, 'å„²å­˜è½‰è­¯çµæœ...');
                            progress.addDetail('è½‰è­¯æ®µè½æ•¸', '186');
                            progress.addDetail('ç¸½æ™‚é•·', '45 åˆ†é˜');
                            progress.complete();
                        }, 1000);
                    }
                };
                
                processSegment();
            }, 1500);
        };
        
        // å£“ç¸®é€²åº¦æ¸¬è©¦
        window.testCompressionProgress = function() {
            const progress = progressManager.showProgress({
                title: 'éŸ³è¨Šå£“ç¸®è™•ç†',
                message: 'æ­£åœ¨æ™ºèƒ½å£“ç¸®éŸ³è¨Šæª”æ¡ˆ...',
                stages: ['åˆ†æéŸ³è¨Šå“è³ª', 'è¨ˆç®—å£“ç¸®åƒæ•¸', 'åŸ·è¡Œå£“ç¸®', 'é©—è­‰å“è³ª'],
                cancellable: true,
                onCancel: () => console.log('å–æ¶ˆå£“ç¸®'),
                showDetails: true,
                icon: 'ğŸ—œï¸'
            });
            
            progress.setStage(0);
            progress.addDetail('åŸå§‹å¤§å°', '85.6 MB');
            progress.addDetail('ç›®æ¨™å¤§å°', '25.0 MB');
            
            const stages = [
                { stage: 0, progress: 25, message: 'åˆ†æéŸ³è¨Šå“è³ªä¸­...' },
                { stage: 1, progress: 50, message: 'è¨ˆç®—æœ€ä½³å£“ç¸®åƒæ•¸...' },
                { stage: 2, progress: 85, message: 'åŸ·è¡Œæ™ºèƒ½å£“ç¸®...' },
                { stage: 3, progress: 95, message: 'é©—è­‰å£“ç¸®å“è³ª...' }
            ];
            
            let currentIndex = 0;
            const processStage = () => {
                if (currentIndex < stages.length) {
                    const { stage, progress: prog, message } = stages[currentIndex];
                    progress.setStage(stage);
                    progress.update(prog, message);
                    
                    if (stage === 2) {
                        progress.addDetail('å£“ç¸®æ¯”', '29.2%');
                    }
                    
                    currentIndex++;
                    setTimeout(processStage, 1500);
                } else {
                    progress.addDetail('å£“ç¸®å¾Œå¤§å°', '25.0 MB');
                    progress.addDetail('å£“ç¸®æ¯”ç‡', '29%');
                    progress.complete();
                }
            };
            
            processStage();
        };
        
        // éŒ¯èª¤è™•ç†æ¸¬è©¦
        window.testErrorHandling = function() {
            const progress = progressManager.showProgress({
                title: 'éŒ¯èª¤è™•ç†æ¸¬è©¦',
                message: 'æ¨¡æ“¬è™•ç†éŒ¯èª¤...',
                cancellable: false,
                showDetails: true,
                icon: 'âš ï¸'
            });
            
            progress.addDetail('æ“ä½œ', 'æª”æ¡ˆè™•ç†');
            progress.update(30, 'è™•ç†ä¸­...');
            
            setTimeout(() => {
                progress.update(60, 'ç™¼ç”ŸéŒ¯èª¤...');
                setTimeout(() => {
                    progress.error('è™•ç†å¤±æ•—ï¼šæª”æ¡ˆæ ¼å¼ä¸æ”¯æ´');
                }, 1000);
            }, 1500);
        };
        
        // å–æ¶ˆæ“ä½œæ¸¬è©¦
        window.testCancellation = function() {
            let cancelToken = { cancelled: false };
            
            const progress = showProcessingProgress(
                'å–æ¶ˆæ“ä½œæ¸¬è©¦',
                ['æº–å‚™', 'è™•ç†', 'å®Œæˆ'],
                () => {
                    cancelToken.cancelled = true;
                    console.log('æ“ä½œå·²è¢«å–æ¶ˆ');
                }
            );
            
            progress.setStage(0);
            progress.update(10, 'æº–å‚™ä¸­...');
            progress.addDetail('æç¤º', 'é»æ“Šå–æ¶ˆæŒ‰éˆ•æ¸¬è©¦');
            
            let percentage = 10;
            const interval = setInterval(() => {
                if (cancelToken.cancelled) {
                    clearInterval(interval);
                    progress.close();
                    alert('æ“ä½œå·²æˆåŠŸå–æ¶ˆï¼');
                    return;
                }
                
                percentage += 5;
                progress.update(percentage, `è™•ç†é€²åº¦ ${percentage}%`);
                
                if (percentage === 40) {
                    progress.setStage(1);
                } else if (percentage === 80) {
                    progress.setStage(2);
                }
                
                if (percentage >= 100) {
                    clearInterval(interval);
                    progress.complete();
                }
            }, 400);
        };
        
        console.log('å¢å¼·ç‰ˆé€²åº¦ç®¡ç†å™¨æ¸¬è©¦é é¢å·²è¼‰å…¥');
    </script>
</body>
</html>