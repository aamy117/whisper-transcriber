<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>è¦–è¨ŠåŠŸèƒ½æ¸¬è©¦é é¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        .test-case {
            margin: 10px 0;
            padding: 10px;
            border-left: 3px solid #ddd;
        }
        .test-case.pass {
            border-color: #4CAF50;
            background: #f1f8f4;
        }
        .test-case.fail {
            border-color: #f44336;
            background: #ffebee;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: #2196F3;
            color: white;
        }
        button:hover {
            background: #1976D2;
        }
        .test-video {
            width: 100%;
            max-width: 600px;
            margin: 20px 0;
        }
        .test-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        textarea {
            width: 100%;
            height: 100px;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .result-box {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª è¦–è¨ŠåŠŸèƒ½æ¸¬è©¦é é¢</h1>
    
    <!-- æ¸¬è©¦å½±ç‰‡ -->
    <div class="test-section">
        <div class="test-title">ğŸ“¹ æ¸¬è©¦å½±ç‰‡</div>
        <video id="testVideo" controls class="test-video">
            <source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">
            æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´ video æ¨™ç±¤ã€‚
        </video>
    </div>

    <!-- å­—å¹•æœå°‹æ¸¬è©¦ -->
    <div class="test-section">
        <div class="test-title">ğŸ” å­—å¹•æœå°‹åŠŸèƒ½æ¸¬è©¦</div>
        
        <div class="test-controls">
            <button onclick="loadTestSubtitle()">è¼‰å…¥æ¸¬è©¦å­—å¹•</button>
            <button onclick="testSubtitleSearch('test')">æœå°‹ "test"</button>
            <button onclick="testSubtitleSearch('ä½ å¥½')">æœå°‹ "ä½ å¥½"</button>
            <button onclick="testSubtitleSearch('')">æ¸¬è©¦ç©ºç™½æœå°‹</button>
            <button onclick="testSpecialCharSearch()">æ¸¬è©¦ç‰¹æ®Šå­—å…ƒ</button>
        </div>
        
        <textarea id="subtitleContent" placeholder="å­—å¹•å…§å®¹å°‡é¡¯ç¤ºåœ¨é€™è£¡..."></textarea>
        
        <div class="test-case" id="subtitle-test-1">
            âœ“ è¼‰å…¥ SRT æ ¼å¼å­—å¹•
        </div>
        <div class="test-case" id="subtitle-test-2">
            âœ“ æœå°‹ä¸­æ–‡é—œéµå­—
        </div>
        <div class="test-case" id="subtitle-test-3">
            âœ“ æœå°‹çµæœå°èˆªï¼ˆä¸Šä¸€å€‹/ä¸‹ä¸€å€‹ï¼‰
        </div>
        <div class="test-case" id="subtitle-test-4">
            âœ“ é»æ“Šçµæœè·³è½‰åˆ°å°æ‡‰æ™‚é–“
        </div>
        
        <div class="result-box" id="subtitleResult">æœå°‹çµæœå°‡é¡¯ç¤ºåœ¨é€™è£¡...</div>
    </div>

    <!-- æ™‚é–“æ¨™è¨˜æ¸¬è©¦ -->
    <div class="test-section">
        <div class="test-title">ğŸ”– æ™‚é–“æ¨™è¨˜åŠŸèƒ½æ¸¬è©¦</div>
        
        <div class="test-controls">
            <button onclick="addTestBookmark()">æ–°å¢æ¸¬è©¦æ¨™è¨˜</button>
            <button onclick="addBookmarkWithNote()">æ–°å¢å¸¶å‚™è¨»æ¨™è¨˜</button>
            <button onclick="testBookmarkList()">é¡¯ç¤ºæ¨™è¨˜åˆ—è¡¨</button>
            <button onclick="testExportBookmarks()">åŒ¯å‡ºæ¨™è¨˜</button>
            <button onclick="testImportBookmarks()">åŒ¯å…¥æ¨™è¨˜</button>
            <button onclick="clearAllBookmarks()">æ¸…é™¤æ‰€æœ‰æ¨™è¨˜</button>
        </div>
        
        <div class="test-case" id="bookmark-test-1">
            âœ“ æ–°å¢æ™‚é–“æ¨™è¨˜
        </div>
        <div class="test-case" id="bookmark-test-2">
            âœ“ æ¨™è¨˜åˆ—è¡¨é¡¯ç¤ºèˆ‡æ’åº
        </div>
        <div class="test-case" id="bookmark-test-3">
            âœ“ é»æ“Šæ¨™è¨˜è·³è½‰
        </div>
        <div class="test-case" id="bookmark-test-4">
            âœ“ åŒ¯å…¥/åŒ¯å‡ºåŠŸèƒ½
        </div>
        <div class="test-case" id="bookmark-test-5">
            âœ“ localStorage æŒä¹…åŒ–
        </div>
        
        <div class="result-box" id="bookmarkResult">æ¨™è¨˜æ“ä½œçµæœå°‡é¡¯ç¤ºåœ¨é€™è£¡...</div>
    </div>

    <!-- æ•ˆèƒ½æ¸¬è©¦ -->
    <div class="test-section">
        <div class="test-title">âš¡ æ•ˆèƒ½æ¸¬è©¦</div>
        
        <div class="test-controls">
            <button onclick="performanceTest()">åŸ·è¡Œæ•ˆèƒ½æ¸¬è©¦</button>
            <button onclick="stressTest()">å£“åŠ›æ¸¬è©¦ï¼ˆ100å€‹æ¨™è¨˜ï¼‰</button>
            <button onclick="memoryTest()">è¨˜æ†¶é«”ä½¿ç”¨æ¸¬è©¦</button>
        </div>
        
        <div class="result-box" id="performanceResult">æ•ˆèƒ½æ¸¬è©¦çµæœå°‡é¡¯ç¤ºåœ¨é€™è£¡...</div>
    </div>

    <script>
        // æ¸¬è©¦è³‡æ–™
        const testSubtitle = `1
00:00:00,000 --> 00:00:02,000
ä½ å¥½ï¼Œæ­¡è¿ä½¿ç”¨æ¸¬è©¦å­—å¹•

2
00:00:02,500 --> 00:00:05,000
é€™æ˜¯ç¬¬äºŒè¡Œæ¸¬è©¦æ–‡å­—

3
00:00:05,500 --> 00:00:08,000
Test subtitle line three

4
00:00:08,500 --> 00:00:10,000
ç‰¹æ®Šå­—å…ƒæ¸¬è©¦ï¼š@#$%^&*()`;

        const testBookmarks = [
            { time: 5.5, note: "é‡è¦ç‰‡æ®µé–‹å§‹" },
            { time: 15.3, note: "é—œéµå°è©±" },
            { time: 30.0, note: "çµå°¾éƒ¨åˆ†" }
        ];

        // è¼‰å…¥æ¸¬è©¦å­—å¹•
        function loadTestSubtitle() {
            document.getElementById('subtitleContent').value = testSubtitle;
            updateTestStatus('subtitle-test-1', true, 'æˆåŠŸè¼‰å…¥æ¸¬è©¦å­—å¹•');
            log('å­—å¹•å·²è¼‰å…¥', 'subtitle');
        }

        // æ¸¬è©¦å­—å¹•æœå°‹
        function testSubtitleSearch(keyword) {
            const content = document.getElementById('subtitleContent').value;
            const lines = content.split('\n');
            let results = [];
            
            lines.forEach((line, index) => {
                if (line.includes(keyword) && !line.match(/^\d+$/) && !line.includes('-->')) {
                    results.push({ line: index, text: line });
                }
            });
            
            if (keyword === '') {
                updateTestStatus('subtitle-test-2', false, 'ç©ºç™½æœå°‹æ‡‰è©²è¦æœ‰æç¤º');
            } else {
                updateTestStatus('subtitle-test-2', true, `æ‰¾åˆ° ${results.length} å€‹çµæœ`);
            }
            
            log(`æœå°‹ "${keyword}"ï¼šæ‰¾åˆ° ${results.length} å€‹çµæœ`, 'subtitle');
        }

        // æ¸¬è©¦ç‰¹æ®Šå­—å…ƒæœå°‹
        function testSpecialCharSearch() {
            testSubtitleSearch('@#$%^&*');
        }

        // æ–°å¢æ¸¬è©¦æ¨™è¨˜
        function addTestBookmark() {
            const video = document.getElementById('testVideo');
            const currentTime = video.currentTime;
            const bookmark = { time: currentTime, note: '' };
            
            // æ¨¡æ“¬å„²å­˜åˆ° localStorage
            let bookmarks = JSON.parse(localStorage.getItem('videoBookmarks') || '[]');
            bookmarks.push(bookmark);
            localStorage.setItem('videoBookmarks', JSON.stringify(bookmarks));
            
            updateTestStatus('bookmark-test-1', true, `å·²æ–°å¢æ¨™è¨˜åœ¨ ${currentTime.toFixed(1)}s`);
            log(`æ–°å¢æ¨™è¨˜ï¼š${currentTime.toFixed(1)}s`, 'bookmark');
        }

        // æ–°å¢å¸¶å‚™è¨»çš„æ¨™è¨˜
        function addBookmarkWithNote() {
            const video = document.getElementById('testVideo');
            const currentTime = video.currentTime;
            const note = prompt('è«‹è¼¸å…¥å‚™è¨»ï¼š', 'æ¸¬è©¦å‚™è¨»');
            
            if (note !== null) {
                const bookmark = { time: currentTime, note: note };
                let bookmarks = JSON.parse(localStorage.getItem('videoBookmarks') || '[]');
                bookmarks.push(bookmark);
                localStorage.setItem('videoBookmarks', JSON.stringify(bookmarks));
                
                updateTestStatus('bookmark-test-1', true, `å·²æ–°å¢å¸¶å‚™è¨»çš„æ¨™è¨˜`);
                log(`æ–°å¢æ¨™è¨˜ï¼š${currentTime.toFixed(1)}s - ${note}`, 'bookmark');
            }
        }

        // é¡¯ç¤ºæ¨™è¨˜åˆ—è¡¨
        function testBookmarkList() {
            const bookmarks = JSON.parse(localStorage.getItem('videoBookmarks') || '[]');
            
            // æ¸¬è©¦æ’åº
            bookmarks.sort((a, b) => a.time - b.time);
            
            let listHtml = bookmarks.map((b, i) => 
                `${i+1}. ${formatTime(b.time)} - ${b.note || '(ç„¡å‚™è¨»)'}`
            ).join('\n');
            
            updateTestStatus('bookmark-test-2', true, `é¡¯ç¤º ${bookmarks.length} å€‹æ¨™è¨˜`);
            log(`æ¨™è¨˜åˆ—è¡¨ï¼š\n${listHtml}`, 'bookmark');
        }

        // åŒ¯å‡ºæ¨™è¨˜
        function testExportBookmarks() {
            const bookmarks = JSON.parse(localStorage.getItem('videoBookmarks') || '[]');
            const exportData = {
                version: '1.0',
                videoName: 'test-video',
                bookmarks: bookmarks,
                exportTime: new Date().toISOString()
            };
            
            const json = JSON.stringify(exportData, null, 2);
            updateTestStatus('bookmark-test-4', true, 'æˆåŠŸåŒ¯å‡ºæ¨™è¨˜');
            log(`åŒ¯å‡ºè³‡æ–™ï¼š\n${json}`, 'bookmark');
        }

        // åŒ¯å…¥æ¨™è¨˜
        function testImportBookmarks() {
            const importData = {
                version: '1.0',
                videoName: 'test-video',
                bookmarks: testBookmarks,
                exportTime: new Date().toISOString()
            };
            
            localStorage.setItem('videoBookmarks', JSON.stringify(importData.bookmarks));
            updateTestStatus('bookmark-test-4', true, `æˆåŠŸåŒ¯å…¥ ${importData.bookmarks.length} å€‹æ¨™è¨˜`);
            log('æ¨™è¨˜å·²åŒ¯å…¥', 'bookmark');
        }

        // æ¸…é™¤æ‰€æœ‰æ¨™è¨˜
        function clearAllBookmarks() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ¨™è¨˜å—ï¼Ÿ')) {
                localStorage.removeItem('videoBookmarks');
                updateTestStatus('bookmark-test-5', true, 'å·²æ¸…é™¤æ‰€æœ‰æ¨™è¨˜');
                log('æ‰€æœ‰æ¨™è¨˜å·²æ¸…é™¤', 'bookmark');
            }
        }

        // æ•ˆèƒ½æ¸¬è©¦
        function performanceTest() {
            const startTime = performance.now();
            
            // æ¸¬è©¦æœå°‹æ•ˆèƒ½
            for (let i = 0; i < 100; i++) {
                testSubtitleSearch('test');
            }
            
            const searchTime = performance.now() - startTime;
            
            // æ¸¬è©¦æ¨™è¨˜æ¸²æŸ“æ•ˆèƒ½
            const renderStart = performance.now();
            testBookmarkList();
            const renderTime = performance.now() - renderStart;
            
            log(`æ•ˆèƒ½æ¸¬è©¦çµæœï¼š\næœå°‹ 100 æ¬¡ï¼š${searchTime.toFixed(2)}ms\næ¸²æŸ“æ¨™è¨˜åˆ—è¡¨ï¼š${renderTime.toFixed(2)}ms`, 'performance');
        }

        // å£“åŠ›æ¸¬è©¦
        function stressTest() {
            // å‰µå»º 100 å€‹æ¨™è¨˜
            const bookmarks = [];
            for (let i = 0; i < 100; i++) {
                bookmarks.push({
                    time: Math.random() * 300,
                    note: `æ¸¬è©¦æ¨™è¨˜ ${i + 1}`
                });
            }
            
            localStorage.setItem('videoBookmarks', JSON.stringify(bookmarks));
            
            const startTime = performance.now();
            testBookmarkList();
            const endTime = performance.now();
            
            log(`å£“åŠ›æ¸¬è©¦ï¼šè™•ç† 100 å€‹æ¨™è¨˜è€—æ™‚ ${(endTime - startTime).toFixed(2)}ms`, 'performance');
        }

        // è¨˜æ†¶é«”æ¸¬è©¦
        function memoryTest() {
            if (performance.memory) {
                const before = performance.memory.usedJSHeapSize;
                
                // åŸ·è¡Œä¸€äº›æ“ä½œ
                for (let i = 0; i < 10; i++) {
                    addTestBookmark();
                }
                
                const after = performance.memory.usedJSHeapSize;
                const diff = (after - before) / 1024 / 1024;
                
                log(`è¨˜æ†¶é«”ä½¿ç”¨ï¼šå¢åŠ äº† ${diff.toFixed(2)} MB`, 'performance');
            } else {
                log('ç€è¦½å™¨ä¸æ”¯æ´è¨˜æ†¶é«”æ¸¬è©¦', 'performance');
            }
        }

        // å·¥å…·å‡½æ•¸
        function formatTime(seconds) {
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60);
            return `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
        }

        function updateTestStatus(testId, pass, message) {
            const element = document.getElementById(testId);
            if (element) {
                element.className = 'test-case ' + (pass ? 'pass' : 'fail');
                element.innerHTML = (pass ? 'âœ…' : 'âŒ') + ' ' + element.textContent.split(' ').slice(1).join(' ') + 
                                   (message ? ` - ${message}` : '');
            }
        }

        function log(message, type) {
            const resultBox = document.getElementById(type + 'Result');
            if (resultBox) {
                resultBox.textContent = message;
            }
            console.log(`[${type}] ${message}`);
        }

        // é é¢è¼‰å…¥æ™‚æª¢æŸ¥
        window.onload = function() {
            console.log('æ¸¬è©¦é é¢å·²è¼‰å…¥');
            
            // æª¢æŸ¥ localStorage
            const bookmarks = localStorage.getItem('videoBookmarks');
            if (bookmarks) {
                log(`ç™¼ç¾ ${JSON.parse(bookmarks).length} å€‹å·²å­˜åœ¨çš„æ¨™è¨˜`, 'bookmark');
            }
        };
    </script>
</body>
</html>