<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€²åº¦é¡¯ç¤º UI æ¸¬è©¦</title>
    
    <link rel="stylesheet" href="css/shared.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/progress.css">
    
    <style>
        .test-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
        }
        
        .test-header {
            text-align: center;
            padding: 2rem;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .test-card {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .test-card h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }
        
        .test-card button {
            width: 100%;
            margin-top: 1rem;
        }
        
        .demo-section {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        
        .inline-demo {
            margin: 2rem 0;
        }
        
        .log-area {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1rem;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸ“Š é€²åº¦é¡¯ç¤º UI æ¸¬è©¦</h1>
            <p>æ¸¬è©¦å„ç¨®é€²åº¦é¡¯ç¤ºå…ƒä»¶å’Œæƒ…å¢ƒ</p>
        </div>
        
        <!-- åŸºæœ¬é€²åº¦æ¸¬è©¦ -->
        <div class="test-grid">
            <div class="test-card">
                <h3>ğŸ¯ åŸºæœ¬é€²åº¦æ¢</h3>
                <p>ç°¡å–®çš„é€²åº¦é¡¯ç¤ºï¼Œç„¡å–æ¶ˆæŒ‰éˆ•</p>
                <button class="btn btn-primary" onclick="testBasicProgress()">æ¸¬è©¦åŸºæœ¬é€²åº¦</button>
            </div>
            
            <div class="test-card">
                <h3>âš™ï¸ éšæ®µé€²åº¦</h3>
                <p>å¤šéšæ®µè™•ç†é€²åº¦é¡¯ç¤º</p>
                <button class="btn btn-primary" onclick="testStageProgress()">æ¸¬è©¦éšæ®µé€²åº¦</button>
            </div>
            
            <div class="test-card">
                <h3>ğŸš« å¯å–æ¶ˆé€²åº¦</h3>
                <p>æ”¯æ´å–æ¶ˆæ“ä½œçš„é€²åº¦</p>
                <button class="btn btn-primary" onclick="testCancellableProgress()">æ¸¬è©¦å¯å–æ¶ˆé€²åº¦</button>
            </div>
            
            <div class="test-card">
                <h3>ğŸ“‹ è©³ç´°è³‡è¨Šé€²åº¦</h3>
                <p>é¡¯ç¤ºè™•ç†è©³ç´°è³‡è¨Š</p>
                <button class="btn btn-primary" onclick="testDetailedProgress()">æ¸¬è©¦è©³ç´°é€²åº¦</button>
            </div>
            
            <div class="test-card">
                <h3>ğŸµ éŸ³è¨Šåˆ†å‰²é€²åº¦</h3>
                <p>æ¨¡æ“¬éŸ³è¨Šåˆ†å‰²è™•ç†</p>
                <button class="btn btn-primary" onclick="testAudioSplitting()">æ¸¬è©¦åˆ†å‰²é€²åº¦</button>
            </div>
            
            <div class="test-card">
                <h3>âŒ éŒ¯èª¤è™•ç†</h3>
                <p>æ¸¬è©¦éŒ¯èª¤ç‹€æ…‹é¡¯ç¤º</p>
                <button class="btn btn-primary" onclick="testErrorProgress()">æ¸¬è©¦éŒ¯èª¤ç‹€æ…‹</button>
            </div>
        </div>
        
        <!-- å…§è¯é€²åº¦æ¢ç¤ºç¯„ -->
        <div class="demo-section">
            <h3>å…§è¯é€²åº¦æ¢ç¤ºç¯„</h3>
            <div class="inline-demo" id="inlineDemo1"></div>
            <div class="inline-demo" id="inlineDemo2"></div>
            <button class="btn btn-secondary" onclick="testInlineProgress()">æ¸¬è©¦å…§è¯é€²åº¦</button>
        </div>
        
        <!-- æ¸¬è©¦æ—¥èªŒ -->
        <div class="demo-section">
            <h3>æ¸¬è©¦æ—¥èªŒ</h3>
            <div class="log-area" id="testLog">
                ç­‰å¾…æ¸¬è©¦é–‹å§‹...
            </div>
        </div>
    </div>

    <script type="module">
        import { ProgressManager, showProgress, showSimpleProgress, showProcessingProgress } from './js/progress-manager.js';
        
        const progressManager = new ProgressManager();
        let currentProgress = null;
        let cancelled = false;
        
        // æ—¥èªŒåŠŸèƒ½
        function log(message) {
            const logArea = document.getElementById('testLog');
            const time = new Date().toLocaleTimeString();
            logArea.innerHTML += `<div>[${time}] ${message}</div>`;
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        // æ¸¬è©¦åŸºæœ¬é€²åº¦
        window.testBasicProgress = async function() {
            log('é–‹å§‹åŸºæœ¬é€²åº¦æ¸¬è©¦');
            
            currentProgress = showSimpleProgress('è™•ç†ä¸­', 'æ­£åœ¨åŸ·è¡ŒåŸºæœ¬ä»»å‹™...');
            
            // æ¨¡æ“¬é€²åº¦æ›´æ–°
            for (let i = 0; i <= 100; i += 10) {
                currentProgress.update(i, `è™•ç†ä¸­... ${i}%`);
                await new Promise(resolve => setTimeout(resolve, 300));
            }
            
            currentProgress.complete();
            log('åŸºæœ¬é€²åº¦æ¸¬è©¦å®Œæˆ');
        };
        
        // æ¸¬è©¦éšæ®µé€²åº¦
        window.testStageProgress = async function() {
            log('é–‹å§‹éšæ®µé€²åº¦æ¸¬è©¦');
            
            const stages = [
                'æº–å‚™æª”æ¡ˆ',
                'éŸ³è¨Šè§£ç¢¼',
                'è½‰è­¯è™•ç†',
                'çµæœæ•´ç†',
                'å„²å­˜è¼¸å‡º'
            ];
            
            currentProgress = showProgress({
                title: 'éŸ³è¨Šè½‰è­¯',
                message: 'æ­£åœ¨è™•ç†æ‚¨çš„éŸ³è¨Šæª”æ¡ˆ...',
                stages: stages,
                showDetails: true,
                icon: 'ğŸµ'
            });
            
            for (let i = 0; i < stages.length; i++) {
                currentProgress.setStage(i);
                currentProgress.setMessage(`æ­£åœ¨${stages[i]}...`);
                
                // æ¨¡æ“¬æ¯å€‹éšæ®µçš„é€²åº¦
                for (let j = 0; j <= 100; j += 25) {
                    const overallProgress = (i * 100 + j) / stages.length;
                    currentProgress.update(overallProgress);
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
            }
            
            currentProgress.complete();
            log('éšæ®µé€²åº¦æ¸¬è©¦å®Œæˆ');
        };
        
        // æ¸¬è©¦å¯å–æ¶ˆé€²åº¦
        window.testCancellableProgress = async function() {
            log('é–‹å§‹å¯å–æ¶ˆé€²åº¦æ¸¬è©¦');
            cancelled = false;
            
            currentProgress = showProcessingProgress(
                'å¤§æª”æ¡ˆè™•ç†',
                ['æª”æ¡ˆåˆ†æ', 'éŸ³è¨Šå£“ç¸®', 'API ä¸Šå‚³', 'çµæœè™•ç†'],
                () => {
                    cancelled = true;
                    log('ä½¿ç”¨è€…å–æ¶ˆäº†æ“ä½œ');
                }
            );
            
            for (let i = 0; i <= 100; i += 5) {
                if (cancelled) {
                    log('æ“ä½œå·²å–æ¶ˆ');
                    break;
                }
                
                currentProgress.update(i, `è™•ç†é€²åº¦ ${i}%`);
                
                if (i === 25) currentProgress.setStage(1);
                if (i === 50) currentProgress.setStage(2);
                if (i === 75) currentProgress.setStage(3);
                
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            if (!cancelled) {
                currentProgress.complete();
                log('å¯å–æ¶ˆé€²åº¦æ¸¬è©¦å®Œæˆ');
            }
        };
        
        // æ¸¬è©¦è©³ç´°è³‡è¨Šé€²åº¦
        window.testDetailedProgress = async function() {
            log('é–‹å§‹è©³ç´°è³‡è¨Šé€²åº¦æ¸¬è©¦');
            
            currentProgress = showProgress({
                title: 'æª”æ¡ˆä¸Šå‚³',
                message: 'æ­£åœ¨ä¸Šå‚³éŸ³è¨Šæª”æ¡ˆ...',
                showDetails: true,
                icon: 'ğŸ“¤'
            });
            
            const fileSize = 25.6; // MB
            let uploaded = 0;
            
            currentProgress.addDetail('æª”æ¡ˆåç¨±', 'recording.wav');
            currentProgress.addDetail('æª”æ¡ˆå¤§å°', `${fileSize} MB`);
            currentProgress.addDetail('ä¸Šå‚³é€Ÿåº¦', '0 KB/s');
            
            const interval = setInterval(() => {
                uploaded += Math.random() * 2;
                if (uploaded > fileSize) uploaded = fileSize;
                
                const progress = (uploaded / fileSize) * 100;
                const speed = (Math.random() * 500 + 100).toFixed(0);
                
                currentProgress.update(progress);
                currentProgress.addDetail('å·²ä¸Šå‚³', `${uploaded.toFixed(1)} MB`);
                currentProgress.addDetail('ä¸Šå‚³é€Ÿåº¦', `${speed} KB/s`);
                
                if (uploaded >= fileSize) {
                    clearInterval(interval);
                    currentProgress.complete();
                    log('è©³ç´°è³‡è¨Šé€²åº¦æ¸¬è©¦å®Œæˆ');
                }
            }, 500);
        };
        
        // æ¸¬è©¦éŸ³è¨Šåˆ†å‰²é€²åº¦
        window.testAudioSplitting = async function() {
            log('é–‹å§‹éŸ³è¨Šåˆ†å‰²é€²åº¦æ¸¬è©¦');
            
            currentProgress = showProgress({
                title: 'éŸ³è¨Šåˆ†å‰²è™•ç†',
                message: 'æ­£åœ¨å°‡å¤§æª”æ¡ˆåˆ†å‰²æˆå°æ®µ...',
                stages: ['æª”æ¡ˆåˆ†æ', 'åˆ†å‰²è™•ç†', 'æ®µè½è½‰è­¯', 'çµæœåˆä½µ'],
                showDetails: true,
                icon: 'âœ‚ï¸'
            });
            
            // é¡¯ç¤ºåˆ†æ®µé€²åº¦
            const segmentProgress = currentProgress.showSegmentProgress?.(10) || 
                                  progressManager.showSegmentProgress(10);
            
            currentProgress.setStage(0);
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            currentProgress.setStage(1);
            for (let i = 0; i < 10; i++) {
                segmentProgress?.setSegmentStatus(i, 'processing');
                currentProgress.update((i + 1) * 10, `è™•ç†ç¬¬ ${i + 1}/10 æ®µ`);
                await new Promise(resolve => setTimeout(resolve, 300));
                segmentProgress?.setSegmentStatus(i, 'completed');
            }
            
            currentProgress.setStage(2);
            currentProgress.update(100, 'æ‰€æœ‰æ®µè½è™•ç†å®Œæˆ');
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            currentProgress.complete();
            log('éŸ³è¨Šåˆ†å‰²é€²åº¦æ¸¬è©¦å®Œæˆ');
        };
        
        // æ¸¬è©¦éŒ¯èª¤ç‹€æ…‹
        window.testErrorProgress = async function() {
            log('é–‹å§‹éŒ¯èª¤ç‹€æ…‹æ¸¬è©¦');
            
            currentProgress = showProgress({
                title: 'API è½‰è­¯',
                message: 'æ­£åœ¨é€£æ¥ OpenAI API...',
                icon: 'ğŸŒ'
            });
            
            // æ¨¡æ“¬è™•ç†
            for (let i = 0; i <= 60; i += 10) {
                currentProgress.update(i, `è™•ç†ä¸­... ${i}%`);
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            // æ¨¡æ“¬éŒ¯èª¤
            currentProgress.error('API é€£ç·šå¤±æ•—ï¼šè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š');
            log('éŒ¯èª¤ç‹€æ…‹æ¸¬è©¦å®Œæˆ');
        };
        
        // æ¸¬è©¦å…§è¯é€²åº¦
        window.testInlineProgress = function() {
            log('é–‹å§‹å…§è¯é€²åº¦æ¸¬è©¦');
            
            const progress1 = progressManager.createInlineProgress(
                document.getElementById('inlineDemo1'),
                { label: 'æª”æ¡ˆè™•ç†' }
            );
            
            const progress2 = progressManager.createInlineProgress(
                document.getElementById('inlineDemo2'),
                { label: 'è³‡æ–™ä¸Šå‚³', showPercentage: false }
            );
            
            let value = 0;
            const interval = setInterval(() => {
                value += 5;
                progress1.update(value);
                progress2.update(value);
                
                if (value >= 100) {
                    clearInterval(interval);
                    log('å…§è¯é€²åº¦æ¸¬è©¦å®Œæˆ');
                }
            }, 100);
        };
        
        // é é¢è¼‰å…¥å®Œæˆ
        log('é€²åº¦é¡¯ç¤º UI æ¸¬è©¦é é¢å·²å°±ç·’');
    </script>
</body>
</html>