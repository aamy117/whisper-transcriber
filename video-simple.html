<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>視訊播放器 - 簡單版</title>
    <link rel="stylesheet" href="css/shared.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/video.css">
</head>
<body>
    <!-- 導航列 -->
    <nav class="app-navigation">
        <div class="nav-container">
            <div class="nav-brand">
                <h1 class="nav-title">Whisper 工具</h1>
            </div>
            <div class="nav-links">
                <a href="index.html" class="nav-link">
                    <span class="nav-icon">🎵</span>
                    <span>音訊工具</span>
                </a>
                <a href="video.html" class="nav-link active">
                    <span class="nav-icon">🎬</span>
                    <span>視訊工具</span>
                </a>
            </div>
        </div>
    </nav>

    <div id="video-app">
        <header class="app-header">
            <div class="container">
                <h1 class="app-title">視訊播放器（簡單版）</h1>
            </div>
        </header>

        <main class="video-main">
            <div style="max-width: 800px; margin: 0 auto; padding: 20px;">
                <!-- 上傳區域 -->
                <div id="uploadArea" style="border: 2px dashed #ccc; padding: 40px; text-align: center; margin-bottom: 20px;">
                    <h2>上傳影片檔案</h2>
                    <p>點擊下方按鈕選擇檔案</p>
                    <input type="file" id="videoInput" accept="video/*" style="display: none;">
                    <button id="selectBtn" style="padding: 10px 20px; font-size: 16px;">選擇檔案</button>
                </div>

                <!-- 視訊播放器 -->
                <div id="playerArea" style="display: none;">
                    <video id="videoPlayer" controls style="width: 100%; max-width: 800px;"></video>
                    <div id="videoInfo" style="margin-top: 10px; padding: 10px; background: #f0f0f0;">
                        <p>檔案名稱：<span id="fileName">-</span></p>
                        <p>檔案大小：<span id="fileSize">-</span></p>
                    </div>
                </div>

                <!-- 錯誤訊息 -->
                <div id="errorMsg" style="color: red; margin-top: 20px;"></div>
            </div>
        </main>
    </div>

    <script>
        console.log('Script 開始執行');
        
        // 取得元素
        const selectBtn = document.getElementById('selectBtn');
        const videoInput = document.getElementById('videoInput');
        const uploadArea = document.getElementById('uploadArea');
        const playerArea = document.getElementById('playerArea');
        const videoPlayer = document.getElementById('videoPlayer');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const errorMsg = document.getElementById('errorMsg');
        
        // 檢查元素是否存在
        console.log('元素檢查：', {
            selectBtn: !!selectBtn,
            videoInput: !!videoInput,
            videoPlayer: !!videoPlayer
        });
        
        // 綁定按鈕點擊事件
        if (selectBtn && videoInput) {
            selectBtn.addEventListener('click', () => {
                console.log('按鈕被點擊');
                videoInput.click();
            });
            
            // 綁定檔案選擇事件
            videoInput.addEventListener('change', (e) => {
                console.log('檔案選擇事件觸發');
                const file = e.target.files[0];
                
                if (file) {
                    console.log('選擇的檔案：', file.name, file.type, file.size);
                    
                    if (file.type.startsWith('video/')) {
                        // 顯示檔案資訊
                        fileName.textContent = file.name;
                        fileSize.textContent = formatFileSize(file.size);
                        
                        // 載入視訊
                        const url = URL.createObjectURL(file);
                        videoPlayer.src = url;
                        
                        // 顯示播放器
                        playerArea.style.display = 'block';
                        errorMsg.textContent = '';
                        
                        console.log('視訊載入成功');
                    } else {
                        errorMsg.textContent = '請選擇視訊檔案';
                    }
                }
            });
            
            // 拖放功能
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.background = '#f0f0f0';
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.style.background = '';
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.background = '';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    videoInput.files = files;
                    const event = new Event('change', { bubbles: true });
                    videoInput.dispatchEvent(event);
                }
            });
        } else {
            console.error('找不到必要的元素');
            errorMsg.textContent = 'JavaScript 初始化失敗';
        }
        
        // 格式化檔案大小
        function formatFileSize(bytes) {
            const sizes = ['B', 'KB', 'MB', 'GB'];
            if (bytes === 0) return '0 B';
            const i = Math.floor(Math.log(bytes) / Math.log(1024));
            return `${(bytes / Math.pow(1024, i)).toFixed(2)} ${sizes[i]}`;
        }
        
        // 視訊事件
        videoPlayer.addEventListener('loadedmetadata', () => {
            console.log('視訊 metadata 載入完成', {
                duration: videoPlayer.duration,
                width: videoPlayer.videoWidth,
                height: videoPlayer.videoHeight
            });
        });
        
        videoPlayer.addEventListener('error', (e) => {
            console.error('視訊載入錯誤：', e);
            errorMsg.textContent = '視訊載入失敗';
        });
        
        console.log('Script 執行完成');
    </script>
</body>
</html>