<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆå§‹åŒ–é †åºæ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        h2 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        .test-case {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .test-case h3 {
            margin-top: 0;
        }
        
        .code-block {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        
        .result.success {
            background: #d4edda;
            color: #155724;
        }
        
        .result.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .result.warning {
            background: #fff3cd;
            color: #856404;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .timeline {
            margin: 20px 0;
        }
        
        .timeline-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        
        .timeline-time {
            width: 80px;
            text-align: right;
            margin-right: 20px;
            font-family: monospace;
            color: #666;
        }
        
        .timeline-event {
            flex: 1;
            padding: 5px 10px;
            background: #e9ecef;
            border-radius: 5px;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        
        .comparison-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        
        .comparison-table tr:nth-child(even) {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <h1>ğŸ” è¦–è¨Šæ’­æ”¾å™¨åˆå§‹åŒ–é †åºæ¸¬è©¦</h1>
    
    <div class="test-section">
        <h2>å•é¡Œèªªæ˜</h2>
        <p>åŸå§‹çš„ <code>video-ui.js</code> åœ¨å»ºæ§‹å‡½å¼ä¸­ç«‹å³å˜—è©¦ç²å– DOM å…ƒç´ ï¼Œé€™å¯èƒ½å°è‡´ï¼š</p>
        <ul>
            <li>å¦‚æœåœ¨ DOM è¼‰å…¥å‰åˆå§‹åŒ–ï¼Œå…ƒç´ æœƒæ˜¯ <code>null</code></li>
            <li>å¾ŒçºŒæ“ä½œå¯èƒ½å› ç‚º <code>null</code> å€¼è€Œå¤±æ•—</li>
            <li>é›£ä»¥è™•ç†éåŒæ­¥è¼‰å…¥çš„æƒ…æ³</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h2>æ¸¬è©¦æ¡ˆä¾‹</h2>
        
        <div class="test-case">
            <h3>æ¡ˆä¾‹ 1ï¼šåœ¨ DOM è¼‰å…¥å‰åˆå§‹åŒ–ï¼ˆå•é¡Œå ´æ™¯ï¼‰</h3>
            <div class="code-block">// åœ¨ &lt;head&gt; ä¸­åŸ·è¡Œ
const ui = new VideoUI(player);  // å¯èƒ½å¤±æ•—ï¼</div>
            <button onclick="testEarlyInit()">åŸ·è¡Œæ¸¬è©¦</button>
            <div id="earlyInitResult"></div>
        </div>
        
        <div class="test-case">
            <h3>æ¡ˆä¾‹ 2ï¼šä½¿ç”¨ DOMContentLoadedï¼ˆå‚³çµ±è§£æ³•ï¼‰</h3>
            <div class="code-block">document.addEventListener('DOMContentLoaded', () => {
    const ui = new VideoUI(player);  // æ‡‰è©²æˆåŠŸ
});</div>
            <button onclick="testDOMContentLoaded()">åŸ·è¡Œæ¸¬è©¦</button>
            <div id="domContentLoadedResult"></div>
        </div>
        
        <div class="test-case">
            <h3>æ¡ˆä¾‹ 3ï¼šä½¿ç”¨æ”¹é€²çš„éåŒæ­¥åˆå§‹åŒ–ï¼ˆæ¨è–¦ï¼‰</h3>
            <div class="code-block">const ui = new VideoUI(player);
await ui.initialize();  // å…§éƒ¨è™•ç† DOM å°±ç·’</div>
            <button onclick="testAsyncInit()">åŸ·è¡Œæ¸¬è©¦</button>
            <div id="asyncInitResult"></div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>åˆå§‹åŒ–æ™‚é–“è»¸</h2>
        <div id="timeline" class="timeline"></div>
    </div>
    
    <div class="test-section">
        <h2>æ–¹æ¡ˆæ¯”è¼ƒ</h2>
        <table class="comparison-table">
            <thead>
                <tr>
                    <th>æ–¹æ¡ˆ</th>
                    <th>å„ªé»</th>
                    <th>ç¼ºé»</th>
                    <th>é©ç”¨å ´æ™¯</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>åŸå§‹æ–¹å¼</strong><br>å»ºæ§‹å‡½å¼ä¸­ç²å–å…ƒç´ </td>
                    <td>â€¢ ç°¡å–®ç›´æ¥<br>â€¢ åŒæ­¥åŸ·è¡Œ</td>
                    <td>â€¢ DOM æ™‚æ©Ÿå•é¡Œ<br>â€¢ å®¹æ˜“å‡ºéŒ¯<br>â€¢ é›£ä»¥æ¸¬è©¦</td>
                    <td>åªé©ç”¨æ–¼ç¢ºä¿ DOM å·²è¼‰å…¥çš„æƒ…æ³</td>
                </tr>
                <tr>
                    <td><strong>DOMContentLoaded</strong><br>äº‹ä»¶ç›£è½æ–¹å¼</td>
                    <td>â€¢ ç¢ºä¿ DOM å°±ç·’<br>â€¢ ç›¸å®¹æ€§å¥½</td>
                    <td>â€¢ éœ€è¦é¡å¤–åŒ…è£<br>â€¢ ç¨‹å¼ç¢¼åˆ†æ•£</td>
                    <td>å‚³çµ±ç¶²é æ‡‰ç”¨</td>
                </tr>
                <tr>
                    <td><strong>å»¶é²åˆå§‹åŒ–</strong><br>åˆ†é›¢å»ºæ§‹èˆ‡åˆå§‹åŒ–</td>
                    <td>â€¢ å½ˆæ€§é«˜<br>â€¢ æ˜“æ–¼æ¸¬è©¦<br>â€¢ æ”¯æ´é‡è©¦</td>
                    <td>â€¢ éœ€è¦å…©æ­¥é©Ÿ<br>â€¢ API è¼ƒè¤‡é›œ</td>
                    <td>ç¾ä»£åŒ–æ‡‰ç”¨ã€SPA</td>
                </tr>
                <tr>
                    <td><strong>éåŒæ­¥åˆå§‹åŒ–</strong><br>ä½¿ç”¨ async/await</td>
                    <td>â€¢ æœ€ä½³å¯¦è¸<br>â€¢ éŒ¯èª¤è™•ç†å®Œå–„<br>â€¢ æ”¯æ´ Promise</td>
                    <td>â€¢ éœ€è¦ç†è§£éåŒæ­¥</td>
                    <td>æ¨è–¦ç”¨æ–¼æ‰€æœ‰æ–°å°ˆæ¡ˆ</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <div class="test-section">
        <h2>å»ºè­°çš„åˆå§‹åŒ–æµç¨‹</h2>
        <div class="code-block">// 1. å‰µå»ºå¯¦ä¾‹ï¼ˆä¸åŸ·è¡Œ DOM æ“ä½œï¼‰
const player = new VideoPlayer(videoElement);
const ui = new VideoUI(player);

// 2. éåŒæ­¥åˆå§‹åŒ–ï¼ˆå…§éƒ¨è™•ç† DOM å°±ç·’ï¼‰
try {
    await ui.initialize();
    console.log('UI åˆå§‹åŒ–æˆåŠŸ');
} catch (error) {
    console.error('UI åˆå§‹åŒ–å¤±æ•—:', error);
    // å¯ä»¥é‡è©¦æˆ–é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
}</div>
    </div>
    
    <!-- æ¸¬è©¦ç”¨å…ƒç´  -->
    <div style="display: none;">
        <div id="videoWrapper"></div>
        <div id="videoPlayerContainer"></div>
        <div id="videoUploadArea"></div>
        <div id="videoControls"></div>
        <video id="videoPlayer"></video>
        <button id="playPauseBtn"><span class="icon-play">â–¶</span></button>
        <button id="skipBackBtn"></button>
        <button id="skipForwardBtn"></button>
        <div id="progressContainer"></div>
        <input id="progressSlider" type="range">
        <div id="progressPlayed"></div>
        <div id="progressBuffered"></div>
        <span id="currentTime">00:00</span>
        <span id="totalTime">00:00</span>
        <button id="muteBtn"></button>
        <input id="volumeSlider" type="range">
        <button id="speedBtn"><span class="speed-text">1x</span></button>
        <div id="speedMenu"></div>
        <button id="fullscreenBtn"></button>
    </div>
    
    <script type="module">
        import { VideoPlayer } from './js/video/video-player.js';
        import { VideoUI as OriginalVideoUI } from './js/video/video-ui.js';
        import { VideoUI as ImprovedVideoUI } from './js/video/video-ui.js';
        
        const timeline = [];
        
        function addTimelineEvent(event) {
            const time = performance.now().toFixed(2);
            timeline.push({ time, event });
            updateTimeline();
        }
        
        function updateTimeline() {
            const container = document.getElementById('timeline');
            container.innerHTML = timeline.map(item => `
                <div class="timeline-item">
                    <div class="timeline-time">${item.time}ms</div>
                    <div class="timeline-event">${item.event}</div>
                </div>
            `).join('');
        }
        
        function showResult(elementId, success, message, details = null) {
            const element = document.getElementById(elementId);
            element.innerHTML = `
                <div class="result ${success ? 'success' : 'error'}">
                    ${success ? 'âœ…' : 'âŒ'} ${message}
                    ${details ? `<div class="code-block">${details}</div>` : ''}
                </div>
            `;
        }
        
        // æ¸¬è©¦ 1ï¼šæ—©æœŸåˆå§‹åŒ–
        window.testEarlyInit = function() {
            timeline.length = 0;
            addTimelineEvent('é–‹å§‹æ¸¬è©¦ï¼šæ—©æœŸåˆå§‹åŒ–');
            
            try {
                // æ¨¡æ“¬åœ¨ DOM è¼‰å…¥å‰çš„æƒ…æ³
                const tempVideo = document.createElement('video');
                const player = new VideoPlayer(tempVideo);
                addTimelineEvent('VideoPlayer å‰µå»ºæˆåŠŸ');
                
                // å˜—è©¦å‰µå»º UIï¼ˆå¯èƒ½å¤±æ•—ï¼‰
                const ui = new OriginalVideoUI(player);
                addTimelineEvent('VideoUI å‰µå»ºæˆåŠŸï¼Ÿ');
                
                // æª¢æŸ¥å…ƒç´ 
                const nullElements = Object.entries(ui.elements)
                    .filter(([key, value]) => value === null)
                    .map(([key]) => key);
                
                if (nullElements.length > 0) {
                    showResult('earlyInitResult', false, 
                        `åˆå§‹åŒ–å®Œæˆä½†æœ‰ ${nullElements.length} å€‹å…ƒç´ ç‚º null`,
                        `Null å…ƒç´ : ${nullElements.join(', ')}`);
                } else {
                    showResult('earlyInitResult', true, 'åˆå§‹åŒ–æˆåŠŸï¼ˆæ„å¤–ï¼‰');
                }
                
            } catch (error) {
                addTimelineEvent(`éŒ¯èª¤: ${error.message}`);
                showResult('earlyInitResult', false, `åˆå§‹åŒ–å¤±æ•—: ${error.message}`);
            }
        };
        
        // æ¸¬è©¦ 2ï¼šDOMContentLoaded
        window.testDOMContentLoaded = function() {
            timeline.length = 0;
            addTimelineEvent('é–‹å§‹æ¸¬è©¦ï¼šDOMContentLoaded');
            
            // æª¢æŸ¥ç•¶å‰ DOM ç‹€æ…‹
            addTimelineEvent(`ç•¶å‰ DOM ç‹€æ…‹: ${document.readyState}`);
            
            try {
                const video = document.getElementById('videoPlayer');
                const player = new VideoPlayer(video);
                addTimelineEvent('VideoPlayer å‰µå»ºæˆåŠŸ');
                
                const ui = new OriginalVideoUI(player);
                addTimelineEvent('VideoUI å‰µå»ºæˆåŠŸ');
                
                // æª¢æŸ¥å…ƒç´ 
                const nullElements = Object.entries(ui.elements)
                    .filter(([key, value]) => value === null)
                    .map(([key]) => key);
                
                if (nullElements.length === 0) {
                    showResult('domContentLoadedResult', true, 'æ‰€æœ‰å…ƒç´ æˆåŠŸç²å–');
                } else {
                    showResult('domContentLoadedResult', false,
                        `æœ‰ ${nullElements.length} å€‹å…ƒç´ ç‚º null`,
                        `Null å…ƒç´ : ${nullElements.join(', ')}`);
                }
                
            } catch (error) {
                addTimelineEvent(`éŒ¯èª¤: ${error.message}`);
                showResult('domContentLoadedResult', false, `åˆå§‹åŒ–å¤±æ•—: ${error.message}`);
            }
        };
        
        // æ¸¬è©¦ 3ï¼šéåŒæ­¥åˆå§‹åŒ–
        window.testAsyncInit = async function() {
            timeline.length = 0;
            addTimelineEvent('é–‹å§‹æ¸¬è©¦ï¼šéåŒæ­¥åˆå§‹åŒ–');
            
            try {
                const video = document.getElementById('videoPlayer');
                const player = new VideoPlayer(video);
                addTimelineEvent('VideoPlayer å‰µå»ºæˆåŠŸ');
                
                const ui = new ImprovedVideoUI(player);
                addTimelineEvent('VideoUI å¯¦ä¾‹å‰µå»ºæˆåŠŸ');
                
                // éåŒæ­¥åˆå§‹åŒ–
                const result = await ui.initialize();
                addTimelineEvent(`åˆå§‹åŒ–çµæœ: ${result.success ? 'æˆåŠŸ' : 'å¤±æ•—'}`);
                
                if (result.success) {
                    const diagnosis = ui.diagnose();
                    showResult('asyncInitResult', true, 
                        'éåŒæ­¥åˆå§‹åŒ–æˆåŠŸ',
                        JSON.stringify(diagnosis, null, 2));
                } else {
                    showResult('asyncInitResult', false,
                        `åˆå§‹åŒ–å¤±æ•—: ${result.error}`);
                }
                
            } catch (error) {
                addTimelineEvent(`éŒ¯èª¤: ${error.message}`);
                showResult('asyncInitResult', false, `éŒ¯èª¤: ${error.message}`);
            }
        };
        
        // é é¢è¼‰å…¥æ™‚é¡¯ç¤ºç•¶å‰ç‹€æ…‹
        addTimelineEvent(`é é¢è¼‰å…¥ - DOM ç‹€æ…‹: ${document.readyState}`);
        
        document.addEventListener('DOMContentLoaded', () => {
            addTimelineEvent('DOMContentLoaded äº‹ä»¶è§¸ç™¼');
        });
        
        window.addEventListener('load', () => {
            addTimelineEvent('window.load äº‹ä»¶è§¸ç™¼');
        });
    </script>
</body>
</html>