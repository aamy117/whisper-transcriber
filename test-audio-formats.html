<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³è¨Šæ ¼å¼ç›¸å®¹æ€§æ¸¬è©¦</title>
    
    <!-- å¼•å…¥å°ˆæ¡ˆæ¨£å¼ -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/notification.css">
    
    <style>
        .test-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
        }
        
        .test-header {
            text-align: center;
            padding: 2rem;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        
        .info-section {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        
        .format-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .format-card {
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.3s;
        }
        
        .format-card.supported {
            border-color: var(--success-color);
        }
        
        .format-card.partial {
            border-color: var(--warning-color);
        }
        
        .format-card.unsupported {
            border-color: var(--error-color);
        }
        
        .format-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .format-icon {
            font-size: 2rem;
        }
        
        .format-name {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .format-status {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-supported {
            background: var(--success-color);
            color: white;
        }
        
        .status-partial {
            background: var(--warning-color);
            color: white;
        }
        
        .status-unsupported {
            background: var(--error-color);
            color: white;
        }
        
        .format-details {
            margin-top: 1rem;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        .test-section {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 3rem;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            margin-top: 1rem;
        }
        
        .upload-area:hover {
            border-color: var(--primary-color);
            background: var(--bg-tertiary);
        }
        
        .upload-area.dragover {
            border-color: var(--success-color);
            background: rgba(34, 197, 94, 0.1);
        }
        
        #fileInput {
            display: none;
        }
        
        .test-results {
            margin-top: 2rem;
            padding: 1.5rem;
            background: var(--bg-tertiary);
            border-radius: 8px;
            display: none;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-lighter);
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            font-weight: 600;
        }
        
        .result-value {
            font-family: monospace;
        }
        
        .recommendation-box {
            background: rgba(37, 99, 235, 0.1);
            border: 1px solid var(--primary-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 2rem;
        }
        
        .recommendation-box h3 {
            margin-top: 0;
            color: var(--primary-color);
        }
        
        .browser-support {
            margin-top: 2rem;
        }
        
        .browser-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .browser-table th,
        .browser-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .browser-table th {
            background: var(--bg-tertiary);
            font-weight: 600;
        }
        
        .check-mark {
            color: var(--success-color);
        }
        
        .cross-mark {
            color: var(--error-color);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸµ éŸ³è¨Šæ ¼å¼ç›¸å®¹æ€§æ¸¬è©¦</h1>
            <p>äº†è§£å“ªäº›éŸ³è¨Šæ ¼å¼å¯ä»¥æ­£å¸¸åˆ†å‰²è™•ç†</p>
        </div>

        <!-- æ ¼å¼æ”¯æ´è³‡è¨Š -->
        <div class="info-section">
            <h2>æ”¯æ´çš„éŸ³è¨Šæ ¼å¼</h2>
            <div class="format-grid">
                <!-- MP3 -->
                <div class="format-card supported">
                    <div class="format-header">
                        <span class="format-icon">ğŸµ</span>
                        <div>
                            <div class="format-name">MP3</div>
                            <span class="format-status status-supported">å®Œå…¨æ”¯æ´</span>
                        </div>
                    </div>
                    <div class="format-details">
                        <strong>MIME Type:</strong> audio/mpeg, audio/mp3<br>
                        <strong>å‰¯æª”å:</strong> .mp3<br>
                        <strong>èªªæ˜:</strong> æœ€å»£æ³›æ”¯æ´çš„æ ¼å¼ï¼Œæ‰€æœ‰ç€è¦½å™¨éƒ½èƒ½è™•ç†ã€‚å»ºè­°å„ªå…ˆä½¿ç”¨ã€‚
                    </div>
                </div>

                <!-- WAV -->
                <div class="format-card supported">
                    <div class="format-header">
                        <span class="format-icon">ğŸ¶</span>
                        <div>
                            <div class="format-name">WAV</div>
                            <span class="format-status status-supported">å®Œå…¨æ”¯æ´</span>
                        </div>
                    </div>
                    <div class="format-details">
                        <strong>MIME Type:</strong> audio/wav, audio/wave<br>
                        <strong>å‰¯æª”å:</strong> .wav<br>
                        <strong>èªªæ˜:</strong> ç„¡æéŸ³è³ªï¼Œæª”æ¡ˆè¼ƒå¤§ä½†ç›¸å®¹æ€§æ¥µä½³ã€‚é©åˆé«˜å“è³ªéœ€æ±‚ã€‚
                    </div>
                </div>

                <!-- WebM -->
                <div class="format-card supported">
                    <div class="format-header">
                        <span class="format-icon">ğŸ¼</span>
                        <div>
                            <div class="format-name">WebM</div>
                            <span class="format-status status-supported">å®Œå…¨æ”¯æ´</span>
                        </div>
                    </div>
                    <div class="format-details">
                        <strong>MIME Type:</strong> audio/webm<br>
                        <strong>å‰¯æª”å:</strong> .webm<br>
                        <strong>èªªæ˜:</strong> ç¾ä»£ç€è¦½å™¨éƒ½æ”¯æ´ï¼Œæª”æ¡ˆå°ä¸”å“è³ªå¥½ã€‚
                    </div>
                </div>

                <!-- OGG -->
                <div class="format-card partial">
                    <div class="format-header">
                        <span class="format-icon">ğŸ¸</span>
                        <div>
                            <div class="format-name">OGG Vorbis</div>
                            <span class="format-status status-partial">éƒ¨åˆ†æ”¯æ´</span>
                        </div>
                    </div>
                    <div class="format-details">
                        <strong>MIME Type:</strong> audio/ogg<br>
                        <strong>å‰¯æª”å:</strong> .ogg, .oga<br>
                        <strong>èªªæ˜:</strong> Safari ä¸æ”¯æ´ã€‚å…¶ä»–ç€è¦½å™¨æ­£å¸¸ã€‚
                    </div>
                </div>

                <!-- M4A/AAC -->
                <div class="format-card partial">
                    <div class="format-header">
                        <span class="format-icon">ğŸ¹</span>
                        <div>
                            <div class="format-name">M4A/AAC</div>
                            <span class="format-status status-partial">éƒ¨åˆ†æ”¯æ´</span>
                        </div>
                    </div>
                    <div class="format-details">
                        <strong>MIME Type:</strong> audio/mp4, audio/aac<br>
                        <strong>å‰¯æª”å:</strong> .m4a, .aac<br>
                        <strong>èªªæ˜:</strong> å¤§éƒ¨åˆ†ç€è¦½å™¨æ”¯æ´ï¼Œä½†å¯èƒ½æœ‰ç·¨ç¢¼å•é¡Œã€‚
                    </div>
                </div>

                <!-- FLAC -->
                <div class="format-card partial">
                    <div class="format-header">
                        <span class="format-icon">ğŸº</span>
                        <div>
                            <div class="format-name">FLAC</div>
                            <span class="format-status status-partial">éƒ¨åˆ†æ”¯æ´</span>
                        </div>
                    </div>
                    <div class="format-details">
                        <strong>MIME Type:</strong> audio/flac<br>
                        <strong>å‰¯æª”å:</strong> .flac<br>
                        <strong>èªªæ˜:</strong> ç„¡ææ ¼å¼ï¼Œè¼ƒæ–°ç€è¦½å™¨æ”¯æ´ï¼ŒèˆŠç‰ˆå¯èƒ½æœ‰å•é¡Œã€‚
                    </div>
                </div>

                <!-- WMA -->
                <div class="format-card unsupported">
                    <div class="format-header">
                        <span class="format-icon">ğŸ·</span>
                        <div>
                            <div class="format-name">WMA</div>
                            <span class="format-status status-unsupported">ä¸æ”¯æ´</span>
                        </div>
                    </div>
                    <div class="format-details">
                        <strong>MIME Type:</strong> audio/x-ms-wma<br>
                        <strong>å‰¯æª”å:</strong> .wma<br>
                        <strong>èªªæ˜:</strong> å°ˆå±¬æ ¼å¼ï¼Œç€è¦½å™¨ä¸æ”¯æ´ã€‚éœ€è½‰æ›ç‚ºå…¶ä»–æ ¼å¼ã€‚
                    </div>
                </div>

                <!-- AMR -->
                <div class="format-card unsupported">
                    <div class="format-header">
                        <span class="format-icon">ğŸ“»</span>
                        <div>
                            <div class="format-name">AMR</div>
                            <span class="format-status status-unsupported">ä¸æ”¯æ´</span>
                        </div>
                    </div>
                    <div class="format-details">
                        <strong>MIME Type:</strong> audio/amr<br>
                        <strong>å‰¯æª”å:</strong> .amr<br>
                        <strong>èªªæ˜:</strong> æ‰‹æ©ŸéŒ„éŸ³æ ¼å¼ï¼Œéœ€è½‰æ›æ‰èƒ½ä½¿ç”¨ã€‚
                    </div>
                </div>
            </div>
        </div>

        <!-- å»ºè­°å€åŸŸ -->
        <div class="info-section">
            <div class="recommendation-box">
                <h3>ğŸŒŸ æœ€ä½³å¯¦è¸å»ºè­°</h3>
                <ol>
                    <li><strong>å„ªå…ˆä½¿ç”¨ MP3 æˆ– WAV æ ¼å¼</strong> - é€™å…©ç¨®æ ¼å¼æœ‰æœ€ä½³çš„ç›¸å®¹æ€§</li>
                    <li><strong>é¿å…å°ˆå±¬æ ¼å¼</strong> - å¦‚ WMAã€AMR ç­‰æ ¼å¼éœ€è¦å…ˆè½‰æ›</li>
                    <li><strong>æª”æ¡ˆå¤§å°è€ƒé‡</strong> - WAV æª”æ¡ˆè¼ƒå¤§ä½†å“è³ªæœ€å¥½ï¼ŒMP3 è¼ƒå°ä½†æœ‰æå£“ç¸®</li>
                    <li><strong>æ¸¬è©¦æ‚¨çš„æª”æ¡ˆ</strong> - ä½¿ç”¨ä¸‹æ–¹çš„æ¸¬è©¦å·¥å…·ç¢ºèªæª”æ¡ˆæ˜¯å¦èƒ½æ­£å¸¸è™•ç†</li>
                </ol>
            </div>
        </div>

        <!-- ç€è¦½å™¨æ”¯æ´è¡¨ -->
        <div class="info-section">
            <h3>ç€è¦½å™¨æ”¯æ´æƒ…æ³</h3>
            <table class="browser-table">
                <thead>
                    <tr>
                        <th>æ ¼å¼</th>
                        <th>Chrome</th>
                        <th>Firefox</th>
                        <th>Safari</th>
                        <th>Edge</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>MP3</td>
                        <td class="check-mark">âœ“</td>
                        <td class="check-mark">âœ“</td>
                        <td class="check-mark">âœ“</td>
                        <td class="check-mark">âœ“</td>
                    </tr>
                    <tr>
                        <td>WAV</td>
                        <td class="check-mark">âœ“</td>
                        <td class="check-mark">âœ“</td>
                        <td class="check-mark">âœ“</td>
                        <td class="check-mark">âœ“</td>
                    </tr>
                    <tr>
                        <td>WebM</td>
                        <td class="check-mark">âœ“</td>
                        <td class="check-mark">âœ“</td>
                        <td class="check-mark">âœ“</td>
                        <td class="check-mark">âœ“</td>
                    </tr>
                    <tr>
                        <td>OGG</td>
                        <td class="check-mark">âœ“</td>
                        <td class="check-mark">âœ“</td>
                        <td class="cross-mark">âœ—</td>
                        <td class="check-mark">âœ“</td>
                    </tr>
                    <tr>
                        <td>M4A/AAC</td>
                        <td class="check-mark">âœ“</td>
                        <td class="check-mark">âœ“</td>
                        <td class="check-mark">âœ“</td>
                        <td class="check-mark">âœ“</td>
                    </tr>
                    <tr>
                        <td>FLAC</td>
                        <td class="check-mark">âœ“</td>
                        <td class="check-mark">âœ“</td>
                        <td class="check-mark">âœ“</td>
                        <td class="check-mark">âœ“</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- æ¸¬è©¦å·¥å…· -->
        <div class="test-section">
            <h3>æ¸¬è©¦æ‚¨çš„éŸ³è¨Šæª”æ¡ˆ</h3>
            <div class="upload-area" id="uploadArea">
                <p>ğŸµ æ‹–æ”¾éŸ³è¨Šæª”æ¡ˆåˆ°æ­¤è™•</p>
                <p>æˆ–é»æ“Šé¸æ“‡æª”æ¡ˆ</p>
                <input type="file" id="fileInput" accept="audio/*">
            </div>
            
            <div class="test-results" id="testResults">
                <h4>æª”æ¡ˆåˆ†æçµæœ</h4>
                <div class="result-item">
                    <span class="result-label">æª”æ¡ˆåç¨±ï¼š</span>
                    <span class="result-value" id="fileName">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">æª”æ¡ˆé¡å‹ï¼š</span>
                    <span class="result-value" id="fileType">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">æª”æ¡ˆå¤§å°ï¼š</span>
                    <span class="result-value" id="fileSize">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">éŸ³è¨Šæ™‚é•·ï¼š</span>
                    <span class="result-value" id="duration">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Web Audio API æ”¯æ´ï¼š</span>
                    <span class="result-value" id="webAudioSupport">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">å¯å¦åˆ†å‰²ï¼š</span>
                    <span class="result-value" id="canSplit">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">å»ºè­°ï¼š</span>
                    <span class="result-value" id="recommendation" style="font-family: inherit;">-</span>
                </div>
            </div>
        </div>

        <!-- é€šçŸ¥å®¹å™¨ -->
        <div id="notification-container"></div>
    </div>

    <script type="module">
        import { notify } from './js/notification.js';
        
        // æ ¼å¼åŒ–æª”æ¡ˆå¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // æ ¼å¼åŒ–æ™‚é–“
        function formatDuration(seconds) {
            if (!seconds || isNaN(seconds)) return 'ç„¡æ³•è®€å–';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        // åˆå§‹åŒ–
        function init() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            
            // ç¶å®šæª”æ¡ˆä¸Šå‚³
            uploadArea.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelect);
            
            // æ‹–æ”¾æ”¯æ´
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    testFile(files[0]);
                }
            });
        }
        
        // è™•ç†æª”æ¡ˆé¸æ“‡
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                testFile(file);
            }
        }
        
        // æ¸¬è©¦æª”æ¡ˆ
        async function testFile(file) {
            notify.info(`æ­£åœ¨åˆ†ææª”æ¡ˆ: ${file.name}`);
            
            // é¡¯ç¤ºçµæœå€åŸŸ
            document.getElementById('testResults').style.display = 'block';
            
            // åŸºæœ¬è³‡è¨Š
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileType').textContent = file.type || 'æœªçŸ¥';
            document.getElementById('fileSize').textContent = formatFileSize(file.size);
            
            // æ¸¬è©¦éŸ³è¨Šè¼‰å…¥
            const audio = new Audio();
            const url = URL.createObjectURL(file);
            let canPlayAudio = false;
            let audioDuration = null;
            
            try {
                audio.src = url;
                await new Promise((resolve, reject) => {
                    audio.addEventListener('loadedmetadata', () => {
                        canPlayAudio = true;
                        audioDuration = audio.duration;
                        resolve();
                    });
                    audio.addEventListener('error', reject);
                    setTimeout(reject, 5000); // 5ç§’è¶…æ™‚
                });
            } catch (error) {
                canPlayAudio = false;
            }
            
            document.getElementById('duration').textContent = formatDuration(audioDuration);
            
            // æ¸¬è©¦ Web Audio API
            let webAudioSupported = false;
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const arrayBuffer = await file.arrayBuffer();
                await audioContext.decodeAudioData(arrayBuffer.slice(0));
                webAudioSupported = true;
                audioContext.close();
            } catch (error) {
                webAudioSupported = false;
            }
            
            document.getElementById('webAudioSupport').textContent = webAudioSupported ? 'âœ“ æ”¯æ´' : 'âœ— ä¸æ”¯æ´';
            document.getElementById('webAudioSupport').style.color = webAudioSupported ? 'var(--success-color)' : 'var(--error-color)';
            
            // åˆ¤æ–·æ˜¯å¦å¯åˆ†å‰²
            const canSplit = webAudioSupported || canPlayAudio;
            document.getElementById('canSplit').textContent = canSplit ? 'âœ“ å¯ä»¥' : 'âœ— ä¸å¯';
            document.getElementById('canSplit').style.color = canSplit ? 'var(--success-color)' : 'var(--error-color)';
            
            // çµ¦å‡ºå»ºè­°
            let recommendation = '';
            if (webAudioSupported) {
                recommendation = 'âœ… æ­¤æª”æ¡ˆå®Œå…¨æ”¯æ´ï¼Œå¯ä»¥é€²è¡Œæ™ºèƒ½åˆ†å‰²';
            } else if (canPlayAudio) {
                recommendation = 'âš ï¸ æ­¤æª”æ¡ˆåªèƒ½ä½¿ç”¨ç°¡å–®åˆ†å‰²ï¼Œç„¡æ³•é€²è¡ŒéœéŸ³æª¢æ¸¬';
            } else {
                recommendation = 'âŒ æ­¤æ ¼å¼ä¸æ”¯æ´ï¼Œè«‹è½‰æ›ç‚º MP3 æˆ– WAV æ ¼å¼';
            }
            
            document.getElementById('recommendation').textContent = recommendation;
            
            // æ¸…ç†
            URL.revokeObjectURL(url);
            
            notify.success('æª”æ¡ˆåˆ†æå®Œæˆ');
        }
        
        // å•Ÿå‹•
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>