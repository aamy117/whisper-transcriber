<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Whisper 聽打工具 - 基於 OpenAI Whisper API 的專業音訊轉譯工具，支援即時編輯、時間軸同步與多格式匯出">
    <meta name="keywords" content="whisper, 語音轉文字, 聽打工具, 音訊轉譯, OpenAI">
    <meta name="author" content="Whisper Transcriber">
    
    <title>Whisper 聽打工具 - 專業音訊轉譯編輯器</title>
    
    <!-- DNS 預取和預連接 -->
    <link rel="dns-prefetch" href="https://api.openai.com">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://api.openai.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    
    <!-- 關鍵 CSS 內聯 -->
    <style>
        /* 關鍵樣式 - 防止頁面閃爍 */
        :root {
            --primary-color: #0066cc;
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --text-primary: #333333;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
        }
        
        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --border-color: #404040;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: background 0.3s ease;
        }
        
        #app {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .skeleton-loader {
            background: var(--bg-secondary);
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        
        .skeleton-loader::after {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: skeleton-loading 1.5s infinite;
        }
        
        @keyframes skeleton-loading {
            0% { left: -100%; }
            100% { left: 100%; }
        }
    </style>
    
    <!-- 預載入關鍵資源 -->
    <link rel="preload" href="css/shared.css" as="style">
    <link rel="preload" href="css/style.css" as="style">
    <link rel="preload" href="css/splash.css" as="style">
    <link rel="modulepreload" href="js/app-optimized.js">
    <link rel="modulepreload" href="js/core-loader.js">
    
    <!-- 載入關鍵樣式 -->
    <link rel="stylesheet" href="css/shared.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/splash.css">
    <link rel="stylesheet" href="css/pwa.css">
    
    <!-- 延遲載入非關鍵樣式 -->
    <link rel="preload" href="css/preprocessing.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="css/progress.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="css/onboarding.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet" href="css/preprocessing.css">
        <link rel="stylesheet" href="css/progress.css">
        <link rel="stylesheet" href="css/onboarding.css">
    </noscript>
    
    <!-- Open Graph meta tags -->
    <meta property="og:title" content="Whisper 聽打工具">
    <meta property="og:description" content="專業的音訊轉譯與編輯工具，支援本地 WASM 和雲端 API">
    <meta property="og:type" content="website">
    <meta property="og:image" content="assets/og-image.png">
    
    <!-- PWA 支援 -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0066cc">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="assets/icons/favicon.svg">
    <link rel="alternate icon" href="assets/icons/favicon.ico">
</head>
<body>
    <!-- 導航列 -->
    <nav class="app-navigation">
        <div class="nav-container">
            <div class="nav-brand">
                <h1 class="nav-title">Whisper 工具</h1>
            </div>
            <div class="nav-links">
                <a href="index.html" class="nav-link active">
                    <span class="nav-icon">🎵</span>
                    <span>音訊工具</span>
                </a>
                <a href="batch.html" class="nav-link">
                    <span class="nav-icon">📁</span>
                    <span>批次轉譯</span>
                </a>
                <a href="video.html" class="nav-link">
                    <span class="nav-icon">🎬</span>
                    <span>視訊工具</span>
                </a>
            </div>
        </div>
    </nav>
    
    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <div class="container">
                <h1 class="app-title">Whisper 聽打工具</h1>
                <nav class="app-nav">
                    <button class="nav-btn skeleton-loader" id="recentProjectsBtn" title="最近專案" style="width: 40px; height: 40px;">
                        <span class="icon" style="opacity: 0">📁</span>
                    </button>
                    <button class="nav-btn skeleton-loader" id="themeToggleBtn" title="切換深色/淺色模式" style="width: 40px; height: 40px;">
                        <span class="icon icon-light" style="opacity: 0">🌞</span>
                        <span class="icon icon-dark" style="opacity: 0">🌙</span>
                    </button>
                    <button class="nav-btn skeleton-loader" id="settingsBtn" title="設定" style="width: 40px; height: 40px;">
                        <span class="icon" style="opacity: 0">⚙️</span>
                    </button>
                    <button class="nav-btn skeleton-loader" id="helpBtn" title="使用說明" style="width: 40px; height: 40px;">
                        <span class="icon" style="opacity: 0">❓</span>
                    </button>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <main class="app-main">
            <div class="container">
                <!-- Audio Player Section -->
                <section class="player-section" id="playerSection">
                    <div class="upload-area skeleton-loader" id="uploadArea" style="min-height: 200px;">
                        <div class="upload-content" style="opacity: 0">
                            <span class="upload-icon">🎵</span>
                            <h2>上傳音訊檔案</h2>
                            <p>拖放檔案到此處，或點擊選擇檔案</p>
                            <p class="upload-hint">支援格式：MP3, WAV, M4A, FLAC, OGG</p>
                            <input type="file" id="audioInput" accept="audio/*" hidden>
                            <button class="btn btn-primary" id="selectFileBtn">選擇檔案</button>
                        </div>
                    </div>
                    
                    <div class="player-controls" id="playerControls" style="display: none;">
                        <!-- 播放器控制項將動態載入 -->
                    </div>
                </section>

                <!-- Transcription Controls -->
                <section class="transcription-section" id="transcriptionSection" style="display: none;">
                    <!-- 轉譯控制項將動態載入 -->
                </section>

                <!-- Editor Section -->
                <section class="editor-section" id="editorSection" style="display: none;">
                    <!-- 編輯器將動態載入 -->
                </section>
            </div>
        </main>
    </div>
    
    <!-- 效能監控 -->
    <script>
        // 記錄效能指標
        window.addEventListener('load', function() {
            if ('performance' in window) {
                const perfData = performance.getEntriesByType('navigation')[0];
                console.log('頁面載入效能:', {
                    DNS查詢: (perfData.domainLookupEnd - perfData.domainLookupStart).toFixed(2) + 'ms',
                    TCP連接: (perfData.connectEnd - perfData.connectStart).toFixed(2) + 'ms',
                    請求響應: (perfData.responseEnd - perfData.requestStart).toFixed(2) + 'ms',
                    DOM解析: (perfData.domInteractive - perfData.domLoading).toFixed(2) + 'ms',
                    DOM完成: (perfData.domComplete - perfData.domLoading).toFixed(2) + 'ms',
                    總載入時間: (perfData.loadEventEnd - perfData.fetchStart).toFixed(2) + 'ms'
                });
            }
        });
    </script>
    
    <!-- PWA 管理器 -->
    <script type="module" src="js/pwa-manager.js"></script>
    
    <!-- 載入優化的主程式 -->
    <script type="module" src="js/app-optimized.js"></script>
</body>
</html>